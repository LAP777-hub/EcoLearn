<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoLearn - Environmental Education Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Open+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style id="lessons-style">
#lessons-section .lesson-quiz {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.6s ease, opacity 0.4s ease;
  opacity: 0;
}
#lessons-section .lesson-quiz.open {
  max-height: 1000px; /* enough space for 15 Qs */
  opacity: 1;
}


#lessons-section {
  background: var(--light-bg);
  padding: 50px 20px;
}
#lessons-section .lessons-container {
  max-width: 1100px;
  margin: auto;
}
#lessons-section .lessons-title {
  color: var(--dark-green);
  text-align: center;
  margin-bottom: 5px;
}
#lessons-section .lessons-subtitle {
  text-align: center;
  color: var(--light-text);
  margin-bottom: 30px;
}
#lessons-section .lessons-grid {
  display: grid;
  gap: 25px;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}
#lessons-section .lesson-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: var(--card-shadow);
  padding: 15px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}
#lessons-section .lesson-player video {
  width: 100%;
  border-radius: 8px;
  background: #000;
}
#lessons-section .lesson-btn {
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.3s ease;
}
#lessons-section .lesson-btn-green {
  background: var(--dark-green);
  color: #fff;
}
#lessons-section .lesson-btn-outline {
  border: 2px solid var(--dark-green);
  background: transparent;
  color: var(--dark-green);
}
#lessons-section .lesson-btn:hover {
  transform: scale(1.03);
}
#lessons-section .lesson-lock {
  text-align: center;
  background: #f4f8f6;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 10px;
}
#lessons-section .lesson-questions .question {
  background: #f9f9f9;
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 8px;
}
#lessons-section .lesson-result {
  background: #eefcee;
  padding: 10px;
  margin-top: 8px;
  border-radius: 6px;
  display: none;
}
</style>

    <style>
        
        :root {
            --primary-green: #0ae624cd;
            --secondary-green: #3CB371;
            --dark-green: #0b856e;
            --light-green: #E8F5E9;
            --accent-gold: #90e116;
            --accent-orange: #8c07a3;
            --light-bg: #F8F9FA;
            --dark-text: #2C3E50;
            --light-text: #7F8C8D;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.08);
            --hover-shadow: 0 15px 40px rgba(0,0,0,0.15);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --gradient-primary: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-orange) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.7;
            color: var(--dark-text);
            background-color: var(--light-bg);
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: var(--dark-green);
            margin-bottom: 1.2rem;
            line-height: 1.3;
        }

        .container {
            width: 90%;
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Integrated Navigation Bar */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--primary-green);
            padding: 10px 40px;
            position: fixed;
            top: 0;
            width: 100%;
            height: 85px;
            box-sizing: border-box;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            z-index: 100;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
            font-weight: bold;
            font-size: 23px;
            flex-shrink: 0;
        }

        .logo-section i {
            font-size: 2rem;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 35px;
            list-style: none;
            margin: 0;
            padding: 0;
            flex-shrink: 1;
            flex-wrap: nowrap;
            overflow: hidden;
        }

        .nav-links li a {
            text-decoration: none;
            color: white;
            font-size: 18px;
            transition: var(--transition);
            white-space: nowrap;
            padding: 5px 0;
            position: relative;
        }

        .nav-links li a:hover {
            color: #c9f3d1;
        }

        .nav-links li a.active {
            color: var(--accent-gold);
        }

        .nav-links li a.active::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: var(--accent-gold);
        }

        .profile-section {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            margin-left: 20px;
            flex-shrink: 0;
            min-width: 120px;
            max-width: 180px;
        }

        .profile-section img {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: 2px solid white;
            object-fit: cover;
        }

        .username {
            color: white;
            font-weight: 500;
            font-size: 17px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dropdown {
            display: none;
            position: absolute;
            top: 60px;
            right: 0;
            background-color: #f5f5f5;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            width: 190px;
            overflow: hidden;
            z-index: 101;
        }

        .dropdown a {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: var(--primary-green);
            font-size: 15px;
            transition: background-color 0.3s;
        }

        .dropdown a:hover {
            background-color: #cdeed5;
        }

        .edit-submenu {
            display: none;
            background-color: #eaf7ec;
            border-top: 1px solid #cdeed5;
        }

        .edit-submenu a {
            padding-left: 30px;
            font-size: 14px;
        }

        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .profile-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .profile-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .profile-modal-header h3 {
            margin: 0;
            color: var(--dark-green);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-text);
        }

        .profile-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            overflow: hidden;
            border: 3px solid var(--primary-green);
        }

        .profile-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Montserrat', sans-serif;
        }

        .btn-primary {
            background-color: var(--accent-gold);
            color: var(--dark-text);
        }

        .btn-primary:hover {
            background-color: #e6c200;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .hamburger-menu {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Auth Buttons */
        .auth-buttons {
            display: flex;
            gap: 1rem;
            flex-shrink: 0;
        }

        .auth-buttons .btn {
            padding: 0.5rem 1.2rem;
            border-radius: 50px;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-outline:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 12rem 0 8rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            margin-top: 65px;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%232e8b57' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .hero h2 {
            color: white;
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto 3rem;
            opacity: 0.9;
            line-height: 1.8;
        }

        .justified-text {
            text-align: justify;
            line-height: 1.8;
        }

        .hero-buttons {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .hero-buttons .btn {
            padding: 0.7rem 1.8rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-green {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 5px 15px rgba(46, 139, 87, 0.3);
        }

        .btn-green:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 139, 87, 0.4);
        }

        /* About Section */
        .about-section {
            padding: 6rem 0;
            background-color: white;
            position: relative;
        }

        .about-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%232e8b57' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .about-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .about-text {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .about-text h2 {
            margin-bottom: 2rem;
            position: relative;
            display: inline-block;
        }

        .about-text h2::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 4px;
            background: var(--gradient-secondary);
            bottom: -10px;
            left: 0;
            border-radius: 10px;
        }

        .about-text h3 {
            margin-top: 2rem;
            color: var(--primary-green);
            font-size: 1.4rem;
        }

        .about-text p {
            margin-bottom: 1.5rem;
            color: var(--light-text);
            font-size: 1.05rem;
        }

        .floating-card {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
            transition: var(--transition);
            border-left: 4px solid var(--primary-green);
        }

        .floating-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .about-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.8rem;
            margin-top: 3rem;
        }

        .stat-card {
            background-color: white;
            padding: 2rem 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid rgba(46, 139, 87, 0.1);
        }

        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--hover-shadow);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-green);
            margin-bottom: 0.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--light-text);
            font-weight: 500;
        }

        /* Main Content */
        .section {
            padding: 6rem 0;
            position: relative;
        }

        .section-light {
            background-color: var(--light-bg);
        }

        .section-title {
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            width: 100px;
            height: 4px;
            background: var(--gradient-secondary);
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2.5rem;
        }

        .card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid rgba(46, 139, 87, 0.1);
            position: relative;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: var(--hover-shadow);
        }

        .card-img {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .card-img::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
        }

        .card-content {
            padding: 2rem;
        }

        .card h3 {
            margin-bottom: 0.8rem;
            font-size: 1.4rem;
        }

        .card p {
            margin-bottom: 1.5rem;
            color: var(--light-text);
            line-height: 1.6;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
        }

        .progress-bar {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 0.8rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            width: 0%;
            transition: width 1s ease;
            border-radius: 10px;
        }

        .locked-content {
            position: relative;
        }

        .locked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 16px;
            z-index: 5;
            backdrop-filter: blur(5px);
        }

        .locked-overlay i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--accent-gold);
        }

        /* Lesson Videos */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        /* Interactive Components */
        .interactive-section {
            background-color: white;
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(46, 139, 87, 0.1);
            transition: var(--transition);
        }

        .interactive-section:hover {
            box-shadow: var(--hover-shadow);
        }

        .simulation-container {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 12px;
            margin-top: 1.5rem;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.7rem;
            font-weight: 600;
            color: var(--dark-green);
        }

        .form-control {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: 'Open Sans', sans-serif;
            transition: var(--transition);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
        }

        .result-container {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--gradient-primary);
            color: white;
            border-radius: 12px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Enhanced Game Drive */
        .game-drive-container {
            position: relative;
            max-width: 900px;
            margin: 0 auto;
        }

        .game-drive-map {
            width: 100%;
            height: 500px;
            background-color: #e9ecef;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            background-image: url('https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .hotspot {
            position: absolute;
            width: 50px;
            height: 50px;
            background: var(--gradient-secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
            animation: pulse 2s infinite;
            color: var(--dark-text);
            font-size: 1.2rem;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(255, 215, 0, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0);
            }
        }

        .hotspot:hover {
            transform: scale(1.2);
        }

        .hotspot-info {
            position: absolute;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--hover-shadow);
            max-width: 350px;
            z-index: 10;
            display: none;
            animation: fadeIn 0.3s ease;
            border-left: 4px solid var(--accent-gold);
        }

        /* Habitat Match Game */
        .habitat-match-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(46, 139, 87, 0.1);
        }

        .game-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            align-items: center;
        }

        .difficulty-selector {
            display: flex;
            gap: 0.8rem;
        }

        .difficulty-btn {
            padding: 0.6rem 1.2rem;
            border: 2px solid var(--primary-green);
            background-color: white;
            color: var(--primary-green);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .difficulty-btn.active {
            background: var(--gradient-primary);
            color: white;
            border-color: var(--primary-green);
        }

        .habitat-match-game {
            position: relative;
            width: 100%;
            min-height: 500px;
            background-color: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1.5rem;
            border: 2px solid #ddd;
            padding: 1.5rem;
        }

        .game-area {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .animal {
            position: absolute;
            width: 70px;
            height: 70px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 10;
            transition: left 0.1s linear, top 0.1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3));
        }

        .animal-name {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            white-space: nowrap;
            display: none;
        }

        .animal:hover .animal-name {
            display: block;
        }

        .animal-selector {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .animal-option {
            width: 90px;
            height: 90px;
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 16px;
            transition: var(--transition);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .animal-option:hover, .animal-option.selected {
            border-color: var(--primary-green);
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .animal-option-name {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.85rem;
            white-space: nowrap;
            color: var(--dark-text);
            font-weight: 600;
        }

        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.85);
            color: white;
            padding: 2rem 3rem;
            border-radius: 16px;
            text-align: center;
            z-index: 100;
            display: none;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .controls-info {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--light-text);
            font-style: italic;
        }

        /* Match Game Cards */
        .match-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 2px solid #eee;
            transition: var(--transition);
        }

        .match-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .match-card .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .match-card .option {
            padding: 1rem;
            border: 2px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .match-card .option:hover {
            background-color: #f8f9fa;
            border-color: #ddd;
        }

        .match-card .option.correct {
            background-color: var(--light-green);
            border-color: var(--primary-green);
            color: var(--primary-green);
        }

        .match-card .option.wrong {
            background-color: #f8d7da;
            border-color: #e74c3c;
            color: #e74c3c;
        }

        /* Quiz Progress Tab */
        .quiz-progress-tab {
            background-color: white;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: var(--card-shadow);
            margin-top: 2rem;
            border: 1px solid rgba(46, 139, 87, 0.1);
        }

        .progress-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-radius: 12px;
            overflow: hidden;
        }

        .progress-table th, .progress-table td {
            padding: 1.2rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .progress-table th {
            background-color: var(--light-green);
            color: var(--primary-green);
            font-weight: 700;
        }

        .progress-table tr:hover {
            background-color: #f8f9fa;
        }

        .correct-answer {
            color: var(--primary-green);
            font-weight: bold;
        }

        .wrong-answer {
            color: #e74c3c;
            text-decoration: line-through;
        }

        /* Quiz Styles */
        .quiz-container {
            background-color: white;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: var(--card-shadow);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }

        .quiz-timer {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-green);
            background: var(--light-green);
            padding: 0.5rem 1rem;
            border-radius: 50px;
        }

        .quiz-timer.warning {
            color: #e67e22;
            background: #fff3cd;
        }

        .quiz-timer.danger {
            color: #e74c3c;
            background: #f8d7da;
            animation: pulse 1s infinite;
        }

        .quiz-question {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #eee;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .quiz-option {
            padding: 1.2rem 1.5rem;
            border: 2px solid #eee;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .quiz-option:hover {
            background-color: #f8f9fa;
            border-color: #ddd;
        }

        .quiz-option.selected {
            background-color: var(--light-green);
            border-color: var(--primary-green);
        }

        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        /* Self-assessment */
        .assessment-tools {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
        }

        .assessment-tool {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(46, 139, 87, 0.1);
            transition: var(--transition);
        }

        .assessment-tool:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1rem;
            padding: 0.8rem;
            border-radius: 8px;
            transition: var(--transition);
        }

        .checklist-item:hover {
            background-color: #f8f9fa;
        }

        .journal-entry {
            width: 100%;
            min-height: 180px;
            padding: 1.2rem;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-family: 'Open Sans', sans-serif;
            transition: var(--transition);
            resize: vertical;
        }

        .journal-entry:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
        }

        .rating-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 1.2rem;
        }

        .rating-option {
            text-align: center;
            cursor: pointer;
            padding: 0.8rem;
            border-radius: 10px;
            transition: var(--transition);
            flex: 1;
            margin: 0 0.2rem;
            border: 2px solid #eee;
        }

        .rating-option:hover {
            background-color: #f8f9fa;
            border-color: #ddd;
        }

        .rating-option.selected {
            background-color: var(--light-green);
            border-color: var(--primary-green);
        }

        /* Monthly Courses */
        .courses-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2.5rem;
        }

        .course-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            border: 1px solid rgba(46, 139, 87, 0.1);
        }

        .course-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--hover-shadow);
        }

        .course-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--gradient-secondary);
            color: var(--dark-text);
            padding: 0.4rem 0.8rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(255, 215, 0, 0.3);
        }

        .course-progress {
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
        }

        /* Certificates & Badges */
        .achievements-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 2rem;
        }

        .badge-card {
            background: white;
            border-radius: 16px;
            padding: 2rem 1.5rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border: 1px solid rgba(46, 139, 87, 0.1);
            cursor: pointer;
        }

        .badge-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--hover-shadow);
        }

        .badge-icon {
            font-size: 3.5rem;
            color: var(--accent-gold);
            margin-bottom: 1.2rem;
            transition: var(--transition);
        }

        .badge-icon.locked {
            color: #ddd;
        }

        .badge-card:hover .badge-icon:not(.locked) {
            transform: scale(1.2);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            padding: 2rem;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.4s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem;
            border-bottom: 1px solid #eee;
            background: var(--gradient-primary);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .modal-header h3 {
            color: white;
            margin: 0;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: white;
            transition: var(--transition);
        }

        .close-modal:hover {
            transform: scale(1.2);
        }

        /* Pop-up Quiz */
        .popup-quiz {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--gradient-primary);
            color: white;
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            cursor: pointer;
            transition: var(--transition);
            display: none;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        .popup-quiz:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        /* Sponsors Section */
        .sponsors-section {
            background-color: white;
            padding: 5rem 0;
            text-align: center;
        }

        .sponsors-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 3rem;
            margin-top: 3rem;
        }

        .sponsor-logo {
            height: 80px;
            filter: grayscale(100%);
            opacity: 0.7;
            transition: var(--transition);
        }

        .sponsor-logo:hover {
            filter: grayscale(0%);
            opacity: 1;
            transform: scale(1.1);
        }

        /* Footer  footer {
             background: var(--gradient-primary);
             color: white;
             padding: 0.5rem 0; /* reduced height 
             }*/
        
        /* Fixed Footer footer {
         position: fixed;
         bottom: 0;
         left: 0;
         width: 100%;
         background: var(--gradient-primary);
         color: white;
         text-align: center;
         padding: 0.5rem 0; /* reduced height 
         font-size: 0.7rem;
         border-top: 1px solid rgba(255,255,255,0.1);
         z-index: 1000;             /* ensures it stays on top of other elements} */
        /* 
        
        /* Footer (restored to default) */
        footer {
             position: static;            /* restores normal flow */
             background: var(--gradient-primary);
             color: white;
             text-align: center;
             padding: 0.7rem 0;           /* comfortable spacing */
             font-size: 0.8rem;
             border-top: 1px solid rgba(255,255,255,0.1);
}
        

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            color: white;
            margin-bottom: 1.6rem;
            font-size: 1.1rem;
            position: relative;
            display: inline-block;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 1px;
            background: var(--accent-gold);
            bottom: -6px;
            left: 0;
            border-radius: 10px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.6rem;
        }

        .footer-links a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .footer-links a:hover {
            color: white;
            transform: translateX(5px);
        }

        .copyright {
            text-align: center;
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
            font-size: 0.7rem;
        }
        

        /* Progress indicators */
        .progress-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
        }

        .completion-badge {
            background: var(--gradient-primary);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-primary);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 10000;
            display: none;
            animation: toastFadeIn 0.3s ease;
        }

        @keyframes toastFadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Loading states */
        .loading {
            opacity: 0.7;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 30px;
            height: 30px;
            margin: -15px 0 0 -15px;
            border: 3px solid rgba(46, 139, 87, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-green);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error states */
        .error {
            border-color: #e74c3c !important;
        }

        /* Success states */
        .success {
            border-color: var(--primary-green) !important;
        }

        /* Floating elements */
        .floating {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        /* Star Rating */
        .star-rating {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .star {
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: var(--transition);
        }

        .star.active {
            color: var(--accent-gold);
        }

        .star:hover {
            transform: scale(1.2);
        }

        /* Badge Details Modal */
        .badge-details {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            align-items: center;
        }

        .badge-details-icon {
            font-size: 6rem;
            color: var(--accent-gold);
            text-align: center;
        }

        .badge-details-content h3 {
            color: var(--primary-green);
            margin-bottom: 1rem;
        }

        .badge-details-content p {
            margin-bottom: 1rem;
            color: var(--light-text);
        }

        .badge-requirements {
            background-color: var(--light-green);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .badge-requirements h4 {
            margin-bottom: 0.5rem;
            color: var(--dark-green);
        }

        .badge-requirements ul {
            padding-left: 1.5rem;
        }

        .badge-requirements li {
            margin-bottom: 0.5rem;
        }

        /* Policy Pages */
        .policy-content {
            background-color: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .policy-content h2 {
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .policy-content h2:first-child {
            margin-top: 0;
        }

        .policy-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .policy-content ul {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
        }

        .policy-content li {
            margin-bottom: 0.5rem;
        }

        /* PDF Download Section */
        .pdf-download {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #eee;
            text-align: center;
        }

        /* Scenario Resources */
        .scenario-resources {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .resource-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            text-align: center;
        }

        .shuffle-card {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes shuffleOut {
            0% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(-100%); }
        }

        @keyframes shuffleIn {
            0% { opacity: 0; transform: translateX(100%); }
            100% { opacity: 1; transform: translateX(0); }
        }

        /* Quiz Review Enhancements */
        .review-question {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .correct-icon {
            color: var(--primary-green);
            margin-right: 0.5rem;
        }

        .wrong-icon {
            color: #e74c3c;
            margin-right: 0.5rem;
        }

        .answer-container {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                width: 95%;
            }
            
            .hero h2 {
                font-size: 3rem;
            }
        }

        @media (max-width: 992px) {
            .nav-links {
                gap: 1.5rem;
            }

            .about-content {
                grid-template-columns: 1fr;
            }

            .hero h2 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .badge-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 10px 20px;
                flex-wrap: wrap;
                height: auto;
            }

            .hamburger-menu {
                display: block;
            }

            .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
                gap: 0;
                margin-top: 15px;
            }

            .nav-links.active {
                display: flex;
            }

            .nav-links li {
                width: 100%;
                text-align: center;
                padding: 10px 0;
            }

            .nav-links li a {
                display: block;
                width: 100%;
            }

            .profile-section {
                margin-left: auto;
            }

            .cards-container, .courses-container {
                grid-template-columns: 1fr;
            }

            .quiz-navigation {
                flex-direction: column;
                gap: 1rem;
            }

            .quiz-navigation .btn {
                width: 100%;
            }

            .habitat-match-game {
                height: 400px;
            }

            .animal-selector {
                gap: 1rem;
            }

            .animal-option {
                width: 70px;
                height: 70px;
                font-size: 2rem;
            }

            .hero {
                padding: 10rem 0 6rem;
            }

            .hero h2 {
                font-size: 2.2rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .section {
                padding: 4rem 0;
            }

            .modal-content {
                width: 95%;
            }

            .policy-content {
                padding: 1.5rem;
            }

            .game-controls {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }

        @media (max-width: 576px) {
            .hero h2 {
                font-size: 1.8rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .about-stats {
                grid-template-columns: 1fr;
            }
            
            .assessment-tools {
                grid-template-columns: 1fr;
            }
            
            .game-controls {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .rating-scale {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .rating-option {
                margin: 0;
            }

            .star-rating {
                justify-content: center;
            }

            .match-card .options {
                grid-template-columns: 1fr;
            }
        }

         /* Course Player Styles */
        .course-player {
            background-color: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .course-header {
            padding: 2rem;
            background: var(--gradient-primary);
            color: white;
        }
        
        .course-progress-container {
            background-color: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .course-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 600px;
        }
        
        .course-sidebar {
            background-color: #f8f9fa;
            border-right: 1px solid #eee;
            padding: 1.5rem;
        }
        
        .chapter-list {
            list-style: none;
        }
        
        .chapter-item {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: var(--transition);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        
        .chapter-item:hover {
            background-color: #e9ecef;
        }
        
        .chapter-item.active {
            background-color: var(--light-green);
            border-left: 4px solid var(--primary-green);
        }
        
        .chapter-item.completed .chapter-title::after {
            content: ' ';
            color: var(--primary-green);
            font-weight: bold;
        }
        
        .chapter-item.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .chapter-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .chapter-duration {
            font-size: 0.8rem;
            color: var(--light-text);
        }
        
        .course-main {
            padding: 2rem;
            overflow-y: auto;
            max-height: 600px;
        }
        
        .lesson-content {
            margin-bottom: 2rem;
        }
        
        .lesson-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #eee;
        }
        
        /* Quiz Styles */
        .quiz-container {
            background-color: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }
        
        .quiz-question {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        
        .quiz-option {
            padding: 1rem 1.2rem;
            border: 2px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .quiz-option:hover {
            background-color: #f8f9fa;
            border-color: #ddd;
        }
        
        .quiz-option.selected {
            background-color: var(--light-green);
            border-color: var(--primary-green);
        }
        
        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        /* Certificate Styles */
        .certificate {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 20px solid #d4af37;
            border-radius: 10px;
            padding: 3rem;
            text-align: center;
            position: relative;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .certificate::before, .certificate::after {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            background-size: contain;
            background-repeat: no-repeat;
        }
        
        .certificate::before {
            top: 20px;
            left: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23d4af37" d="M50 10 L60 40 L90 40 L65 60 L75 90 L50 70 L25 90 L35 60 L10 40 L40 40 Z"/></svg>');
        }
        
        .certificate::after {
            bottom: 20px;
            right: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23d4af37" d="M50 10 L60 40 L90 40 L65 60 L75 90 L50 70 L25 90 L35 60 L10 40 L40 40 Z"/></svg>');
        }
        
        .certificate-logo {
            font-size: 3rem;
            color: var(--primary-green);
            margin-bottom: 1rem;
        }
        
        .certificate-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .certificate-subtitle {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 2rem;
        }
        
        .certificate-body {
            margin: 2rem 0;
        }
        
        .certificate-name {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .certificate-message {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .certificate-course {
            font-size: 1.5rem;
            color: var(--primary-green);
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .certificate-date {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 2rem;
        }
        
        .certificate-verification {
            display: inline-block;
            background: linear-gradient(135deg, #d4af37 0%, #f9e076 100%);
            color: #2c3e50;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 2rem;
        }
        
        .certificate-signature {
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .signature-line {
            border-top: 2px solid #2c3e50;
            width: 200px;
            margin-top: 0.5rem;
        }
        
        .certificate-actions {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        /* Course Completion Modal */
        .completion-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .completion-content {
            background-color: white;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.4s ease;
        }
        
        /* Chapter Content Styles */
        .chapter-content {
            display: none;
        }
        
        .chapter-content.active {
            display: block;
        }
        
        .content-slide {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-radius: 12px;
        }
        
        .content-slide h3 {
            color: var(--primary-green);
            margin-bottom: 1rem;
        }
        
        .content-slide p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        
        .content-slide ul, .content-slide ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .content-slide li {
            margin-bottom: 0.5rem;
        }
        
        .slide-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }
        
        .slide-counter {
            text-align: center;
            color: var(--light-text);
            margin-bottom: 1rem;
        }
        /*  360 / VR Section Styling (using your CSS variables) */
#vr-experience {
  background: linear-gradient(135deg, var(--light-green) 0%, var(--light-bg) 100%);
  padding: 60px 20px;
  border-top: 3px solid var(--dark-green);
  border-bottom: 3px solid var(--dark-green);
  text-align: center;
  color: var(--dark-text);
  font-family: 'Poppins', sans-serif;
}

#vr-experience h2 {
  font-size: 2rem;
  color: var(--dark-green);
  margin-bottom: 15px;
  letter-spacing: 1px;
  font-weight: 600;
}

#vr-experience p {
  font-size: 1.05rem;
  margin-bottom: 25px;
  color: var(--light-text);
}

#vr-experience a-scene {
  width: 100%;
  height: 500px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: var(--card-shadow);
  transition: var(--transition);
}

#vr-experience a-scene:hover {
  transform: scale(1.01);
  box-shadow: var(--hover-shadow);
}

@media (max-width: 768px) {
  #vr-experience {
    padding: 40px 15px;
  }
  #vr-experience h2 {
    font-size: 1.6rem;
  }
  #vr-experience a-scene {
    height: 350px;
  }
}
/* === LESSONS PROGRESS OVERVIEW STYLES === */
#lessons-section .overview-container {
  background: var(--light-green);
  border: 1px solid rgba(0,0,0,0.05);
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 30px;
  box-shadow: var(--card-shadow);
}
#lessons-section .overview-title {
  color: var(--dark-green);
  margin-bottom: 10px;
  text-align: center;
}
#lessons-section .overview-summary {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 10px;
  margin-bottom: 12px;
}
#lessons-section .overview-item {
  background: #fff;
  padding: 10px 14px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  text-align: center;
  transition: transform 0.3s;
}
#lessons-section .overview-item:hover {
  transform: scale(1.02);
}
#lessons-section .overview-item h4 {
  margin: 0;
  color: var(--dark-green);
}
#lessons-section .overview-status {
  font-size: 0.9rem;
  margin: 4px 0;
}
#lessons-section .overview-score {
  font-weight: 600;
  color: var(--accent-gold);
}
#lessons-section .overview-badge {
  font-size: 1.2rem;
  margin-top: 4px;
}
#lessons-section .overview-bar {
  width: 100%;
  height: 10px;
  background: rgba(0,0,0,0.1);
  border-radius: 5px;
  overflow: hidden;
}
#lessons-section .overview-bar-fill {
  height: 10px;
  background: var(--dark-green);
  width: 0%;
  transition: width 0.8s ease;
}


    </style>
</head>
<body>
    <!-- Integrated Navigation Bar -->
    <nav class="navbar">
        <!-- Left Section -->
        <div class="logo-section">
            <i class="fas fa-seedling"></i>
            <span>EcoLearn</span>
        </div>
        
        <!-- Mobile Hamburger Menu -->
        <button class="hamburger-menu" id="hamburgerMenu">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Center-Right Section -->
        <ul class="nav-links" id="navLinks">
            <li><a href="#home" class="nav-link active">Home</a></li>
            <li><a href="#about" class="nav-link">About</a></li>
            <li><a href="#lessons" class="nav-link">Lessons</a></li>
            <li><a href="#courses" class="nav-link">Courses</a></li>
            <li><a href="#interactive" class="nav-link">I-Learning</a></li>
            <li><a href="#scenario" class="nav-link">Real-World</a></li>
            <li><a href="#tools" class="nav-link">Tools</a></li>
            <li><a href="#quizlet" class="nav-link">Quizlet</a></li>
            <li><a href="#progress" class="nav-link">Progress</a></li>
            <li><a href="#achievements" class="nav-link">Achievements</a></li>
        </ul>
        
        <!-- Authentication Section -->
        <div class="auth-buttons" id="authButtons">
            <button class="btn btn-outline" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
            <button class="btn btn-primary" id="registerBtn"><i class="fas fa-user-plus"></i> Register</button>
        </div>
        
        <!-- Profile Section (Far Right) -->
        <div class="profile-section" id="userInfo" style="display: none;">
            <img id="profileImage" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Profile">
            <span class="username" id="usernameDisplay">Student User</span>
            <!-- Profile Dropdown -->
            <div class="dropdown" id="profileDropdown">
                <a href="#" id="viewProfile">View</a>
                <a href="#" id="editToggle">Edit </a>
                <div class="edit-submenu" id="editSubmenu">
                    <a href="#" id="uploadProfilePic">Upload Picture</a>
                    <a href="#" id="deleteProfilePic">Delete Picture</a>
                </div>
                <a href="#" id="logoutBtn">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section --><!-- ---------------------------------------------------------------------------------------------HOME------------------------------------------------------->
    <section class="hero" id="home">
        <div class="container">
            <h2>Environmental Education for a Sustainable Future</h2>
            <p class="justified-text">EcoLearn is a comprehensive environmental education platform designed for secondary school learners based on Life Sciences CAPs curriculum. Our mission is to inspire and educate the next generation of environmental stewards through engaging lessons, interactive simulations, and real-world scenarios. We believe that understanding our environment is the first step toward protecting it, and we're committed to making environmental education accessible, relevant, and empowering for all students.</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" id="startLearningBtn"><i class="fas fa-play-circle"></i> Start Learning</button>
                <button class="btn btn-outline" id="exploreBtn"><i class="fas fa-compass"></i> Explore Courses</button>
                <a href="https://read.bookcreator.com/J6AeeyoHPTUNK5AsNan7jK2iQCv1/kFxgWdyqR-S3QDTv5wfVwQ" 
   class="btn hero-btn" 
   id="guidebook-btn" 
   target="_blank" 
   rel="noopener noreferrer">
   Guidebook
</a>

            </div>
        </div>
    </section>

    <!-- About Section --><!-- ---------------------------------------------------------------------------------------------ABOUT------------------------------------------------------->
    <section class="about-section" id="about">
        <div class="container">
            <h2 class="section-title">About EcoLearn</h2>
            <div class="about-content">
                <div class="about-text">
                    <div class="vision-card floating-card">
                        <h3><i class="fas fa-eye"></i> Our Vision</h3>
                        <p>To create a world where every student understands and values the natural environment, and is equipped with the knowledge and skills to protect it for future generations.</p>
                    </div>
                    
                    <div class="mission-card floating-card" style="animation-delay: 0.2s;">
                        <h3><i class="fas fa-bullseye"></i> Our Mission</h3>
                        <p>To provide comprehensive, engaging, and accessible environmental education that aligns with curriculum standards while fostering a lifelong passion for sustainability.</p>
                    </div>
                    
                    <div class="passion-card floating-card" style="animation-delay: 0.4s;">
                        <h3><i class="fas fa-heart"></i> Our Passion</h3>
                        <p>We are passionate about making environmental education interactive, relevant, and empowering for students. We believe that understanding our environment is the first step toward protecting it.</p>
                    </div>
                </div>
                <div class="about-stats">
                    <div class="stat-card floating">
                        <div class="stat-number">50,000+</div>
                        <div class="stat-label">Students Educated</div>
                    </div>
                    <div class="stat-card floating" style="animation-delay: 0.2s;">
                        <div class="stat-number">500+</div>
                        <div class="stat-label">Partner Schools</div>
                    </div>
                    <div class="stat-card floating" style="animation-delay: 0.4s;">
                        <div class="stat-number">15,000+</div>
                        <div class="stat-label">Courses Completed</div>
                    </div>
                    <div class="stat-card floating" style="animation-delay: 0.6s;">
                        <div class="stat-number">92%</div>
                        <div class="stat-label">Satisfaction Rate</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
   <!--  360 / VR Environmental Experience (no A-Frame) -->
<section id="vr-experience" style="margin-top: 40px;">
  <h2 style="text-align:center;">Explore Nature in 360</h2>
  <p style="text-align:center;">Put on your VR headset or drag around the video below to explore the environment.</p>

  <div class="vr-container" style="max-width: 900px; margin: 30px auto; border-radius: 12px; overflow: hidden; box-shadow: 0 6px 22px rgba(0,0,0,0.15);">
    <video
      id="eco360player"
      class="video-js vjs-default-skin"
      controls
      preload="auto"
      width="900"
      height="500"
      crossorigin="anonymous"
      playsinline
    >
      <source src="videos/eco360.mp4" type="video/mp4" />
      Your browser does not support HTML5 video.
    </video>
  </div>
</section>

<!--  Required JS/CSS (from CDNs) -->
<link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script src="https://unpkg.com/videojs-panorama@2.0.3/dist/videojs-panorama.min.js"></script>

<!--  Initialize the 360 Panorama Player -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const player = videojs('eco360player');
  player.panorama({
    clickAndDrag: true,
    autoMobileOrientation: true,
    initFov: 100,
    NoticeMessage: 'Click and drag to look around '
  });
});
</script>



    <!-- Sponsors Section --><!---------------------------------------------------------------------------------------------SPONSORS------------------------------------------------------->
    <section class="sponsors-section">
        <div class="container">
            <h2 class="section-title">Our Partners & Sponsors</h2>
            <div class="sponsors-container">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/320px-Google_2015_logo.svg.png" alt="Google" class="sponsor-logo">
               <img src="images/microsoft-logo-1.png" alt="Microsoft" class="sponsor-logo">
               <img src="images/National Geographic.jpeg" alt="National Geographic" class="sponsor-logo">
               <img src="images/Google Scholar.png" alt="Google Scholar" class="sponsor-logo">
            </div>
        </div>
    </section>

    <!-- Lessons Section --><!---------------------------------------------------------------------------------------------LESSONS------------------------------------------------------->
    <!-- ========== LESSONS SECTION (SAFE ISOLATED VERSION) ========== -->
<section id="lessons-section">
  <div class="lessons-container">
    <h2 class="lessons-title">Lessons</h2>
    <p class="lessons-subtitle">Watch the video to unlock the assessment and download professional resources.</p>
    <!-- === ECOLEARN PROGRESS OVERVIEW === -->
<div id="lessons-overview" class="overview-container">
  <h3 class="overview-title">Your Learning Progress</h3>
  <div id="overview-summary" class="overview-summary"></div>
  <div class="overview-bar">
    <div id="overview-bar-fill" class="overview-bar-fill"></div>
  </div>
</div>

    <div class="lessons-grid">

      <!-- Lesson 1 -->
      <article class="lesson-card" id="lesson-1">
        <h3 class="lesson-name">Biodiversity &amp; Ecosystems</h3>
        <p class="lesson-info">Learn how species interact, sustain balance, and support ecosystems.</p>

       <div class="lesson-player">
  <iframe width="100%" height="200" src="https://www.youtube.com/embed/oE-Wfmmo8eU"
    title="Pollution & Conservation" frameborder="0" allowfullscreen></iframe>
</div>

        <div class="lesson-actions">
          <a href="resources/biodiversity.pdf" download class="lesson-btn lesson-btn-outline">Download PDF</a>
          <button class="lesson-btn lesson-btn-green" id="unlockBtn-1">Take Assessment</button>
        </div>

        <div class="lesson-quiz" id="quiz-1">
          <div class="lesson-lock" id="lock-1">
            <p>Complete the video to unlock the assessment.</p>
            <button class="lesson-btn" id="confirmWatched-1">I Watched the Video</button>
          </div>
          <form id="quizform-1" onsubmit="return false;">
            <div class="lesson-questions" id="questions-1"></div>
            <div class="lesson-controls">
              <button class="lesson-btn lesson-btn-outline" id="reset-1" type="button">Reset</button>
              <button class="lesson-btn lesson-btn-green" id="submit-1" type="button">Submit</button>
            </div>
            <div class="lesson-result" id="result-1"></div>
          </form>
        </div>
      </article>

      <!-- Lesson 2 -->
      <article class="lesson-card" id="lesson-2">
        <h3 class="lesson-name">Pollution &amp; Conservation</h3>
        <p class="lesson-info">Understand pollutions effects and how conservation protects the planet.</p>

        <!-- Lesson 2 Player -->
<div class="lesson-player">
  <iframe width="100%" height="200" src="https://www.youtube.com/embed/VSlbVdSmvcs"
    title="Sustainable Development" frameborder="0" allowfullscreen></iframe>
</div>

        <div class="lesson-actions">
          <a href="resources/pollution.pdf" download class="lesson-btn lesson-btn-outline">Download PDF</a>
          <button class="lesson-btn lesson-btn-green" id="unlockBtn-2">Take Assessment</button>
        </div>

        <div class="lesson-quiz" id="quiz-2">
          <div class="lesson-lock" id="lock-2">
            <p>Complete the video to unlock the assessment.</p>
            <button class="lesson-btn" id="confirmWatched-2">I Watched the Video</button>
          </div>
          <form id="quizform-2" onsubmit="return false;">
            <div class="lesson-questions" id="questions-2"></div>
            <div class="lesson-controls">
              <button class="lesson-btn lesson-btn-outline" id="reset-2" type="button">Reset</button>
              <button class="lesson-btn lesson-btn-green" id="submit-2" type="button">Submit</button>
            </div>
            <div class="lesson-result" id="result-2"></div>
          </form>
        </div>
      </article>

      <!-- Lesson 3 -->
      <article class="lesson-card" id="lesson-3">
        <h3 class="lesson-name">Sustainable Development</h3>
        <p class="lesson-info">Explore global goals and sustainable practices for a better future.</p>

        <!-- Lesson 3 Player -->
<div class="lesson-player">
  <iframe width="100%" height="200" src="https://www.youtube.com/embed/6px41qUMw3U"
    title="Biodiversity & Ecosystems" frameborder="0" allowfullscreen></iframe>
</div>

        <div class="lesson-actions">
          <a href="resources/sustainability.pdf" download class="lesson-btn lesson-btn-outline">Download PDF</a>
          <button class="lesson-btn lesson-btn-green" id="unlockBtn-3">Take Assessment</button>
        </div>

        <div class="lesson-quiz" id="quiz-3">
          <div class="lesson-lock" id="lock-3">
            <p>Complete the video to unlock the assessment.</p>
            <button class="lesson-btn" id="confirmWatched-3">I Watched the Video</button>
          </div>
          <form id="quizform-3" onsubmit="return false;">
            <div class="lesson-questions" id="questions-3"></div>
            <div class="lesson-controls">
              <button class="lesson-btn lesson-btn-outline" id="reset-3" type="button">Reset</button>
              <button class="lesson-btn lesson-btn-green" id="submit-3" type="button">Submit</button>
            </div>
            <div class="lesson-result" id="result-3"></div>
          </form>
        </div>
      </article>

    </div>
  </div>
</section>


    <!-- Monthly Courses Section --><!---------------------------------------------------------------------------------------------COURSES------------------------------------------------------->
    <section class="section" id="courses">
        <div class="container">
            <h2 class="section-title">Monthly Courses</h2>
            <div class="courses-container">
                <!-- Course 1 -->
                <div class="course-card locked-content" id="course1Card">
                    <div class="locked-overlay">
                        <i class="fas fa-lock"></i>
                        <p>Please login to access this course</p>
                    </div>
                    <div class="card-img" style="background-image: url('https://images.unsplash.com/photo-1569163139394-de44cb2c8cb7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="card-content">
                        <div class="course-badge"><i class="fas fa-award"></i> Certificate Available</div>
                        <h3>Climate Change Fundamentals</h3>
                        <p>A comprehensive course covering the science, impacts, and solutions to climate change with real-world case studies.</p>
                        <ul>
                            <li><i class="fas fa-play-circle"></i> 4 modules</li>
                            <li><i class="fas fa-user-clock"></i> Self-paced learning</li>
                            <li><i class="fas fa-star"></i> Final assessment</li>
                        </ul>
                    </div>
                    <div class="course-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="course1ProgressBar" style="width: 0%;"></div>
                        </div>
                        <p>Progress: <span id="course1Progress">0%</span></p>
                        <button class="btn btn-green" style="width: 100%; margin-top: 1rem;" onclick="startCourse('climate')" id="startCourse1Btn"><i class="fas fa-play"></i> Start Course</button>
                    </div>
                </div>
                
                <!-- Course 2 -->
                <div class="course-card locked-content" id="course2Card">
                    <div class="locked-overlay">
                        <i class="fas fa-lock"></i>
                        <p>Please login to access this course</p>
                    </div>
                    <div class="card-img" style="background-image: url('https://images.unsplash.com/photo-1470115636492-6d2b56f9146d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="card-content">
                        <div class="course-badge"><i class="fas fa-award"></i> Certificate Available</div>
                        <h3>Renewable Energy Systems</h3>
                        <p>Explore different renewable energy technologies and their implementation in modern society.</p>
                        <ul>
                            <li><i class="fas fa-play-circle"></i> 5 modules</li>
                            <li><i class="fas fa-cogs"></i> Interactive simulations</li>
                            <li><i class="fas fa-briefcase"></i> Case studies</li>
                        </ul>
                    </div>
                    <div class="course-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="course2ProgressBar" style="width: 0%;"></div>
                        </div>
                        <p>Progress: <span id="course2Progress">0%</span></p>
                        <button class="btn btn-green" style="width: 100%; margin-top: 1rem;" onclick="startCourse('energy')" id="startCourse2Btn"><i class="fas fa-play"></i> Start Course</button>
                    </div>
                </div>
                
                <!-- Course 3 -->
                <div class="course-card locked-content" id="course3Card">
                    <div class="locked-overlay">
                        <i class="fas fa-lock"></i>
                        <p>Please login to access this course</p>
                    </div>
                    <div class="card-img" style="background-image: url('https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
                    <div class="card-content">
                        <div class="course-badge"><i class="fas fa-award"></i> Certificate Available</div>
                        <h3>Sustainable Agriculture</h3>
                        <p>Learn about farming practices that protect the environment and ensure food security for growing populations.</p>
                        <ul>
                            <li><i class="fas fa-play-circle"></i> 6 modules</li>
                            <li><i class="fas fa-seedling"></i> Field exercises</li>
                            <li><i class="fas fa-user-tie"></i> Expert interviews</li>
                        </ul>
                    </div>
                    <div class="course-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="course3ProgressBar" style="width: 0%;"></div>
                        </div>
                        <p>Progress: <span id="course3Progress">0%</span></p>
                        <button class="btn btn-green" style="width: 100%; margin-top: 1rem;" onclick="startCourse('agriculture')" id="startCourse3Btn"><i class="fas fa-play"></i> Start Course</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Course Player Modal --><!---------------------------------------------------------------------------------------------COURSE PLAYER------------------------------------------------------->
    <div class="modal" id="coursePlayerModal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h3 id="coursePlayerTitle">Course Title</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="course-player">
                    <div class="course-header">
                        <h4 id="currentChapterTitle">Chapter Title</h4>
                        <div class="course-progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="chapterProgressBar" style="width: 0%;"></div>
                            </div>
                            <p>Chapter Progress: <span id="chapterProgress">0%</span></p>
                        </div>
                    </div>
                    
                    <div class="course-content">
                        <div class="course-sidebar">
                            <h4>Course Content</h4>
                            <ul class="chapter-list" id="chapterList">
                                <!-- Chapters will be populated by JavaScript -->
                            </ul>
                        </div>
                        
                        <div class="course-main">
                            <div id="courseContentArea">
                                <!-- Course content will be populated by JavaScript -->
                            </div>
                            
                            <div class="lesson-navigation">
                                <button class="btn btn-outline" id="prevLessonBtn" disabled><i class="fas fa-arrow-left"></i> Previous</button>
                                <button class="btn btn-green" id="nextLessonBtn">Next <i class="fas fa-arrow-right"></i></button>
                                <button class="btn btn-primary" id="completeChapterBtn" style="display: none;"><i class="fas fa-check-circle"></i> Complete Chapter</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chapter Quiz Modal -->
    <div class="modal" id="chapterQuizModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="chapterQuizTitle">Chapter Quiz</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="quiz-container">
                    <div id="chapterQuizQuestions">
                        <!-- Quiz questions will be populated by JavaScript -->
                    </div>
                    <div class="quiz-navigation">
                        <button class="btn btn-outline" id="prevQuizQuestion"><i class="fas fa-arrow-left"></i> Previous</button>
                        <button class="btn btn-green" id="nextQuizQuestion">Next <i class="fas fa-arrow-right"></i></button>
                        <button class="btn btn-green" id="submitChapterQuiz" style="display: none;"><i class="fas fa-paper-plane"></i> Submit Quiz</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Final Exam Modal -->
    <div class="modal" id="finalExamModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="finalExamTitle">Final Exam</h3>
                <div class="quiz-timer" id="finalExamTimer">60:00</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="quiz-container">
                    <div id="finalExamQuestions">
                        <!-- Final exam questions will be populated by JavaScript -->
                    </div>
                    <div class="quiz-navigation">
                        <button class="btn btn-outline" id="prevFinalQuestion"><i class="fas fa-arrow-left"></i> Previous</button>
                        <button class="btn btn-green" id="nextFinalQuestion">Next <i class="fas fa-arrow-right"></i></button>
                        <button class="btn btn-green" id="submitFinalExam" style="display: none;"><i class="fas fa-paper-plane"></i> Submit Exam</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Completion Modal -->
    <div class="completion-modal" id="completionModal">
        <div class="completion-content">
            <div class="modal-header">
                <h3>Course Completed!</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="certificate" id="certificate">
                    <div class="certificate-logo">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <div class="certificate-title">Certificate of Completion</div>
                    <div class="certificate-subtitle">This certifies that</div>
                    
                    <div class="certificate-body">
                        <div class="certificate-name" id="certificateUserName">Student Name</div>
                        <div class="certificate-message">has successfully completed the course requirements and demonstrated proficiency in</div>
                        <div class="certificate-course" id="certificateCourseName">Course Name</div>
                        <div class="certificate-date" id="certificateDate">Date of Completion</div>
                    </div>
                    
                    <div class="certificate-verification">
                        Verified by EcoLearn
                    </div>
                    
                    <div class="certificate-signature">
                        <div>
                            <div class="signature-line"></div>
                            <p>EcoLearn Director</p>
                        </div>
                        <div>
                            <div class="signature-line"></div>
                            <p>Date</p>
                        </div>
                    </div>
                </div>
                
                <div class="certificate-actions">
                    <button class="btn btn-green" onclick="downloadCertificate()"><i class="fas fa-download"></i> Download Certificate</button>
                    <button class="btn btn-outline" onclick="closeCompletionModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Course Management System
        let currentCourse = null;
        let currentChapterIndex = 0;
        let currentSlideIndex = 0;
        let chapterQuizAnswers = [];
        let finalExamAnswers = [];
        let finalExamTimer = null;
        
        // Course Data
        const courses = {
            climate: {
                id: 'climate',
                title: 'Climate Change Fundamentals',
                description: 'A comprehensive course covering the science, impacts, and solutions to climate change',
                chapters: [
                    {
                        title: 'Introduction to Climate Change',
                        duration: '15 min',
                        slides: [
                            {
                                title: 'What is Climate Change?',
                                content: `
                                    <h3>Understanding Climate Change</h3>
                                    <p>Climate change refers to significant, long-term changes in the global climate. The global climate is the connected system of sun, earth and oceans, wind, rain and snow, forests, deserts and savannas, and everything people do too.</p>
                                    <p>The climate of a place, say New York, can be described as its rainfall, changing temperatures during the year and so on. But the global climate is more than the "average" of the climates of specific places.</p>
                                    <h4>Key Points:</h4>
                                    <ul>
                                        <li>Climate change involves both global warming driven by human emissions of greenhouse gases, and the resulting large-scale shifts in weather patterns.</li>
                                        <li>Though there have been previous periods of climatic change, since the mid-20th century humans have had an unprecedented impact on Earth's climate system.</li>
                                        <li>Climate change includes both the global warming driven by human emissions, and its impacts on Earth's weather patterns.</li>
                                    </ul>
                                `
                            },
                            {
                                title: 'The Greenhouse Effect',
                                content: `
                                    <h3>The Greenhouse Effect Explained</h3>
                                    <p>The greenhouse effect is a natural process that warms the Earth's surface. When the Sun's energy reaches the Earth's atmosphere, some of it is reflected back to space and the rest is absorbed and re-radiated by greenhouse gases.</p>
                                    <p>Greenhouse gases include water vapor, carbon dioxide, methane, nitrous oxide, ozone and some artificial chemicals such as chlorofluorocarbons (CFCs).</p>
                                    <h4>How It Works:</h4>
                                    <ol>
                                        <li>Solar radiation reaches the Earth's atmosphere</li>
                                        <li>Some of this radiation is reflected back to space</li>
                                        <li>The rest is absorbed by the land and oceans, heating the Earth</li>
                                        <li>Heat is radiated from Earth towards space</li>
                                        <li>Some of this heat is trapped by greenhouse gases in the atmosphere, keeping the Earth warm enough to sustain life</li>
                                    </ol>
                                    <p>The enhanced greenhouse effect is the additional warming that results when increased levels of greenhouse gases trap more heat in the atmosphere.</p>
                                `
                            },
                            {
                                title: 'Historical Climate Data',
                                content: `
                                    <h3>Understanding Historical Climate Patterns</h3>
                                    <p>Scientists study Earth's climate and how it changes in three main ways:</p>
                                    <ul>
                                        <li><strong>Direct measurements</strong> from weather stations, ships, buoys, and satellites since the late 19th century</li>
                                        <li><strong>Proxy data</strong> from natural recorders of climate variability such as tree rings, ice cores, fossil pollen, ocean sediments, and coral reefs</li>
                                        <li><strong>Climate models</strong> that simulate the climate system and help understand past, present, and future climate changes</li>
                                    </ul>
                                    <h4>Key Historical Findings:</h4>
                                    <p>The Earth's climate has changed throughout history. Just in the last 650,000 years, there have been seven cycles of glacial advance and retreat, with the abrupt end of the last ice age about 11,700 years ago marking the beginning of the modern climate era.</p>
                                    <p>Most of these climate changes are attributed to very small variations in Earth's orbit that change the amount of solar energy our planet receives. The current warming trend is of particular significance because it is unequivocally the result of human activity since the mid-20th century.</p>
                                `
                            }
                        ],
                        quiz: [
                            {
                                question: "What is the primary difference between weather and climate?",
                                options: [
                                    "Weather refers to short-term conditions, climate refers to long-term patterns",
                                    "Weather refers to temperature, climate refers to precipitation",
                                    "Weather is local, climate is global",
                                    "There is no significant difference"
                                ],
                                correct: 0
                            },
                            {
                                question: "Which of these is NOT a greenhouse gas?",
                                options: [
                                    "Carbon dioxide",
                                    "Oxygen",
                                    "Methane",
                                    "Nitrous oxide"
                                ],
                                correct: 1
                            },
                            {
                                question: "What is the main cause of current global warming?",
                                options: [
                                    "Human activities that increase greenhouse gas concentrations",
                                    "Natural cycles of the Earth's orbit",
                                    "Increased solar radiation",
                                    "Volcanic eruptions"
                                ],
                                correct: 0
                            },
                            {
                                question: "How do scientists study historical climate before modern instruments?",
                                options: [
                                    "Using proxy data like ice cores and tree rings",
                                    "They don't - there's no way to know",
                                    "Through written historical records only",
                                    "By guessing based on current patterns"
                                ],
                                correct: 0
                            },
                            {
                                question: "What percentage of climate scientists agree that humans are causing global warming?",
                                options: [
                                    "Over 97%",
                                    "About 50%",
                                    "Less than 30%",
                                    "Scientists are equally divided"
                                ],
                                correct: 0
                            }
                        ]
                    },
                    {
                        title: 'Causes of Climate Change',
                        duration: '20 min',
                        slides: [
                            {
                                title: 'Human Activities and Emissions',
                                content: `
                                    <h3>Human Influence on Climate</h3>
                                    <p>Human activities have contributed substantially to climate change through:</p>
                                    <ul>
                                        <li><strong>Emissions of greenhouse gases</strong> - Primarily from burning fossil fuels</li>
                                        <li><strong>Deforestation</strong> - Reducing the Earth's capacity to absorb carbon dioxide</li>
                                        <li><strong>Agriculture</strong> - Particularly livestock farming producing methane</li>
                                        <li><strong>Industrial processes</strong> - Releasing various greenhouse gases and aerosols</li>
                                    </ul>
                                    <h4>Key Sources of Greenhouse Gases:</h4>
                                    <p><strong>Carbon Dioxide (CO2):</strong> Fossil fuel use is the primary source of CO2. The way in which people use land is also an important source of CO2.</p>
                                    <p><strong>Methane (CH4):</strong> Agricultural activities, waste management, energy use, and biomass burning all contribute to CH4 emissions.</p>
                                    <p><strong>Nitrous Oxide (N2O):</strong> Agricultural activities, such as fertilizer use, are the primary source of N2O emissions.</p>
                                    <p><strong>Fluorinated Gases:</strong> Industrial processes, refrigeration, and the use of a variety of consumer products contribute to emissions of fluorinated gases.</p>
                                `
                            },
                            {
                                title: 'Natural Factors',
                                content: `
                                    <h3>Natural Influences on Climate</h3>
                                    <p>While human activities are the primary driver of current climate change, natural factors also influence Earth's climate:</p>
                                    <ul>
                                        <li><strong>Solar variations</strong> - Changes in the Sun's energy output</li>
                                        <li><strong>Volcanic eruptions</strong> - Injecting particles that can cool the climate</li>
                                        <li><strong>Orbital variations</strong> - Changes in Earth's orbit and orientation</li>
                                        <li><strong>Natural greenhouse effect</strong> - Essential for life as we know it</li>
                                    </ul>
                                    <h4>Solar Activity:</h4>
                                    <p>The Sun's energy output does change slightly over an 11-year cycle. However, the warming we've seen over recent decades is too rapid to be linked to changes in solar activity and too large to be caused by solar activity alone.</p>
                                    <h4>Volcanic Eruptions:</h4>
                                    <p>Volcanic eruptions can inject large amounts of sulfur dioxide and ash into the atmosphere. These particles reflect sunlight back into space and have a cooling effect on the world's climate. However, this effect is temporary, lasting only a few years.</p>
                                `
                            },
                            {
                                title: 'Feedback Mechanisms',
                                content: `
                                    <h3>Climate Feedback Loops</h3>
                                    <p>Feedback mechanisms can either amplify or reduce the effects of climate forcings. There are positive feedbacks (which amplify changes) and negative feedbacks (which dampen changes).</p>
                                    <h4>Positive Feedbacks (Amplifying):</h4>
                                    <ul>
                                        <li><strong>Water vapor feedback</strong> - Warmer air holds more water vapor, which is a greenhouse gas, causing more warming</li>
                                        <li><strong>Ice-albedo feedback</strong> - Melting ice exposes darker land or water, which absorbs more heat, causing more melting</li>
                                        <li><strong>Carbon cycle feedbacks</strong> - Warming can release additional CO2 and methane from natural stores</li>
                                    </ul>
                                    <h4>Negative Feedbacks (Stabilizing):</h4>
                                    <ul>
                                        <li><strong>Blackbody radiation</strong> - Warmer objects emit more radiation, which can cool the Earth</li>
                                        <li><strong>Cloud feedbacks</strong> - Some clouds reflect sunlight, which has a cooling effect</li>
                                        <li><strong>Carbon sinks</strong> - Some natural processes may absorb more CO2 as concentrations rise</li>
                                    </ul>
                                    <p>Understanding these feedbacks is crucial for predicting future climate change accurately.</p>
                                `
                            }
                        ],
                        quiz: [
                            {
                                question: "What is the largest source of anthropogenic greenhouse gas emissions?",
                                options: [
                                    "Burning of fossil fuels",
                                    "Deforestation",
                                    "Agriculture",
                                    "Industrial processes"
                                ],
                                correct: 0
                            },
                            {
                                question: "Which greenhouse gas has the highest global warming potential?",
                                options: [
                                    "Some fluorinated gases",
                                    "Carbon dioxide",
                                    "Methane",
                                    "Nitrous oxide"
                                ],
                                correct: 0
                            },
                            {
                                question: "What is the ice-albedo feedback?",
                                options: [
                                    "Melting ice exposes darker surfaces that absorb more heat",
                                    "Ice reflects sunlight keeping the Earth cool",
                                    "Ice formation releases heat into the atmosphere",
                                    "Ice melting cools the ocean currents"
                                ],
                                correct: 0
                            },
                            {
                                question: "How do volcanic eruptions typically affect climate?",
                                options: [
                                    "They cause temporary cooling",
                                    "They cause permanent warming",
                                    "They have no effect on climate",
                                    "They only affect local weather"
                                ],
                                correct: 0
                            },
                            {
                                question: "Which sector is the largest contributor to methane emissions?",
                                options: [
                                    "Agriculture",
                                    "Energy production",
                                    "Transportation",
                                    "Waste management"
                                ],
                                correct: 0
                            }
                        ]
                    },
                    {
                        title: 'Impacts of Climate Change',
                        duration: '25 min',
                        slides: [
                            {
                                title: 'Environmental Impacts',
                                content: `
                                    <h3>Effects on Natural Systems</h3>
                                    <p>Climate change is already having visible effects on the world. The Earth is warming, rainfall patterns are changing, and sea levels are rising. These changes can increase the risk of heatwaves, floods, droughts, and fires.</p>
                                    <h4>Key Environmental Impacts:</h4>
                                    <ul>
                                        <li><strong>Rising temperatures</strong> - Global average temperature has increased by about 1C since pre-industrial times</li>
                                        <li><strong>Melting ice and snow</strong> - Glaciers and ice sheets are shrinking worldwide</li>
                                        <li><strong>Sea level rise</strong> - Global sea level has risen by about 20 cm since 1900</li>
                                        <li><strong>Ocean acidification</strong> - The ocean has absorbed about 30% of the emitted CO2, making it more acidic</li>
                                        <li><strong>Extreme weather events</strong> - Increased frequency and intensity of heatwaves, droughts, and heavy precipitation</li>
                                    </ul>
                                    <p>These changes are impacting ecosystems and the services they provide. Many species are shifting their geographic ranges, seasonal activities, migration patterns, and abundances in response to climate change.</p>
                                `
                            },
                            {
                                title: 'Societal and Economic Impacts',
                                content: `
                                    <h3>Effects on Human Systems</h3>
                                    <p>Climate change affects human health, infrastructure, transportation systems, and food production. The impacts are not distributed evenly - vulnerable populations and developing countries are often disproportionately affected.</p>
                                    <h4>Key Societal Impacts:</h4>
                                    <ul>
                                        <li><strong>Health impacts</strong> - Increased heat-related illnesses, changing patterns of infectious diseases, and health effects from extreme events</li>
                                        <li><strong>Food security</strong> - Changes in crop yields, fishing patterns, and food prices</li>
                                        <li><strong>Water resources</strong> - Changes in water availability and quality</li>
                                        <li><strong>Infrastructure</strong> - Damage to buildings, roads, and other infrastructure from extreme weather</li>
                                        <li><strong>Economic impacts</strong> - Costs from damage to property and infrastructure, lost productivity, and increased healthcare costs</li>
                                    </ul>
                                    <p>Climate change can also exacerbate existing social and economic inequalities. Poor communities, indigenous peoples, and other vulnerable groups often have limited capacity to adapt to climate impacts.</p>
                                `
                            },
                            {
                                title: 'Regional Variations',
                                content: `
                                    <h3>Differential Impacts Across Regions</h3>
                                    <p>Climate change impacts vary significantly by region. Some areas may experience certain impacts more severely than others, and some regions may even experience some benefits, at least in the short term.</p>
                                    <h4>Regional Differences:</h4>
                                    <ul>
                                        <li><strong>Arctic</strong> - Warming at about twice the global average rate, with dramatic ice melt</li>
                                        <li><strong>Small islands</strong> - Threatened by sea level rise and extreme weather events</li>
                                        <li><strong>Africa</strong> - Vulnerable to droughts, food insecurity, and water scarcity</li>
                                        <li><strong>Asia</strong> - At risk from sea level rise, extreme heat, and changes in monsoon patterns</li>
                                        <li><strong>Europe</strong> - Facing heatwaves, floods, and changes in agricultural productivity</li>
                                        <li><strong>North America</strong> - Experiencing more intense wildfires, heatwaves, and heavy precipitation</li>
                                        <li><strong>South America</strong> - Dealing with glacier retreat, forest loss, and changes in water availability</li>
                                    </ul>
                                    <p>Understanding these regional variations is crucial for developing effective adaptation strategies.</p>
                                `
                            }
                        ],
                        quiz: [
                            {
                                question: "What is the approximate global temperature increase since pre-industrial times?",
                                options: [
                                    "About 1C",
                                    "About 3C",
                                    "About 0.5C",
                                    "No significant increase"
                                ],
                                correct: 0
                            },
                            {
                                question: "Which region is warming at about twice the global average rate?",
                                options: [
                                    "The Arctic",
                                    "The tropics",
                                    "Europe",
                                    "Australia"
                                ],
                                correct: 0
                            },
                            {
                                question: "How does climate change affect ocean chemistry?",
                                options: [
                                    "It causes ocean acidification",
                                    "It makes the ocean more alkaline",
                                    "It has no effect on ocean chemistry",
                                    "It increases ocean salinity"
                                ],
                                correct: 0
                            },
                            {
                                question: "Which group is typically most vulnerable to climate change impacts?",
                                options: [
                                    "Poor and marginalized communities",
                                    "Wealthy urban populations",
                                    "People in temperate climates",
                                    "All groups are equally vulnerable"
                                ],
                                correct: 0
                            },
                            {
                                question: "What is a major threat to small island nations from climate change?",
                                options: [
                                    "Sea level rise",
                                    "Decreased tourism",
                                    "Too much rainfall",
                                    "Colder temperatures"
                                ],
                                correct: 0
                            }
                        ]
                    },
                    {
                        title: 'Solutions and Mitigation',
                        duration: '20 min',
                        slides: [
                            {
                                title: 'Reducing Emissions',
                                content: `
                                    <h3>Strategies for Mitigation</h3>
                                    <p>Climate change mitigation involves reducing the flow of greenhouse gases into the atmosphere, either by reducing sources of these gases or enhancing the sinks that accumulate and store these gases.</p>
                                    <h4>Key Mitigation Strategies:</h4>
                                    <ul>
                                        <li><strong>Energy efficiency</strong> - Using less energy to provide the same service</li>
                                        <li><strong>Renewable energy</strong> - Solar, wind, hydro, geothermal, and biomass energy</li>
                                        <li><strong>Transportation changes</strong> - Electric vehicles, public transit, biking, and walking</li>
                                        <li><strong>Carbon capture and storage</strong> - Technologies that capture CO2 from large point sources</li>
                                        <li><strong>Forest conservation</strong> - Protecting existing forests and planting new ones</li>
                                        <li><strong>Sustainable agriculture</strong> - Practices that reduce emissions and enhance carbon storage</li>
                                    </ul>
                                    <p>Many of these solutions not only reduce greenhouse gas emissions but also provide other benefits such as improved air quality, enhanced energy security, and job creation.</p>
                                `
                            },
                            {
                                title: 'International Agreements',
                                content: `
                                    <h3>Global Climate Governance</h3>
                                    <p>Because climate change is a global problem, international cooperation is essential. Several important international agreements have been established to address climate change.</p>
                                    <h4>Key Agreements:</h4>
                                    <ul>
                                        <li><strong>United Nations Framework Convention on Climate Change (UNFCCC)</strong> - 1992 agreement that provides the overall framework for intergovernmental efforts</li>
                                        <li><strong>Kyoto Protocol</strong> - 1997 agreement that set binding emission reduction targets for developed countries</li>
                                        <li><strong>Paris Agreement</strong> - 2015 agreement where countries pledged to limit warming to well below 2C</li>
                                    </ul>
                                    <p>The Paris Agreement is particularly significant because it includes commitments from both developed and developing countries. Each country sets its own emissions targets (Nationally Determined Contributions or NDCs) and reports on its progress.</p>
                                    <p>While these agreements represent important steps forward, current commitments are not sufficient to meet the temperature goals, highlighting the need for increased ambition and action.</p>
                                `
                            },
                            {
                                title: 'Individual and Community Action',
                                content: `
                                    <h3>What Can Individuals Do?</h3>
                                    <p>While systemic changes are essential, individual actions also play an important role in addressing climate change. When multiplied across millions of people, individual choices can drive significant change.</p>
                                    <h4>Effective Individual Actions:</h4>
                                    <ul>
                                        <li><strong>Reduce energy consumption</strong> - Use energy-efficient appliances, improve home insulation</li>
                                        <li><strong>Choose sustainable transportation</strong> - Walk, bike, use public transit, or drive electric vehicles</li>
                                        <li><strong>Eat sustainably</strong> - Reduce meat consumption, minimize food waste</li>
                                        <li><strong>Reduce, reuse, recycle</strong> - Minimize consumption and waste</li>
                                        <li><strong>Support clean energy</strong> - Choose green energy options if available</li>
                                        <li><strong>Get involved</strong> - Vote, advocate for climate policies, join community initiatives</li>
                                    </ul>
                                    <p>Individual actions are most effective when they influence others and help create social norms that support climate-friendly behaviors. Collective action at the community level can also drive significant change.</p>
                                `
                            }
                        ],
                        quiz: [
                            {
                                question: "What is the primary goal of climate change mitigation?",
                                options: [
                                    "Reduce greenhouse gas emissions",
                                    "Adapt to climate impacts",
                                    "Study climate science",
                                    "Relocate vulnerable communities"
                                ],
                                correct: 0
                            },
                            {
                                question: "Which international agreement set the goal of limiting warming to well below 2C?",
                                options: [
                                    "Paris Agreement",
                                    "Kyoto Protocol",
                                    "Montreal Protocol",
                                    "UNFCCC"
                                ],
                                correct: 0
                            },
                            {
                                question: "Which of these is NOT a renewable energy source?",
                                options: [
                                    "Natural gas",
                                    "Solar power",
                                    "Wind power",
                                    "Hydropower"
                                ],
                                correct: 0
                            },
                            {
                                question: "What does CCS stand for in climate change context?",
                                options: [
                                    "Carbon Capture and Storage",
                                    "Climate Change Solution",
                                    "Carbon Control System",
                                    "Climate Conservation Strategy"
                                ],
                                correct: 0
                            },
                            {
                                question: "Which individual action has the greatest potential to reduce emissions?",
                                options: [
                                    "Switching to renewable energy",
                                    "Reducing meat consumption",
                                    "Using public transportation",
                                    "All have significant potential when scaled up"
                                ],
                                correct: 3
                            }
                        ]
                    }
                ],
                finalExam: [
                    {
                        question: "What is the enhanced greenhouse effect?",
                        options: [
                            "Additional warming from increased greenhouse gas concentrations",
                            "The natural process that makes Earth habitable",
                            "The effect of clouds on climate",
                            "A theory that has been disproven"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which sector is the largest source of global CO2 emissions?",
                        options: [
                            "Electricity and heat production",
                            "Transportation",
                            "Agriculture",
                            "Industrial processes"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the main cause of recent global sea level rise?",
                        options: [
                            "Thermal expansion of seawater and melting of land ice",
                            "Increased precipitation",
                            "Changes in ocean currents",
                            "Underwater volcanic activity"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does deforestation contribute to climate change?",
                        options: [
                            "It releases stored carbon and reduces carbon absorption",
                            "It increases surface albedo",
                            "It changes regional weather patterns only",
                            "It has no significant effect on climate"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the significance of the 2C temperature target?",
                        options: [
                            "It represents a threshold for dangerous climate impacts",
                            "It's an arbitrary number with no scientific basis",
                            "It's the maximum temperature increase that's beneficial",
                            "It's the point at which climate change becomes irreversible"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which greenhouse gas has the longest atmospheric lifetime?",
                        options: [
                            "Some fluorinated gases can persist for thousands of years",
                            "Carbon dioxide",
                            "Methane",
                            "Nitrous oxide"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is ocean acidification?",
                        options: [
                            "The decrease in ocean pH due to CO2 absorption",
                            "The increase in ocean temperature",
                            "Pollution from industrial waste",
                            "A natural process unrelated to climate change"
                        ],
                        correct: 0
                    },
                    {
                        question: "How do climate models help scientists?",
                        options: [
                            "They simulate the climate system to understand past and future changes",
                            "They predict weather with 100% accuracy",
                            "They control the climate",
                            "They have no practical use"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the primary challenge with carbon capture and storage?",
                        options: [
                            "Cost and scalability",
                            "Technical impossibility",
                            "Lack of storage locations",
                            "It increases emissions"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does climate change affect biodiversity?",
                        options: [
                            "It causes shifts in species ranges and increased extinction risk",
                            "It has no effect on biodiversity",
                            "It increases biodiversity everywhere",
                            "It only affects polar species"
                        ],
                        correct: 0
                    },
                    {
                        question: "What are Nationally Determined Contributions (NDCs)?",
                        options: [
                            "Climate action plans under the Paris Agreement",
                            "Financial contributions to the UN",
                            "Scientific research proposals",
                            "Individual carbon footprints"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which feedback mechanism amplifies Arctic warming?",
                        options: [
                            "Ice-albedo feedback",
                            "Cloud feedback",
                            "Water vapor feedback",
                            "Carbon cycle feedback"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the main difference between mitigation and adaptation?",
                        options: [
                            "Mitigation addresses causes, adaptation addresses impacts",
                            "Mitigation is local, adaptation is global",
                            "Mitigation is cheaper than adaptation",
                            "There is no significant difference"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does climate change affect extreme weather events?",
                        options: [
                            "It increases the frequency and intensity of some events",
                            "It decreases all extreme weather",
                            "It has no effect on extreme weather",
                            "It only affects rainfall patterns"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the significance of the pre-industrial baseline?",
                        options: [
                            "It provides a reference point before significant human influence",
                            "It's an arbitrary date with no meaning",
                            "It marks the beginning of weather records",
                            "It's when the industrial revolution ended"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which renewable energy source has seen the fastest growth recently?",
                        options: [
                            "Solar photovoltaic",
                            "Wind power",
                            "Hydropower",
                            "Geothermal"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does climate change affect food security?",
                        options: [
                            "It can reduce crop yields and disrupt food systems",
                            "It increases food production everywhere",
                            "It has no effect on food security",
                            "It only affects luxury food items"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the main limitation of current climate models?",
                        options: [
                            "Uncertainty in some feedback processes and regional projections",
                            "They cannot simulate the past climate",
                            "They are too simple to be useful",
                            "They consistently overestimate warming"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does aviation contribute to climate change?",
                        options: [
                            "Through CO2 emissions and other non-CO2 effects",
                            "Only through noise pollution",
                            "It has no climate impact",
                            "Only through contrails"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is climate justice?",
                        options: [
                            "Addressing the unequal distribution of climate impacts and responsibilities",
                            "A legal framework for climate treaties",
                            "Punishing countries for emissions",
                            "A concept with no practical application"
                        ],
                        correct: 0
                    },
                    {
                        question: "How do wetlands affect climate change?",
                        options: [
                            "They store carbon but can also emit methane",
                            "They have no climate impact",
                            "They only cool the local climate",
                            "They are net sources of CO2"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the primary challenge for climate adaptation?",
                        options: [
                            "Cost, planning, and addressing uncertain future conditions",
                            "Lack of technological solutions",
                            "Opposition from all stakeholders",
                            "It's technically impossible"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does black carbon (soot) affect climate?",
                        options: [
                            "It absorbs heat and accelerates ice melt when deposited",
                            "It only has local air quality effects",
                            "It cools the climate by reflecting sunlight",
                            "It has no climate impact"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the significance of tipping points in the climate system?",
                        options: [
                            "They represent thresholds that can lead to irreversible changes",
                            "They mark the beginning of climate change",
                            "They are theoretical concepts with no evidence",
                            "They indicate when climate change will stop"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does climate change affect human health?",
                        options: [
                            "Through heat stress, disease patterns, and food/water security",
                            "It has no direct health impacts",
                            "It only affects mental health",
                            "It improves health through warmer temperatures"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the role of the IPCC?",
                        options: [
                            "To assess climate science for policymakers",
                            "To enforce climate agreements",
                            "To fund climate research",
                            "To predict weather patterns"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does climate change affect the water cycle?",
                        options: [
                            "It intensifies the cycle, leading to more extremes",
                            "It has no effect on the water cycle",
                            "It makes precipitation more evenly distributed",
                            "It slows down the water cycle"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is carbon sequestration?",
                        options: [
                            "The capture and storage of atmospheric carbon",
                            "The release of carbon from fossil fuels",
                            "The measurement of carbon emissions",
                            "The trading of carbon credits"
                        ],
                        correct: 0
                    },
                    {
                        question: "How does climate change affect ocean currents?",
                        options: [
                            "It can alter circulation patterns like the Gulf Stream",
                            "It has no effect on ocean currents",
                            "It makes currents faster everywhere",
                            "It only affects surface currents"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the main barrier to widespread renewable energy adoption?",
                        options: [
                            "Cost and infrastructure challenges",
                            "Lack of technological development",
                            "Public opposition to all renewables",
                            "Ineffectiveness compared to fossil fuels"
                        ],
                        correct: 0
                    }
                ]
            },
            energy: {
                id: 'energy',
                title: 'Renewable Energy Systems',
                description: 'Explore different renewable energy technologies and their implementation',
                chapters: [
                    // Similar structure to climate course but with energy-focused content
                    {
                        title: 'Introduction to Renewable Energy',
                        duration: '15 min',
                        slides: [
                            {
                                title: 'What is Renewable Energy?',
                                content: `<h3>Understanding Renewable Energy</h3><p>Renewable energy comes from natural sources that are constantly replenished...</p>`
                            },
                            // Additional slides would go here
                        ],
                        quiz: [
                            // Quiz questions would go here
                        ]
                    },
                    // Additional chapters would go here
                ],
                finalExam: [
                    // Final exam questions would go here
                ]
            },
            agriculture: {
                id: 'agriculture',
                title: 'Sustainable Agriculture',
                description: 'Learn about farming practices that protect the environment',
                chapters: [
                    // Similar structure to other courses but with agriculture-focused content
                    {
                        title: 'Principles of Sustainable Agriculture',
                        duration: '15 min',
                        slides: [
                            {
                                title: 'What is Sustainable Agriculture?',
                                content: `<h3>Understanding Sustainable Agriculture</h3><p>Sustainable agriculture meets society's food needs without compromising future generations...</p>`
                            },
                            // Additional slides would go here
                        ],
                        quiz: [
                            // Quiz questions would go here
                        ]
                    },
                    // Additional chapters would go here
                ],
                finalExam: [
                    // Final exam questions would go here
                ]
            }
        };

        // Course Management Functions
        function startCourse(courseId) {
            if (!currentUser) {
                showToast('Please login to access courses.', 'error');
                loginModal.style.display = 'flex';
                return;
            }
            
            currentCourse = courses[courseId];
            currentChapterIndex = 0;
            currentSlideIndex = 0;
            
            // Initialize course progress if not exists
            if (!currentUser.progress.courses) {
                currentUser.progress.courses = {};
            }
            if (!currentUser.progress.courses[courseId]) {
                currentUser.progress.courses[courseId] = {
                    progress: 0,
                    chapters: {},
                    completed: false
                };
            }
            
            // Update modal title
            document.getElementById('coursePlayerTitle').textContent = currentCourse.title;
            
            // Load chapters
            loadChapters();
            
            // Load first chapter
            loadChapter(0);
            
            // Show course player
            document.getElementById('coursePlayerModal').style.display = 'flex';
        }
        
        function loadChapters() {
            const chapterList = document.getElementById('chapterList');
            chapterList.innerHTML = '';
            
            currentCourse.chapters.forEach((chapter, index) => {
                const chapterItem = document.createElement('li');
                chapterItem.className = 'chapter-item';
                chapterItem.setAttribute('data-chapter-index', index);
                
                // Check if chapter is completed or locked
                const chapterProgress = currentUser.progress.courses[currentCourse.id].chapters[index];
                if (chapterProgress && chapterProgress.completed) {
                    chapterItem.classList.add('completed');
                } else if (index > 0 && (!currentUser.progress.courses[currentCourse.id].chapters[index-1] || 
                         !currentUser.progress.courses[currentCourse.id].chapters[index-1].completed)) {
                    chapterItem.classList.add('locked');
                }
                
                if (index === currentChapterIndex) {
                    chapterItem.classList.add('active');
                }
                
                chapterItem.innerHTML = `
                    <div class="chapter-title">${chapter.title}</div>
                    <div class="chapter-duration">${chapter.duration}</div>
                `;
                
                chapterItem.addEventListener('click', () => {
                    if (!chapterItem.classList.contains('locked')) {
                        loadChapter(index);
                    }
                });
                
                chapterList.appendChild(chapterItem);
            });
        }
        
        function loadChapter(chapterIndex) {
            currentChapterIndex = chapterIndex;
            currentSlideIndex = 0;
            
            // Update active chapter in sidebar
            document.querySelectorAll('.chapter-item').forEach((item, index) => {
                item.classList.remove('active');
                if (index === chapterIndex) {
                    item.classList.add('active');
                }
            });
            
            const chapter = currentCourse.chapters[chapterIndex];
            document.getElementById('currentChapterTitle').textContent = chapter.title;
            
            // Load chapter content
            loadSlide(0);
            
            // Update navigation buttons
            updateNavigationButtons();
        }
        
        function loadSlide(slideIndex) {
            currentSlideIndex = slideIndex;
            const chapter = currentCourse.chapters[currentChapterIndex];
            const slide = chapter.slides[slideIndex];
            
            document.getElementById('courseContentArea').innerHTML = `
                <div class="lesson-content">
                    <h3>${slide.title}</h3>
                    <div class="slide-counter">Slide ${slideIndex + 1} of ${chapter.slides.length}</div>
                    <div class="content-slide">
                        ${slide.content}
                    </div>
                </div>
            `;
            
            // Update slide navigation
            updateSlideNavigation();
        }
        
        function updateSlideNavigation() {
            const chapter = currentCourse.chapters[currentChapterIndex];
            
            document.getElementById('prevLessonBtn').disabled = currentSlideIndex === 0;
            document.getElementById('nextLessonBtn').style.display = currentSlideIndex < chapter.slides.length - 1 ? 'block' : 'none';
            document.getElementById('completeChapterBtn').style.display = currentSlideIndex === chapter.slides.length - 1 ? 'block' : 'none';
        }
        
        function updateNavigationButtons() {
            document.getElementById('prevLessonBtn').addEventListener('click', () => {
                if (currentSlideIndex > 0) {
                    loadSlide(currentSlideIndex - 1);
                }
            });
            
            document.getElementById('nextLessonBtn').addEventListener('click', () => {
                if (currentSlideIndex < currentCourse.chapters[currentChapterIndex].slides.length - 1) {
                    loadSlide(currentSlideIndex + 1);
                }
            });
            
            document.getElementById('completeChapterBtn').addEventListener('click', () => {
                startChapterQuiz();
            });
        }
        
        function startChapterQuiz() {
            const chapter = currentCourse.chapters[currentChapterIndex];
            document.getElementById('chapterQuizTitle').textContent = `${chapter.title} - Quiz`;
            
            // Initialize quiz
            chapterQuizAnswers = new Array(chapter.quiz.length).fill(null);
            currentQuizQuestionIndex = 0;
            
            loadQuizQuestion(0);
            
            // Show quiz modal
            document.getElementById('coursePlayerModal').style.display = 'none';
            document.getElementById('chapterQuizModal').style.display = 'flex';
        }
        
        function loadQuizQuestion(questionIndex) {
            const chapter = currentCourse.chapters[currentChapterIndex];
            const question = chapter.quiz[questionIndex];
            
            let optionsHtml = '';
            question.options.forEach((option, i) => {
                const isSelected = chapterQuizAnswers[questionIndex] === i;
                optionsHtml += `
                    <div class="quiz-option ${isSelected ? 'selected' : ''}" 
                         onclick="selectQuizAnswer(${questionIndex}, ${i})">
                        ${option}
                    </div>
                `;
            });
            
            document.getElementById('chapterQuizQuestions').innerHTML = `
                <div class="quiz-question">
                    <h4>Question ${questionIndex + 1} of ${chapter.quiz.length}</h4>
                    <p>${question.question}</p>
                    <div class="quiz-options">
                        ${optionsHtml}
                    </div>
                </div>
            `;
            
            // Update navigation
            document.getElementById('prevQuizQuestion').style.display = questionIndex > 0 ? 'block' : 'none';
            document.getElementById('nextQuizQuestion').style.display = questionIndex < chapter.quiz.length - 1 ? 'block' : 'none';
            document.getElementById('submitChapterQuiz').style.display = questionIndex === chapter.quiz.length - 1 ? 'block' : 'none';
            
            currentQuizQuestionIndex = questionIndex;
        }
        
        function selectQuizAnswer(questionIndex, optionIndex) {
            chapterQuizAnswers[questionIndex] = optionIndex;
            loadQuizQuestion(questionIndex);
        }
        
        // Set up quiz navigation
        document.getElementById('prevQuizQuestion').addEventListener('click', () => {
            if (currentQuizQuestionIndex > 0) {
                loadQuizQuestion(currentQuizQuestionIndex - 1);
            }
        });
        
        document.getElementById('nextQuizQuestion').addEventListener('click', () => {
            if (currentQuizQuestionIndex < currentCourse.chapters[currentChapterIndex].quiz.length - 1) {
                loadQuizQuestion(currentQuizQuestionIndex + 1);
            }
        });
        
        document.getElementById('submitChapterQuiz').addEventListener('click', submitChapterQuiz);
        
        function submitChapterQuiz() {
            const chapter = currentCourse.chapters[currentChapterIndex];
            
            // Calculate score
            let correct = 0;
            chapter.quiz.forEach((question, i) => {
                if (chapterQuizAnswers[i] === question.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / chapter.quiz.length) * 100);
            
            // Check if passed (60% or higher)
            if (score >= 60) {
                // Update user progress
                if (!currentUser.progress.courses[currentCourse.id].chapters[currentChapterIndex]) {
                    currentUser.progress.courses[currentCourse.id].chapters[currentChapterIndex] = {};
                }
                currentUser.progress.courses[currentCourse.id].chapters[currentChapterIndex].completed = true;
                currentUser.progress.courses[currentCourse.id].chapters[currentChapterIndex].score = score;
                
                // Update overall course progress
                const completedChapters = Object.values(currentUser.progress.courses[currentCourse.id].chapters).filter(ch => ch.completed).length;
                const totalChapters = currentCourse.chapters.length;
                currentUser.progress.courses[currentCourse.id].progress = Math.round((completedChapters / totalChapters) * 100);
                
                // Check if all chapters completed
                if (completedChapters === totalChapters) {
                    // Start final exam
                    startFinalExam();
                } else {
                    // Show success message and return to course
                    showToast(`Chapter completed! Score: ${score}%`);
                    document.getElementById('chapterQuizModal').style.display = 'none';
                    document.getElementById('coursePlayerModal').style.display = 'flex';
                    loadChapters(); // Refresh chapter list to show completion
                }
                
                updateUserData();
                updateCourseProgressDisplay();
            } else {
                showToast(`You scored ${score}%. You need 60% to pass. Please try again.`, 'error');
            }
        }
        
        function startFinalExam() {
            document.getElementById('finalExamTitle').textContent = `${currentCourse.title} - Final Exam`;
            document.getElementById('finalExamTimer').textContent = '60:00';
            
            // Initialize exam
            finalExamAnswers = new Array(currentCourse.finalExam.length).fill(null);
            currentFinalQuestionIndex = 0;
            
            loadFinalQuestion(0);
            startFinalExamTimer(60 * 60); // 60 minutes
            
            // Show exam modal
            document.getElementById('chapterQuizModal').style.display = 'none';
            document.getElementById('finalExamModal').style.display = 'flex';
        }
        
        function loadFinalQuestion(questionIndex) {
            const question = currentCourse.finalExam[questionIndex];
            
            let optionsHtml = '';
            question.options.forEach((option, i) => {
                const isSelected = finalExamAnswers[questionIndex] === i;
                optionsHtml += `
                    <div class="quiz-option ${isSelected ? 'selected' : ''}" 
                         onclick="selectFinalAnswer(${questionIndex}, ${i})">
                        ${option}
                    </div>
                `;
            });
            
            document.getElementById('finalExamQuestions').innerHTML = `
                <div class="quiz-question">
                    <h4>Question ${questionIndex + 1} of ${currentCourse.finalExam.length}</h4>
                    <p>${question.question}</p>
                    <div class="quiz-options">
                        ${optionsHtml}
                    </div>
                </div>
            `;
            
            // Update navigation
            document.getElementById('prevFinalQuestion').style.display = questionIndex > 0 ? 'block' : 'none';
            document.getElementById('nextFinalQuestion').style.display = questionIndex < currentCourse.finalExam.length - 1 ? 'block' : 'none';
            document.getElementById('submitFinalExam').style.display = questionIndex === currentCourse.finalExam.length - 1 ? 'block' : 'none';
            
            currentFinalQuestionIndex = questionIndex;
        }
        
        function selectFinalAnswer(questionIndex, optionIndex) {
            finalExamAnswers[questionIndex] = optionIndex;
            loadFinalQuestion(questionIndex);
        }
        
        function startFinalExamTimer(seconds) {
            let timeLeft = seconds;
            
            if (finalExamTimer) clearInterval(finalExamTimer);
            
            finalExamTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('finalExamTimer').textContent = formatTime(timeLeft);
                
                // Update timer color based on remaining time
                if (timeLeft <= 600) { // 10 minutes or less
                    document.getElementById('finalExamTimer').className = 'quiz-timer warning';
                }
                if (timeLeft <= 300) { // 5 minutes or less
                    document.getElementById('finalExamTimer').className = 'quiz-timer danger';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(finalExamTimer);
                    submitFinalExam();
                }
            }, 1000);
        }
        
        // Set up final exam navigation
        document.getElementById('prevFinalQuestion').addEventListener('click', () => {
            if (currentFinalQuestionIndex > 0) {
                loadFinalQuestion(currentFinalQuestionIndex - 1);
            }
        });
        
        document.getElementById('nextFinalQuestion').addEventListener('click', () => {
            if (currentFinalQuestionIndex < currentCourse.finalExam.length - 1) {
                loadFinalQuestion(currentFinalQuestionIndex + 1);
            }
        });
        
        document.getElementById('submitFinalExam').addEventListener('click', submitFinalExam);
        
        function submitFinalExam() {
            clearInterval(finalExamTimer);
            
            // Calculate score
            let correct = 0;
            currentCourse.finalExam.forEach((question, i) => {
                if (finalExamAnswers[i] === question.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / currentCourse.finalExam.length) * 100);
            
            // Check if passed (65% or higher)
            if (score >= 65) {
                // Course completed!
                currentUser.progress.courses[currentCourse.id].completed = true;
                currentUser.progress.courses[currentCourse.id].finalExamScore = score;
                currentUser.progress.courses[currentCourse.id].completionDate = new Date().toISOString();
                
                updateUserData();
                updateCourseProgressDisplay();
                
                // Show certificate
                showCertificate();
            } else {
                showToast(`You scored ${score}%. You need 65% to pass the final exam. Please review the course and try again.`, 'error');
                document.getElementById('finalExamModal').style.display = 'none';
                document.getElementById('coursePlayerModal').style.display = 'flex';
            }
        }
        
        function showCertificate() {
            // Set certificate details
            document.getElementById('certificateUserName').textContent = currentUser.name;
            document.getElementById('certificateCourseName').textContent = currentCourse.title;
            document.getElementById('certificateDate').textContent = new Date().toLocaleDateString();
            
            // Hide exam modal and show certificate
            document.getElementById('finalExamModal').style.display = 'none';
            document.getElementById('completionModal').style.display = 'flex';
        }
        
        function downloadCertificate() {
            // In a real application, this would generate a PDF certificate
            // For this demo, we'll just show a message
            showToast('Certificate download would start in a real application!');
        }
        
        function closeCompletionModal() {
            document.getElementById('completionModal').style.display = 'none';
            document.getElementById('coursePlayerModal').style.display = 'none';
            
            // Update course progress on main page
            updateCourseProgressDisplay();
        }
        
        function updateCourseProgressDisplay() {
            if (currentUser && currentUser.progress.courses) {
                Object.keys(currentUser.progress.courses).forEach(courseId => {
                    const courseProgress = currentUser.progress.courses[courseId];
                    const progressText = document.getElementById(`${courseId}Progress`);
                    const progressBar = document.getElementById(`${courseId}ProgressBar`);
                    
                    if (progressText && progressBar) {
                        progressText.textContent = `${courseProgress.progress}%`;
                        progressBar.style.width = `${courseProgress.progress}%`;
                    }
                });
            }
        }
        
        // Helper function to format time
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Initialize course system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set up close buttons for modals
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        });
    </script>

    <!-- Interactive Components --><!---------------------------------------------------------------------------------------------INTERACTIVE COMPONENTS------------------------------------------------------->
    <section class="section section-light" id="interactive">
        <div class="container">
            <h2 class="section-title">Interactive Learning</h2>
            
            <!-- Carbon Footprint Calculator -->
            <div class="interactive-section">
                <h3><i class="fas fa-shoe-prints"></i> Carbon Footprint Calculator</h3>
                <p>Calculate your personal carbon footprint and learn how to reduce it with actionable recommendations.</p>
                
                <div class="simulation-container">
                    <div class="form-group">
                        <label for="transport"><i class="fas fa-car"></i> How do you primarily travel?</label>
                        <select id="transport" class="form-control">
                            <option value="car">Car (alone)</option>
                            <option value="carpool">Car (carpool)</option>
                            <option value="public">Public Transport</option>
                            <option value="bike">Bicycle/Walking</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="energy"><i class="fas fa-bolt"></i> What is your main energy source at home?</label>
                        <select id="energy" class="form-control">
                            <option value="fossil">Fossil Fuels</option>
                            <option value="mixed">Mixed Sources</option>
                            <option value="renewable">Renewable Energy</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="diet"><i class="fas fa-utensils"></i> What best describes your diet?</label>
                        <select id="diet" class="form-control">
                            <option value="meatHeavy">Heavy Meat Consumption</option>
                            <option value="meatModerate">Moderate Meat Consumption</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="vegan">Vegan</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-green" onclick="calculateFootprint()"><i class="fas fa-calculator"></i> Calculate My Footprint</button>
                    
                    <div class="result-container" id="footprintResult">
                        <h4><i class="fas fa-chart-pie"></i> Your Carbon Footprint</h4>
                        <p id="footprintValue"></p>
                        <p id="footprintTips"></p>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Virtual Game Drive --><!---------------------------------------------------------------------------------------------VIRTUAL GAME DRIVE------------------------------------------------------->
            <div class="interactive-section">
                <h3><i class="fas fa-safari"></i> Enhanced Virtual Game Drive Guidebook</h3>
                <p>Explore the African savanna and learn about its flora, fauna, and conservation challenges through interactive hotspots.</p>
                
                <div class="game-drive-container">
                    <div class="game-drive-map">
                        <div class="hotspot" style="top: 30%; left: 20%;" onclick="showHotspotInfo('lion')">
                            <i class="fas fa-paw"></i>
                        </div>
                        <div class="hotspot" style="top: 60%; left: 50%;" onclick="showHotspotInfo('baobab')">
                            <i class="fas fa-tree"></i>
                        </div>
                        <div class="hotspot" style="top: 40%; left: 70%;" onclick="showHotspotInfo('elephant')">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <div class="hotspot" style="top: 70%; left: 30%;" onclick="showHotspotInfo('rhino')">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="hotspot" style="top: 20%; left: 60%;" onclick="showHotspotInfo('giraffe')">
                            <i class="fas fa-horse"></i>
                        </div>
                        
                        <div class="hotspot-info" id="lionInfo">
                            <h4>African Lion</h4>
                            <p>The African lion is a vulnerable species due to habitat loss and human-wildlife conflict. Conservation efforts focus on protected areas and community engagement.</p>
                            <button class="btn btn-primary" onclick="hideHotspotInfo()">Close</button>
                        </div>
                        
                        <div class="hotspot-info" id="baobabInfo">
                            <h4>Baobab Tree</h4>
                            <p>Known as the "Tree of Life," baobabs can live for thousands of years and provide essential resources for both wildlife and local communities.</p>
                            <button class="btn btn-primary" onclick="hideHotspotInfo()">Close</button>
                        </div>
                        
                        <div class="hotspot-info" id="elephantInfo">
                            <h4>African Elephant</h4>
                            <p>These keystone species shape their ecosystem but face threats from poaching and habitat fragmentation. Anti-poaching initiatives are critical for their survival.</p>
                            <button class="btn btn-primary" onclick="hideHotspotInfo()">Close</button>
                        </div>
                        
                        <div class="hotspot-info" id="rhinoInfo">
                            <h4>Black Rhino</h4>
                            <p>Critically endangered due to poaching for their horns, black rhinos are protected in reserves with armed anti-poaching units.</p>
                            <button class="btn btn-primary" onclick="hideHotspotInfo()">Close</button>
                        </div>
                        
                        <div class="hotspot-info" id="giraffeInfo">
                            <h4>Masai Giraffe</h4>
                            <p>These tall herbivores are facing a "silent extinction" due to habitat loss and illegal hunting. Conservation programs focus on habitat protection.</p>
                            <button class="btn btn-primary" onclick="hideHotspotInfo()">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Habitat Match Game -->
            <div class="interactive-section">
                <h3><i class="fas fa-gamepad"></i> Habitat Match Challenge</h3>
                <p>Match animals to their correct habitats, food sources, and predators! Learn about ecosystems through this fun matching game.</p>
                
                <div class="habitat-match-container">
                    <div class="game-controls">
                        <div class="difficulty-selector">
                            <button class="difficulty-btn active" data-difficulty="easy">Easy</button>
                            <button class="difficulty-btn" data-difficulty="medium">Medium</button>
                            <button class="difficulty-btn" data-difficulty="hard">Hard</button>
                        </div>
                        <div class="game-score">Score: <span id="matchScore">0</span></div>
                        <div class="game-timer">Time: <span id="matchTimer">02:00</span></div>
                    </div>
                    
                    <div class="animal-selector" id="animalSelector">
                        <!-- Animal options will be populated by JavaScript -->
                    </div>
                    
                    <div class="habitat-match-game" id="habitatMatchGame">
                        <div class="game-area" id="matchGameArea">
                            <!-- Game elements will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="game-message" id="matchGameMessage">
                        <h3 id="matchMessageTitle">Game Over!</h3>
                        <p id="matchMessageText">You didn't make it this time. Try again!</p>
                        <button class="btn btn-primary" id="restartMatchGameBtn">Play Again</button>
                    </div>
                    
                    <button class="btn btn-green" id="startMatchGameBtn" style="width: 100%; margin-top: 1.5rem;"><i class="fas fa-play"></i> Start Game</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Real-World Scenario --><!---------------------------------------------------------------------------------------------REAL-WORLD SCENARIO------------------------------------------------------->
    <section class="section" id="scenario">
        <div class="container">
            <h2 class="section-title">Real-World Environmental Challenge</h2>
            
            <div class="interactive-section">
                <h3><i class="fas fa-recycle"></i> Waste Management in Schools</h3>
                <p>Your school produces significant waste daily. How can you implement an effective waste reduction and recycling program? Use the resources below to develop your solution.</p>
                
                <div class="scenario-resources">
                    <div class="resource-card shuffle-card">
                        <h4><i class="fas fa-file-pdf"></i> Biodiversity & Ecosystems Guide</h4>
                        <p>Learn about ecosystem relationships to understand waste impacts</p>
                        <a href="#" class="btn btn-outline" id="biodiversityResource"><i class="fas fa-download"></i> Download PDF</a>
                    </div>
                    
                    <div class="resource-card shuffle-card" style="animation-delay: 0.2s;">
                        <h4><i class="fas fa-file-pdf"></i> Pollution & Conservation Guide</h4>
                        <p>Understand different types of pollution and conservation strategies</p>
                        <a href="#" class="btn btn-outline" id="pollutionResource"><i class="fas fa-download"></i> Download PDF</a>
                    </div>
                    
                    <div class="resource-card shuffle-card" style="animation-delay: 0.4s;">
                        <h4><i class="fas fa-file-pdf"></i> Sustainable Development Guide</h4>
                        <p>Learn how to balance human needs with environmental protection</p>
                        <a href="#" class="btn btn-outline" id="sustainabilityResource"><i class="fas fa-download"></i> Download PDF</a>
                    </div>
                </div>
                
                <div class="simulation-container">
                    <div class="form-group">
                        <label for="solution"><i class="fas fa-lightbulb"></i> <span id="scenarioQuestion">Propose your solution to reduce school waste:</span></label>
                        <textarea id="solution" class="form-control journal-entry" placeholder="Describe your approach..."></textarea>
                    </div>
                    
                    <button class="btn btn-green" id="submitSolution"><i class="fas fa-paper-plane"></i> Submit Solution</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Self-Assessment Tools --><!---------------------------------------------------------------------------------------------SELF-ASSESSMENT TOOLS------------------------------------------------------->
    <section class="section section-light" id="tools">
        <div class="container">
            <h2 class="section-title">Self-Assessment Tools</h2>
            
            <div class="assessment-tools">
                <!-- Checklist -->
                <div class="assessment-tool">
                    <h3><i class="fas fa-check-circle"></i> Learning Progress Checklist</h3>
                    <p>Track your completion of activities and lessons to monitor your environmental education journey.</p>
                    
                    <div class="checklist-item">
                        <input type="checkbox" id="lesson1" onchange="updateProgress()">
                        <label for="lesson1">Complete Biodiversity & Ecosystems lesson</label>
                    </div>
                    
                    <div class="checklist-item">
                        <input type="checkbox" id="lesson2" onchange="updateProgress()">
                        <label for="lesson2">Complete Pollution & Conservation lesson</label>
                    </div>
                    
                    <div class="checklist-item">
                        <input type="checkbox" id="lesson3" onchange="updateProgress()">
                        <label for="lesson3">Complete Sustainable Development lesson</label>
                    </div>
                    
                    <div class="checklist-item">
                        <input type="checkbox" id="simulation" onchange="updateProgress()">
                        <label for="simulation">Use Carbon Footprint Calculator</label>
                    </div>
                    
                    <div class="checklist-item">
                        <input type="checkbox" id="game" onchange="updateProgress()">
                        <label for="game">Play Habitat Match Game</label>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="checklistProgress" style="width: 0%;"></div>
                    </div>
                    <p id="progressText" style="margin-top: 0.5rem;">0 of 5 activities completed</p>
                </div>
                
                <!-- Reflective Journal -->
                <div class="assessment-tool">
                    <h3><i class="fas fa-book"></i> Reflective Journal</h3>
                    <p>Record your thoughts and learning experiences to deepen your understanding of environmental concepts.</p>
                    
                    <textarea class="journal-entry" id="reflectiveJournal" placeholder="What did you learn today? How will you apply this knowledge?"></textarea>
                    <button class="btn btn-green" style="margin-top: 1rem;" onclick="saveJournal()"><i class="fas fa-save"></i> Save Entry</button>
                </div>
                
                <!-- Rating Scale -->
                <div class="assessment-tool">
                    <h3><i class="fas fa-star"></i> Self-Evaluation Rating</h3>
                    <p>Rate your understanding of environmental concepts to identify areas for improvement.</p>
                    
                    <div class="form-group">
                        <label>My understanding of biodiversity:</label>
                        <div class="star-rating" id="biodiversityRating">
                            <span class="star" onclick="selectStar(this, 'biodiversity', 1)"></span>
                            <span class="star" onclick="selectStar(this, 'biodiversity', 2)"></span>
                            <span class="star" onclick="selectStar(this, 'biodiversity', 3)"></span>
                            <span class="star" onclick="selectStar(this, 'biodiversity', 4)"></span>
                            <span class="star" onclick="selectStar(this, 'biodiversity', 5)"></span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>My ability to propose environmental solutions:</label>
                        <div class="star-rating" id="solutionsRating">
                            <span class="star" onclick="selectStar(this, 'solutions', 1)"></span>
                            <span class="star" onclick="selectStar(this, 'solutions', 2)"></span>
                            <span class="star" onclick="selectStar(this, 'solutions', 3)"></span>
                            <span class="star" onclick="selectStar(this, 'solutions', 4)"></span>
                            <span class="star" onclick="selectStar(this, 'solutions', 5)"></span>
                        </div>
                    </div>
                    
                    <button class="btn btn-green" onclick="saveRatings()"><i class="fas fa-chart-bar"></i> Save Ratings</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Quizlet Section --><!---------------------------------------------------------------------------------------------QUIZLET------------------------------------------------------->
    <section class="section" id="quizlet">
        <div class="container">
            <h2 class="section-title">Quizlet - Test Your Knowledge</h2>
            
            <div class="quiz-progress-tab">
                <h3><i class="fas fa-brain"></i> Interactive Quizzes</h3>
                <p>Test your understanding of environmental concepts with these interactive quizzes. Each quiz covers different topics from the curriculum.</p>
                
                <div class="cards-container">
                    <div class="card">
                        <div class="card-img" style="background-image: url('https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
                        <div class="card-content">
                            <h3>Ecosystems & Biodiversity Quiz</h3>
                            <p>Test your knowledge of ecosystems, food chains, and biodiversity with this 15-question quiz.</p>
                            <div class="card-footer">
                                <span><i class="far fa-clock"></i> 10 min</span>
                                <button class="btn btn-green" onclick="startQuizlet('ecosystems')"><i class="fas fa-play"></i> Start Quiz</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-img" style="background-image: url('https://images.unsplash.com/photo-1569163139394-de44cb2c8cb7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
                        <div class="card-content">
                            <h3>Climate Change Quiz</h3>
                            <p>Challenge yourself with questions about climate science, impacts, and solutions.</p>
                            <div class="card-footer">
                                <span><i class="far fa-clock"></i> 12 min</span>
                                <button class="btn btn-green" onclick="startQuizlet('climate')"><i class="fas fa-play"></i> Start Quiz</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-img" style="background-image: url('https://images.unsplash.com/photo-1470115636492-6d2b56f9146d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');"></div>
                        <div class="card-content">
                            <h3>Conservation & Sustainability Quiz</h3>
                            <p>Assess your understanding of conservation strategies and sustainable practices.</p>
                            <div class="card-footer">
                                <span><i class="far fa-clock"></i> 15 min</span>
                                <button class="btn btn-green" onclick="startQuizlet('conservation')"><i class="fas fa-play"></i> Start Quiz</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Progress Section --><!---------------------------------------------------------------------------------------------PROGRESS SECTION------------------------------------------------------->
    <section class="section section-light" id="progress">
        <div class="container">
            <h2 class="section-title">Your Learning Progress</h2>
            
            <div class="quiz-progress-tab">
                <h3><i class="fas fa-chart-line"></i> Your Quiz Results</h3>
                <p>Review your quiz attempts and see which questions you answered correctly or incorrectly to improve your learning.</p>
                
                <div class="progress-table-container">
                    <table class="progress-table">
                        <thead>
                            <tr>
                                <th>Quiz Name</th>
                                <th>Date</th>
                                <th>Score</th>
                                <th>Correct Answers</th>
                                <th>Wrong Answers</th>
                                <th>Review</th>
                                <th>Reattempt</th>
                            </tr>
                        </thead>
                        <tbody id="quizProgressTable">
                            <!-- Quiz progress data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div id="quizReviewDetails" style="display: none; margin-top: 2rem;">
                    <h4>Quiz Review: <span id="reviewQuizName"></span></h4>
                    <p><strong>Date:</strong> <span id="reviewQuizDate"></span> | <strong>Score:</strong> <span id="reviewQuizScore"></span></p>
                    <div id="quizQuestionsReview">
                        <!-- Quiz questions and answers will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Achievements Section --><!---------------------------------------------------------------------------------------------ACHIEVEMENTS SECTION------------------------------------------------------->
    <section class="section" id="achievements">
        <div class="container">
            <h2 class="section-title">Your Achievements</h2>
            
            <div class="achievements-container">
                <!-- 25 badges will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Pop-up Quiz --><!---------------------------------------------------------------------------------------------POP-UP QUIZ------------------------------------------------------->
    <div class="popup-quiz" id="popupQuiz">
        <div class="popup-content">
            <h4><i class="fas fa-brain"></i> Quick Quiz!</h4>
            <p>Test your knowledge with a 5-question quiz</p>
            <button class="btn btn-primary" onclick="startQuickQuiz()">Start Quiz</button>
        </div>
    </div>

    <!-- Guidebook Modal -->
    <div class="modal" id="guidebookModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>EcoLearn Guidebook</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/b6Ua_zWDH6U" allowfullscreen></iframe>
                </div>
                <p class="guidebook-description">This guidebook provides an overview of EcoLearn's features and how to make the most of your environmental education journey.</p>
            </div>
        </div>
    </div>

    <!-- Profile Picture Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h3>Profile Picture</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="profile-preview">
                <img id="profilePreview" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Profile Preview">
            </div>
            <input type="file" id="profileUpload" accept="image/*" style="display: none;">
            <div class="profile-actions">
                <button class="btn btn-primary" id="uploadBtn">Upload New Picture</button>
                <button class="btn btn-danger" id="deleteBtn">Delete Picture</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Login to EcoLearn</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-green" style="width: 100%;"><i class="fas fa-sign-in-alt"></i> Login</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;">Don't have an account? <a href="#" id="switchToRegister">Register here</a></p>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create an Account</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword">Confirm Password</label>
                        <input type="password" id="registerConfirmPassword" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-green" style="width: 100%;"><i class="fas fa-user-plus"></i> Register</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;">Already have an account? <a href="#" id="switchToLogin">Login here</a></p>
            </div>
        </div>
    </div>

    <!-- Assessment Modal -->
    <div class="modal" id="assessmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="assessmentTitle">Assessment</h3>
                <div class="quiz-timer" id="quizTimer">45:00</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="quiz-container">
                    <div id="quizQuestions"></div>
                    <div class="quiz-navigation">
                        <button class="btn btn-outline" id="prevQuestion"><i class="fas fa-arrow-left"></i> Previous</button>
                        <button class="btn btn-green" id="nextQuestion">Next <i class="fas fa-arrow-right"></i></button>
                        <button class="btn btn-green" id="submitQuiz" style="display: none;"><i class="fas fa-paper-plane"></i> Submit Assessment</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Quiz Modal -->
    <div class="modal" id="quickQuizModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Quick Quiz</h3>
                <div class="quiz-timer" id="quickQuizTimer">02:00</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="quiz-container">
                    <div id="quickQuizQuestions"></div>
                    <div class="quiz-navigation">
                        <button class="btn btn-outline" id="prevQuickQuestion"><i class="fas fa-arrow-left"></i> Previous</button>
                        <button class="btn btn-green" id="nextQuickQuestion">Next <i class="fas fa-arrow-right"></i></button>
                        <button class="btn btn-green" id="submitQuickQuiz" style="display: none;"><i class="fas fa-paper-plane"></i> Submit Quiz</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quizlet Modal -->
    <div class="modal" id="quizletModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="quizletTitle">Quizlet</h3>
                <div class="quiz-timer" id="quizletTimer">15:00</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="quiz-container">
                    <div id="quizletQuestions"></div>
                    <div class="quiz-navigation">
                        <button class="btn btn-outline" id="prevQuizletQuestion"><i class="fas fa-arrow-left"></i> Previous</button>
                        <button class="btn btn-green" id="nextQuizletQuestion">Next <i class="fas fa-arrow-right"></i></button>
                        <button class="btn btn-green" id="submitQuizlet" style="display: none;"><i class="fas fa-paper-plane"></i> Submit Quiz</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Certificate Modal -->
    <div class="modal" id="certificateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Certificate of Completion</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="certificateContent" style="text-align: center; padding: 2rem; border: 2px solid var(--primary-green); border-radius: 8px;">
                    <h2 style="color: var(--primary-green); margin-bottom: 1rem;">Certificate of Achievement</h2>
                    <p>This certifies that</p>
                    <h3 id="certificateName" style="margin: 1rem 0;">Student Name</h3>
                    <p>has successfully completed the</p>
                    <h4 id="certificateCourse" style="margin: 1rem 0;">Course Name</h4>
                    <p>with a score of <span id="certificateScore" style="font-weight: bold;">XX%</span></p>
                    <div style="margin-top: 2rem;">
                        <p>Date: <span id="certificateDate">Month Day, Year</span></p>
                        <div style="margin-top: 2rem;">
                            <div style="display: inline-block; text-align: center; margin: 0 2rem;">
                                <div style="border-bottom: 1px solid #000; width: 200px; margin-bottom: 0.5rem;"></div>
                                <p>Instructor Signature</p>
                            </div>
                            <div style="display: inline-block; text-align: center; margin: 0 2rem;">
                                <div style="border-bottom: 1px solid #000; width: 200px; margin-bottom: 0.5rem;"></div>
                                <p>Date</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-green" onclick="printCertificate()"><i class="fas fa-print"></i> Print Certificate</button>
                <button class="btn btn-outline" onclick="closeCertificate()">Close</button>
            </div>
        </div>
    </div>

    <!-- Badge Details Modal -->
    <div class="modal" id="badgeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="badgeTitle">Badge Details</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="badge-details" id="badgeDetails">
                    <!-- Badge details will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal" id="feedbackModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Feedback Form</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="feedbackForm">
                    <div class="form-group">
                        <label for="feedbackName">Name</label>
                        <input type="text" id="feedbackName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="feedbackEmail">Email</label>
                        <input type="email" id="feedbackEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="feedbackType">Feedback Type</label>
                        <select id="feedbackType" class="form-control">
                            <option value="general">General Feedback</option>
                            <option value="bug">Bug Report</option>
                            <option value="suggestion">Feature Suggestion</option>
                            <option value="content">Content Issue</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="feedbackMessage">Message</label>
                        <textarea id="feedbackMessage" class="form-control journal-entry" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-green" style="width: 100%;"><i class="fas fa-paper-plane"></i> Submit Feedback</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div class="modal" id="privacyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Privacy Policy</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="policy-content">
                    <h2>Privacy Policy</h2>
                    <p>Last updated: January 1, 2025</p>
                    
                    <h3>1. Information We Collect</h3>
                    <p>We collect information you provide directly to us, such as when you create an account, complete a profile, participate in interactive features, or communicate with us. The types of information we may collect include your name, email address, profile picture, and any other information you choose to provide.</p>
                    
                    <h3>2. How We Use Your Information</h3>
                    <p>We use the information we collect to:</p>
                    <ul>
                        <li>Provide, maintain, and improve our services</li>
                        <li>Personalize your learning experience</li>
                        <li>Track your progress and achievements</li>
                        <li>Respond to your comments, questions, and requests</li>
                        <li>Send you technical notices and support messages</li>
                    </ul>
                    
                    <h3>3. Information Sharing</h3>
                    <p>We do not sell, trade, or otherwise transfer your personally identifiable information to outside parties. This does not include trusted third parties who assist us in operating our website, conducting our business, or servicing you, so long as those parties agree to keep this information confidential.</p>
                    
                    <h3>4. Data Security</h3>
                    <p>We implement appropriate technical and organizational security measures to protect your personal information against accidental or unlawful destruction, loss, alteration, unauthorized disclosure, or access.</p>
                    
                    <h3>5. Your Rights</h3>
                    <p>You have the right to access, correct, or delete your personal information. You can do this by logging into your account and updating your profile information or by contacting us directly.</p>
                    
                    <h3>6. Contact Us</h3>
                    <p>If you have any questions about this Privacy Policy, please contact us at privacy@ecolearn.org.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closePrivacyPolicy()">Close</button>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div class="modal" id="termsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Terms of Service</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="policy-content">
                    <h2>Terms of Service</h2>
                    <p>Last updated: January 1, 2025</p>
                    
                    <h3>1. Acceptance of Terms</h3>
                    <p>By accessing and using EcoLearn, you accept and agree to be bound by the terms and provision of this agreement.</p>
                    
                    <h3>2. Use License</h3>
                    <p>Permission is granted to temporarily use EcoLearn for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title.</p>
                    
                    <h3>3. User Account</h3>
                    <p>When you create an account with us, you must provide information that is accurate, complete, and current at all times. Failure to do so constitutes a breach of the Terms, which may result in immediate termination of your account.</p>
                    
                    <h3>4. Intellectual Property</h3>
                    <p>The Service and its original content, features, and functionality are and will remain the exclusive property of EcoLearn and its licensors. The Service is protected by copyright, trademark, and other laws of both the United States and foreign countries.</p>
                    
                    <h3>5. Links To Other Web Sites</h3>
                    <p>Our Service may contain links to third-party web sites or services that are not owned or controlled by EcoLearn. We have no control over, and assume no responsibility for, the content, privacy policies, or practices of any third party web sites or services.</p>
                    
                    <h3>6. Termination</h3>
                    <p>We may terminate or suspend your account immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms.</p>
                    
                    <h3>7. Limitation of Liability</h3>
                    <p>In no event shall EcoLearn, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from your access to or use of or inability to access or use the Service.</p>
                    
                    <h3>8. Governing Law</h3>
                    <p>These Terms shall be governed and construed in accordance with the laws of South Africa, without regard to its conflict of law provisions.</p>
                    
                    <h3>9. Changes</h3>
                    <p>We reserve the right, at our sole discretion, to modify or replace these Terms at any time. By continuing to access or use our Service after those revisions become effective, you agree to be bound by the revised terms.</p>
                    
                    <h3>10. Contact Us</h3>
                    <p>If you have any questions about these Terms, please contact us at terms@ecolearn.org.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeTerms()">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>EcoLearn</h3>
                    <p>Comprehensive environmental education for secondary school learners based on Life Sciences CAPs curriculum. Empowering the next generation of environmental stewards.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#home"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="#about"><i class="fas fa-info-circle"></i> About Us</a></li>
                        <li><a href="#lessons"><i class="fas fa-book"></i> Lessons</a></li>
                        <li><a href="#courses"><i class="fas fa-graduation-cap"></i> Courses</a></li>
                        <li><a href="#interactive"><i class="fas fa-gamepad"></i> I-Learning</a></li>
                        <li><a href="#scenario"><i class="fas fa-globe"></i> Real-World Scenarios</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul class="footer-links">
                        <li><a href="#" class="resource-link" data-resource="biodiversity"><i class="fas fa-file-pdf"></i> Biodiversity & Ecosystems</a></li>
                        <li><a href="#" class="resource-link" data-resource="pollution"><i class="fas fa-file-pdf"></i> Pollution & Conservation</a></li>
                        <li><a href="#" class="resource-link" data-resource="sustainability"><i class="fas fa-file-pdf"></i> Sustainable Development</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contact & Support</h3>
                    <ul class="footer-links">
                        <li><a href="mailto:info@ecolearn.org"><i class="fas fa-envelope"></i> info@ecolearn.org</a></li>
                        <li><a href="#" id="feedbackLink"><i class="fas fa-comment-dots"></i> Feedback Form</a></li>
                        <li><a href="#" id="privacyLink"><i class="fas fa-shield-alt"></i> Privacy Policy</a></li>
                        <li><a href="#" id="termsLink"><i class="fas fa-file-contract"></i> Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 EcoLearn Environmental Education. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // User Authentication System
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('ecolearn_users')) || [];
        
        // ProgressTracker Class for profile picture management
        class ProgressTracker {
            constructor() {
                this.progress = JSON.parse(localStorage.getItem('ecolearn-progress')) || {
                    profilePicture: null
                };
            }

            saveProfilePicture(imageData) {
                this.progress.profilePicture = imageData;
                this.saveProgress();
                this.updateProfilePicture();
            }

            deleteProfilePicture() {
                this.progress.profilePicture = null;
                this.saveProgress();
                this.updateProfilePicture();
            }

            saveProgress() {
                localStorage.setItem('ecolearn-progress', JSON.stringify(this.progress));
            }

            updateProfilePicture() {
                const profileImage = document.getElementById('profileImage');
                const profilePreview = document.getElementById('profilePreview');
                
                if (this.progress.profilePicture) {
                    profileImage.src = this.progress.profilePicture;
                    profilePreview.src = this.progress.profilePicture;
                } else {
                    profileImage.src = 'https://randomuser.me/api/portraits/men/32.jpg';
                    profilePreview.src = 'https://randomuser.me/api/portraits/men/32.jpg';
                }
            }
        }

        // Modal functionality
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const startLearningBtn = document.getElementById('startLearningBtn');
        const exploreBtn = document.getElementById('exploreBtn');
        const guidebookBtn = document.getElementById('guidebookBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const guidebookModal = document.getElementById('guidebookModal');
        const assessmentModal = document.getElementById('assessmentModal');
        const quickQuizModal = document.getElementById('quickQuizModal');
        const quizletModal = document.getElementById('quizletModal');
        const certificateModal = document.getElementById('certificateModal');
        const feedbackModal = document.getElementById('feedbackModal');
        const profileModal = document.getElementById('profileModal');
        const badgeModal = document.getElementById('badgeModal');
        const privacyModal = document.getElementById('privacyModal');
        const termsModal = document.getElementById('termsModal');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const switchToRegister = document.getElementById('switchToRegister');
        const switchToLogin = document.getElementById('switchToLogin');
        const authButtons = document.getElementById('authButtons');
        const userInfo = document.getElementById('userInfo');
        const usernameDisplay = document.getElementById('usernameDisplay');
        const popupQuiz = document.getElementById('popupQuiz');
        const feedbackLink = document.getElementById('feedbackLink');
        const privacyLink = document.getElementById('privacyLink');
        const termsLink = document.getElementById('termsLink');
        const toast = document.getElementById('toast');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const navLinksContainer = document.getElementById('navLinks');
        
        // Set up profile dropdown
        const profileToggle = document.getElementById('userInfo');
        const profileDropdown = document.getElementById('profileDropdown');
        const editToggle = document.getElementById('editToggle');
        const editSubmenu = document.getElementById('editSubmenu');
        const uploadBtn = document.getElementById('uploadBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const profileUpload = document.getElementById('profileUpload');
        
        // Check if user is logged in on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            updateProgress();
            initializeHabitatMatchGame();
            loadQuizProgress();
            setupVideoTracking();
            setupNavigation();
            setupScrollEffects();
            initializeBadges();
            
            // Initialize progress tracker
            const progressTracker = new ProgressTracker();
            
            // Set up profile picture management
            setupProfilePictureManagement(progressTracker);
            
            // Show popup quiz after 30 seconds if user is logged in
            if (currentUser) {
                setTimeout(() => {
                    popupQuiz.style.display = 'block';
                }, 30000);
            }
        });
        
        // Setup profile picture management
        function setupProfilePictureManagement(progressTracker) {
            // Toggle main dropdown when clicking the profile
            profileToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const visible = profileDropdown.style.display === 'block';
                profileDropdown.style.display = visible ? 'none' : 'block';
                editSubmenu.style.display = 'none';
            });

            // Toggle edit submenu
            editToggle.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const visible = editSubmenu.style.display === 'block';
                editSubmenu.style.display = visible ? 'none' : 'block';
            });

            // Hide dropdowns when clicking outside
            document.addEventListener('click', () => {
                profileDropdown.style.display = 'none';
                editSubmenu.style.display = 'none';
            });

            // Profile picture functionality
            document.getElementById('viewProfile').addEventListener('click', (e) => {
                e.preventDefault();
                profileModal.style.display = 'flex';
            });

            document.getElementById('uploadProfilePic').addEventListener('click', (e) => {
                e.preventDefault();
                profileModal.style.display = 'flex';
            });

            document.getElementById('deleteProfilePic').addEventListener('click', (e) => {
                e.preventDefault();
                progressTracker.deleteProfilePicture();
                profileModal.style.display = 'none';
            });

            document.getElementById('closeModal').addEventListener('click', () => {
                profileModal.style.display = 'none';
            });

            uploadBtn.addEventListener('click', () => {
                profileUpload.click();
            });

            profileUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        progressTracker.saveProfilePicture(event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });

            deleteBtn.addEventListener('click', () => {
                progressTracker.deleteProfilePicture();
                profileModal.style.display = 'none';
            });

            // Mobile menu toggle
            hamburgerMenu.addEventListener('click', () => {
                navLinksContainer.classList.toggle('active');
            });

            // Update profile picture on initial load
            progressTracker.updateProfilePicture();
        }
        
        // Setup navigation active states
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section, .hero, .about-section, .sponsors-section');
            
            window.addEventListener('scroll', function() {
                let current = '';
                const scrollPos = window.scrollY + 100;
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    
                    if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                        current = section.getAttribute('id');
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${current}`) {
                        link.classList.add('active');
                    }
                });
            });
        }
        
        // Setup scroll effects
        function setupScrollEffects() {
            window.addEventListener('scroll', function() {
                // Parallax effect for hero section
                const scrolled = window.pageYOffset;
                const parallax = document.querySelector('.hero');
                if (parallax) {
                    parallax.style.backgroundPosition = `center ${scrolled * 0.5}px`;
                }
            });
        }
        
        // Toast notification function
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.style.display = 'block';
            
            if (type === 'error') {
                toast.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
            } else if (type === 'warning') {
                toast.style.background = 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)';
            } else {
                toast.style.background = 'var(--gradient-primary)';
            }
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // Event listeners for authentication
        loginBtn.addEventListener('click', () => {
            loginModal.style.display = 'flex';
        });
        
        registerBtn.addEventListener('click', () => {
            registerModal.style.display = 'flex';
        });
        
        guidebookBtn.addEventListener('click', () => {
            guidebookModal.style.display = 'flex';
        });
        
        startLearningBtn.addEventListener('click', () => {
            if (!currentUser) {
                loginModal.style.display = 'flex';
            } else {
                document.getElementById('lessons').scrollIntoView({ behavior: 'smooth' });
            }
        });
        
        exploreBtn.addEventListener('click', () => {
            document.getElementById('courses').scrollIntoView({ behavior: 'smooth' });
        });
        
        logoutBtn.addEventListener('click', () => {
            logout();
        });
        
        feedbackLink.addEventListener('click', (e) => {
            e.preventDefault();
            feedbackModal.style.display = 'flex';
        });
        
        privacyLink.addEventListener('click', (e) => {
            e.preventDefault();
            privacyModal.style.display = 'flex';
        });
        
        termsLink.addEventListener('click', (e) => {
            e.preventDefault();
            termsModal.style.display = 'flex';
        });
        
        closeModalBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                loginModal.style.display = 'none';
                registerModal.style.display = 'none';
                guidebookModal.style.display = 'none';
                assessmentModal.style.display = 'none';
                quickQuizModal.style.display = 'none';
                quizletModal.style.display = 'none';
                certificateModal.style.display = 'none';
                feedbackModal.style.display = 'none';
                profileModal.style.display = 'none';
                badgeModal.style.display = 'none';
                privacyModal.style.display = 'none';
                termsModal.style.display = 'none';
            });
        });
        
        switchToRegister.addEventListener('click', (e) => {
            e.preventDefault();
            loginModal.style.display = 'none';
            registerModal.style.display = 'flex';
        });
        
        switchToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            registerModal.style.display = 'none';
            loginModal.style.display = 'flex';
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === loginModal) loginModal.style.display = 'none';
            if (e.target === registerModal) registerModal.style.display = 'none';
            if (e.target === guidebookModal) guidebookModal.style.display = 'none';
            if (e.target === assessmentModal) assessmentModal.style.display = 'none';
            if (e.target === quickQuizModal) quickQuizModal.style.display = 'none';
            if (e.target === quizletModal) quizletModal.style.display = 'none';
            if (e.target === certificateModal) certificateModal.style.display = 'none';
            if (e.target === feedbackModal) feedbackModal.style.display = 'none';
            if (e.target === profileModal) profileModal.style.display = 'none';
            if (e.target === badgeModal) badgeModal.style.display = 'none';
            if (e.target === privacyModal) privacyModal.style.display = 'none';
            if (e.target === termsModal) termsModal.style.display = 'none';
        });
        
        // Form submissions
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('ecolearn_currentUser', JSON.stringify(currentUser));
                checkLoginStatus();
                loginModal.style.display = 'none';
                showToast(`Login successful! Welcome back, ${user.name}!`);
                
                // Show popup quiz after login
                setTimeout(() => {
                    popupQuiz.style.display = 'block';
                }, 30000);
            } else {
                showToast('Invalid email or password. Please try again.', 'error');
            }
        });
        
        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match!', 'error');
                return;
            }
            
            if (users.find(u => u.email === email)) {
                showToast('An account with this email already exists!', 'error');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                name: name,
                email: email,
                password: password,
                progress: {
                    lessons: {},
                    courses: {},
                    assessments: {},
                    badges: [],
                    quizProgress: [],
                    videoProgress: {},
                    checklist: {},
                    ratings: {},
                    journal: []
                }
            };
            
            users.push(newUser);
            localStorage.setItem('ecolearn_users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('ecolearn_currentUser', JSON.stringify(currentUser));
            checkLoginStatus();
            registerModal.style.display = 'none';
            showToast(`Registration successful! Welcome to EcoLearn, ${name}!`);
            
            // Show popup quiz after registration
            setTimeout(() => {
                popupQuiz.style.display = 'block';
            }, 30000);
        });
        
        // Feedback form submission
        document.getElementById('feedbackForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Store feedback in localStorage (in a real app, this would be sent to a server)
            let feedbacks = JSON.parse(localStorage.getItem('ecolearn_feedbacks')) || [];
            const feedback = {
                name: document.getElementById('feedbackName').value,
                email: document.getElementById('feedbackEmail').value,
                type: document.getElementById('feedbackType').value,
                message: document.getElementById('feedbackMessage').value,
                date: new Date().toISOString()
            };
            
            feedbacks.push(feedback);
            localStorage.setItem('ecolearn_feedbacks', JSON.stringify(feedbacks));
            
            showToast('Thank you for your feedback! We appreciate your input.');
            feedbackModal.style.display = 'none';
        });
        
        // Submit solution for real-world scenario
        document.getElementById('submitSolution').addEventListener('click', () => {
            const solution = document.getElementById('solution').value;
            if (solution.trim() === '') {
                showToast('Please write your solution before submitting.', 'error');
                return;
            }
            
            showToast('Solution submitted successfully! Our team will review it.');
            document.getElementById('solution').value = '';
            
            // Mark the simulation as completed in checklist
            if (currentUser) {
                document.getElementById('simulation').checked = true;
                updateProgress();
            }
            
            // Rotate scenario questions
            rotateScenarioQuestion();
        });
        
        // Scenario question rotation
        function rotateScenarioQuestion() {
            const scenarioQuestions = [
                "Propose your solution to reduce school waste:",
                "How would you implement a recycling program in your school?",
                "What strategies would you use to reduce plastic usage in your school?",
                "How can you encourage students to participate in waste reduction efforts?",
                "What creative ideas do you have for upcycling waste materials?"
            ];
            
            let currentQuestionIndex = 0;
            
            // Get current question index
            const currentQuestion = document.getElementById('scenarioQuestion').textContent;
            currentQuestionIndex = scenarioQuestions.indexOf(currentQuestion);
            
            // Move to next question (or back to first if at the end)
            currentQuestionIndex = (currentQuestionIndex + 1) % scenarioQuestions.length;
            
            // Apply shuffle animation
            const questionElement = document.getElementById('scenarioQuestion');
            questionElement.style.animation = 'shuffleOut 0.5s forwards';
            
            setTimeout(() => {
                questionElement.textContent = scenarioQuestions[currentQuestionIndex];
                questionElement.style.animation = 'shuffleIn 0.5s forwards';
            }, 500);
        }
        
        function checkLoginStatus() {
            const storedUser = localStorage.getItem('ecolearn_currentUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                authButtons.style.display = 'none';
                userInfo.style.display = 'flex';
                usernameDisplay.textContent = currentUser.name;
                
                // Unlock content
                document.querySelectorAll('.locked-content').forEach(el => {
                    el.classList.remove('locked-content');
                    const overlay = el.querySelector('.locked-overlay');
                    if (overlay) {
                        overlay.style.display = 'none';
                    }
                });
                
                // Load user progress
                loadUserProgress();
            } else {
                currentUser = null;
                authButtons.style.display = 'flex';
                userInfo.style.display = 'none';
                
                // Lock content
                document.querySelectorAll('.card, .course-card').forEach(el => {
                    if (!el.classList.contains('locked-content')) {
                        el.classList.add('locked-content');
                        let overlay = el.querySelector('.locked-overlay');
                        if (!overlay) {
                            overlay = document.createElement('div');
                            overlay.className = 'locked-overlay';
                            overlay.innerHTML = '<i class="fas fa-lock"></i><p>Please login to access this content</p>';
                            el.appendChild(overlay);
                        } else {
                            overlay.style.display = 'flex';
                        }
                    }
                });
            }
        }
        
        function logout() {
            currentUser = null;
            localStorage.removeItem('ecolearn_currentUser');
            checkLoginStatus();
            showToast('You have been logged out successfully.');
        }
        
        function loadUserProgress() {
            if (!currentUser || !currentUser.progress) return;
            
            // Load lesson progress
            if (currentUser.progress.lessons) {
                Object.keys(currentUser.progress.lessons).forEach(lessonId => {
                    const progress = currentUser.progress.lessons[lessonId];
                    const progressBar = document.getElementById(`${lessonId}Progress`);
                    const statusText = document.getElementById(`${lessonId}Status`);
                    
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                    
                    if (statusText) {
                        if (progress === 100) {
                            statusText.textContent = 'Completed';
                            statusText.classList.add('completion-badge');
                        } else if (progress > 0) {
                            statusText.textContent = 'In Progress';
                        } else {
                            statusText.textContent = 'Not started';
                        }
                    }
                    
                    // Enable assessment button if lesson is completed
                    if (progress === 100) {
                        const assessmentBtn = document.getElementById(`assessment${lessonId.replace('lesson', '')}Btn`);
                        if (assessmentBtn) {
                            assessmentBtn.disabled = false;
                        }
                    }
                });
            }
            
            // Load course progress
            if (currentUser.progress.courses) {
                Object.keys(currentUser.progress.courses).forEach(courseId => {
                    const progress = currentUser.progress.courses[courseId];
                    const progressText = document.getElementById(`${courseId}Progress`);
                    const progressBar = document.getElementById(`${courseId}ProgressBar`);
                    
                    if (progressText) {
                        progressText.textContent = `${progress}%`;
                    }
                    
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                });
            }
            
            // Load checklist progress
            if (currentUser.progress.checklist) {
                Object.keys(currentUser.progress.checklist).forEach(itemId => {
                    const checkbox = document.getElementById(itemId);
                    if (checkbox) {
                        checkbox.checked = currentUser.progress.checklist[itemId];
                    }
                });
                updateProgress();
            }
            
            // Load ratings
            if (currentUser.progress.ratings) {
                Object.keys(currentUser.progress.ratings).forEach(ratingId => {
                    const ratingValue = currentUser.progress.ratings[ratingId];
                    const ratingScale = document.getElementById(`${ratingId}Rating`);
                    if (ratingScale) {
                        const stars = ratingScale.querySelectorAll('.star');
                        for (let i = 0; i < ratingValue; i++) {
                            stars[i].classList.add('active');
                        }
                    }
                });
            }
            
            // Load journal
            if (currentUser.progress.journal && currentUser.progress.journal.length > 0) {
                const journal = document.getElementById('reflectiveJournal');
                if (journal) {
                    journal.value = currentUser.progress.journal[currentUser.progress.journal.length - 1].text;
                }
            }
            
            // Update achievements
            updateAchievements();
        }
        
        // Video tracking system
        function setupVideoTracking() {
            // Add event listeners to video containers to track progress
            document.querySelectorAll('.video-container').forEach((container, index) => {
                const lessonId = `lesson${index + 1}`;
                
                // Add a "Mark as Completed" button for each lesson
                const completeBtn = document.createElement('button');
                completeBtn.className = 'btn btn-green';
                completeBtn.innerHTML = '<i class="fas fa-check-circle"></i> Mark as Completed';
                completeBtn.style.marginTop = '10px';
                completeBtn.style.width = '100%';
                completeBtn.addEventListener('click', () => {
                    if (currentUser) {
                        if (!currentUser.progress.lessons) {
                            currentUser.progress.lessons = {};
                        }
                        currentUser.progress.lessons[lessonId] = 100;
                        
                        // Update progress bar
                        const progressBar = document.getElementById(`${lessonId}Progress`);
                        const statusText = document.getElementById(`${lessonId}Status`);
                        
                        if (progressBar) {
                            progressBar.style.width = '100%';
                        }
                        
                        if (statusText) {
                            statusText.textContent = 'Completed';
                            statusText.classList.add('completion-badge');
                        }
                        
                        // Enable assessment button
                        const assessmentBtn = document.getElementById(`assessment${index + 1}Btn`);
                        if (assessmentBtn) {
                            assessmentBtn.disabled = false;
                        }
                        
                        // Update checklist
                        const checklistItem = document.getElementById(lessonId);
                        if (checklistItem) {
                            checklistItem.checked = true;
                            if (!currentUser.progress.checklist) {
                                currentUser.progress.checklist = {};
                            }
                            currentUser.progress.checklist[lessonId] = true;
                        }
                        
                        // Save user data
                        updateUserData();
                        updateProgress();
                        updateAchievements();
                        
                        showToast('Lesson marked as completed! You can now take the assessment.');
                    } else {
                        showToast('Please log in to track your progress.', 'error');
                    }
                });
                
                container.parentNode.insertBefore(completeBtn, container.nextSibling);
            });
        }
        
        // Enhanced Habitat Match Game
        let habitatMatchGame = {
            gameActive: false,
            selectedAnimal: null,
            difficulty: 'easy',
            score: 0,
            timeLeft: 120, // 2 minutes in seconds
            gameTimer: null,
            animals: [
                { 
                    id: 'lion', 
                    name: 'Lion', 
                    habitat: 'savanna', 
                    food: 'zebra',
                    predator: 'none',
                    emoji: '',
                    habitatColor: '#e6b87e',
                    habitatDescription: 'Grassy plains with scattered trees, home to many grazing animals.'
                },
                { 
                    id: 'fish', 
                    name: 'Fish', 
                    habitat: 'ocean', 
                    food: 'plankton',
                    predator: 'shark',
                    emoji: '',
                    habitatColor: '#1e90ff',
                    habitatDescription: 'Vast bodies of saltwater covering most of the Earth\'s surface.'
                },
                { 
                    id: 'bear', 
                    name: 'Bear', 
                    habitat: 'forest', 
                    food: 'berries',
                    predator: 'none',
                    emoji: '',
                    habitatColor: '#228b22',
                    habitatDescription: 'Dense areas with many trees, providing shelter and food for various animals.'
                },
                { 
                    id: 'penguin', 
                    name: 'Penguin', 
                    habitat: 'arctic', 
                    food: 'fish',
                    predator: 'leopard seal',
                    emoji: '',
                    habitatColor: '#f0f8ff',
                    habitatDescription: 'Icy regions near the poles with extremely cold temperatures.'
                }
            ],
            currentMatches: [],
            totalMatches: 0
        };
        
        function initializeHabitatMatchGame() {
            // Set up animal selector
            const animalSelector = document.getElementById('animalSelector');
            habitatMatchGame.animals.forEach(animal => {
                const animalOption = document.createElement('div');
                animalOption.className = 'animal-option';
                animalOption.innerHTML = `<span>${animal.emoji}</span>`;
                animalOption.setAttribute('data-animal', animal.id);
                animalOption.addEventListener('click', () => selectAnimalForMatch(animal.id));
                
                const animalName = document.createElement('div');
                animalName.className = 'animal-option-name';
                animalName.textContent = animal.name;
                
                animalOption.appendChild(animalName);
                animalSelector.appendChild(animalOption);
            });
            
            // Set up difficulty buttons
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    habitatMatchGame.difficulty = this.getAttribute('data-difficulty');
                });
            });
            
            // Set up game controls
            document.getElementById('startMatchGameBtn').addEventListener('click', startHabitatMatchGame);
            document.getElementById('restartMatchGameBtn').addEventListener('click', startHabitatMatchGame);
        }
        
        function selectAnimalForMatch(animalId) {
            document.querySelectorAll('.animal-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.animal-option[data-animal="${animalId}"]`).classList.add('selected');
            habitatMatchGame.selectedAnimal = habitatMatchGame.animals.find(a => a.id === animalId);
        }
        
        function startHabitatMatchGame() {
            if (!habitatMatchGame.selectedAnimal) {
                showToast('Please select an animal first!', 'error');
                return;
            }
            
            // Reset game state
            habitatMatchGame.gameActive = true;
            habitatMatchGame.score = 0;
            habitatMatchGame.timeLeft = 120;
            habitatMatchGame.currentMatches = [];
            habitatMatchGame.totalMatches = 3; // habitat, food, predator
            
            document.getElementById('matchScore').textContent = habitatMatchGame.score;
            document.getElementById('matchTimer').textContent = formatTime(habitatMatchGame.timeLeft);
            document.getElementById('matchGameMessage').style.display = 'none';
            
            // Clear game area
            const gameArea = document.getElementById('matchGameArea');
            gameArea.innerHTML = '';
            
            // Create game board with matching cards
            createMatchingCards();
            
            // Start game timer
            startMatchGameTimer();
            
            // Mark game as completed in checklist after playing for a while
            setTimeout(() => {
                if (currentUser && habitatMatchGame.gameActive) {
                    document.getElementById('game').checked = true;
                    updateProgress();
                }
            }, 10000);
        }
        
        function createMatchingCards() {
            const animal = habitatMatchGame.selectedAnimal;
            const gameArea = document.getElementById('matchGameArea');
            
            // Create habitat card
            const habitatCard = document.createElement('div');
            habitatCard.className = 'match-card habitat-card';
            habitatCard.innerHTML = `
                <div class="card-content">
                    <h4>Habitat</h4>
                    <p>Where does the ${animal.name} live?</p>
                    <div class="options">
                        <div class="option" data-value="savanna">Savanna</div>
                        <div class="option" data-value="ocean">Ocean</div>
                        <div class="option" data-value="forest">Forest</div>
                        <div class="option" data-value="arctic">Arctic</div>
                    </div>
                </div>
            `;
            
            // Add event listeners to options
            habitatCard.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.getAttribute('data-value') === animal.habitat) {
                        this.classList.add('correct');
                        habitatMatchGame.score += 10;
                        habitatMatchGame.currentMatches.push('habitat');
                        document.getElementById('matchScore').textContent = habitatMatchGame.score;
                        checkGameCompletion();
                    } else {
                        this.classList.add('wrong');
                    }
                });
            });
            
            gameArea.appendChild(habitatCard);
            
            // Create food card
            const foodCard = document.createElement('div');
            foodCard.className = 'match-card food-card';
            foodCard.innerHTML = `
                <div class="card-content">
                    <h4>Food Source</h4>
                    <p>What does the ${animal.name} eat?</p>
                    <div class="options">
                        <div class="option" data-value="zebra">Zebra</div>
                        <div class="option" data-value="plankton">Plankton</div>
                        <div class="option" data-value="berries">Berries</div>
                        <div class="option" data-value="fish">Fish</div>
                    </div>
                </div>
            `;
            
            // Add event listeners to options
            foodCard.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.getAttribute('data-value') === animal.food) {
                        this.classList.add('correct');
                        habitatMatchGame.score += 10;
                        habitatMatchGame.currentMatches.push('food');
                        document.getElementById('matchScore').textContent = habitatMatchGame.score;
                        checkGameCompletion();
                    } else {
                        this.classList.add('wrong');
                    }
                });
            });
            
            gameArea.appendChild(foodCard);
            
            // Create predator card
            const predatorCard = document.createElement('div');
            predatorCard.className = 'match-card predator-card';
            predatorCard.innerHTML = `
                <div class="card-content">
                    <h4>Predator</h4>
                    <p>What preys on the ${animal.name}?</p>
                    <div class="options">
                        <div class="option" data-value="none">None (apex predator)</div>
                        <div class="option" data-value="shark">Shark</div>
                        <div class="option" data-value="leopard seal">Leopard Seal</div>
                        <div class="option" data-value="human">Human</div>
                    </div>
                </div>
            `;
            
            // Add event listeners to options
            predatorCard.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.getAttribute('data-value') === animal.predator) {
                        this.classList.add('correct');
                        habitatMatchGame.score += 10;
                        habitatMatchGame.currentMatches.push('predator');
                        document.getElementById('matchScore').textContent = habitatMatchGame.score;
                        checkGameCompletion();
                    } else {
                        this.classList.add('wrong');
                    }
                });
            });
            
            gameArea.appendChild(predatorCard);
            
            // Create habitat description card
            const descriptionCard = document.createElement('div');
            descriptionCard.className = 'match-card description-card';
            descriptionCard.style.backgroundColor = animal.habitatColor;
            descriptionCard.innerHTML = `
                <div class="card-content">
                    <h4>${animal.habitat.charAt(0).toUpperCase() + animal.habitat.slice(1)} Habitat</h4>
                    <p>${animal.habitatDescription}</p>
                </div>
            `;
            
            gameArea.appendChild(descriptionCard);
        }
        
        function checkGameCompletion() {
            if (habitatMatchGame.currentMatches.length === habitatMatchGame.totalMatches) {
                // Game completed successfully
                clearInterval(habitatMatchGame.gameTimer);
                habitatMatchGame.gameActive = false;
                
                // Add bonus points for time remaining
                const timeBonus = Math.floor(habitatMatchGame.timeLeft / 10);
                habitatMatchGame.score += timeBonus;
                document.getElementById('matchScore').textContent = habitatMatchGame.score;
                
                const message = document.getElementById('matchGameMessage');
                const title = document.getElementById('matchMessageTitle');
                const text = document.getElementById('matchMessageText');
                
                title.textContent = 'Congratulations!';
                text.textContent = `You successfully matched the ${habitatMatchGame.selectedAnimal.name} to its habitat, food, and predators! You earned ${timeBonus} bonus points for time remaining.`;
                
                message.style.display = 'block';
                
                // Mark game as completed in checklist
                if (currentUser) {
                    document.getElementById('game').checked = true;
                    updateProgress();
                }
            }
        }
        
        function startMatchGameTimer() {
            if (habitatMatchGame.gameTimer) clearInterval(habitatMatchGame.gameTimer);
            
            habitatMatchGame.gameTimer = setInterval(() => {
                habitatMatchGame.timeLeft--;
                document.getElementById('matchTimer').textContent = formatTime(habitatMatchGame.timeLeft);
                
                if (habitatMatchGame.timeLeft <= 0) {
                    clearInterval(habitatMatchGame.gameTimer);
                    habitatMatchGame.gameActive = false;
                    
                    const message = document.getElementById('matchGameMessage');
                    const title = document.getElementById('matchMessageTitle');
                    const text = document.getElementById('matchMessageText');
                    
                    title.textContent = 'Time\'s Up!';
                    text.textContent = `You ran out of time! The ${habitatMatchGame.selectedAnimal.name} lives in the ${habitatMatchGame.selectedAnimal.habitat}, eats ${habitatMatchGame.selectedAnimal.food}, and is hunted by ${habitatMatchGame.selectedAnimal.predator === 'none' ? 'nothing (it\'s an apex predator)' : habitatMatchGame.selectedAnimal.predator}.`;
                    
                    message.style.display = 'block';
                }
            }, 1000);
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Carbon Footprint Calculator
        function calculateFootprint() {
            const transport = document.getElementById('transport').value;
            const energy = document.getElementById('energy').value;
            const diet = document.getElementById('diet').value;
            
            let footprint = 0;
            
            // Transport calculation
            if (transport === 'car') footprint += 4;
            else if (transport === 'carpool') footprint += 2;
            else if (transport === 'public') footprint += 1;
            
            // Energy calculation
            if (energy === 'fossil') footprint += 3;
            else if (energy === 'mixed') footprint += 2;
            else if (energy === 'renewable') footprint += 1;
            
            // Diet calculation
            if (diet === 'meatHeavy') footprint += 4;
            else if (diet === 'meatModerate') footprint += 2;
            else if (diet === 'vegetarian') footprint += 1;
            
            const resultDiv = document.getElementById('footprintResult');
            const valueP = document.getElementById('footprintValue');
            const tipsP = document.getElementById('footprintTips');
            
            valueP.textContent = `Your estimated carbon footprint is ${footprint} tons CO2 per year.`;
            
            if (footprint <= 3) {
                tipsP.textContent = "Great job! Your footprint is relatively low. Consider using public transport more often to reduce it further.";
            } else if (footprint <= 6) {
                tipsP.textContent = "Your footprint is moderate. Try reducing meat consumption and using energy-efficient appliances.";
            } else {
                tipsP.textContent = "Your footprint is high. Consider carpooling, switching to renewable energy, and reducing meat consumption.";
            }
            
            resultDiv.style.display = 'block';
            
            // Mark simulation as completed in checklist
            if (currentUser) {
                document.getElementById('simulation').checked = true;
                updateProgress();
            }
        }
        
        // Game Drive Hotspots
        function showHotspotInfo(species) {
            // Hide all hotspot info first
            document.querySelectorAll('.hotspot-info').forEach(info => {
                info.style.display = 'none';
            });
            
            // Show the selected one
            const infoElement = document.getElementById(species + 'Info');
            if (infoElement) {
                infoElement.style.display = 'block';
                infoElement.style.position = 'absolute';
                infoElement.style.top = '50%';
                infoElement.style.left = '50%';
                infoElement.style.transform = 'translate(-50%, -50%)';
                infoElement.style.zIndex = '10';
            }
        }
        
        function hideHotspotInfo() {
            document.querySelectorAll('.hotspot-info').forEach(info => {
                info.style.display = 'none';
            });
        }
        
        // Quiz Progress System
        function loadQuizProgress() {
            if (!currentUser || !currentUser.progress || !currentUser.progress.quizProgress) return;
            
            const tableBody = document.getElementById('quizProgressTable');
            tableBody.innerHTML = '';
            
            if (currentUser.progress.quizProgress.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No quiz attempts yet. Complete a lesson and take an assessment!</td></tr>';
                return;
            }
            
            // Sort by date (most recent first)
            const sortedQuizzes = [...currentUser.progress.quizProgress].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            sortedQuizzes.forEach((quiz, index) => {
                const row = document.createElement('tr');
                
                // Calculate correct and wrong answers
                let correct = 0;
                let wrong = 0;
                if (quiz.questions) {
                    quiz.questions.forEach((q, i) => {
                        if (q.userAnswer === q.correct) {
                            correct++;
                        } else {
                            wrong++;
                        }
                    });
                }
                
                row.innerHTML = `
                    <td>${quiz.quizName}</td>
                    <td>${new Date(quiz.date).toLocaleDateString()}</td>
                    <td>${quiz.score}%</td>
                    <td>${correct}</td>
                    <td>${wrong}</td>
                    <td><button class="btn btn-green" onclick="showQuizReview(${index})"><i class="fas fa-eye"></i> Review</button></td>
                    <td><button class="btn btn-outline" onclick="reattemptQuiz('${quiz.quizName}')"><i class="fas fa-redo"></i> Reattempt</button></td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        function showQuizReview(quizIndex) {
            // Sort by date to get the correct index
            const sortedQuizzes = [...currentUser.progress.quizProgress].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            const quiz = sortedQuizzes[quizIndex];
            document.getElementById('reviewQuizName').textContent = quiz.quizName;
            document.getElementById('reviewQuizDate').textContent = new Date(quiz.date).toLocaleDateString();
            document.getElementById('reviewQuizScore').textContent = `${quiz.score}%`;
            
            const reviewContainer = document.getElementById('quizQuestionsReview');
            reviewContainer.innerHTML = '';
            
            if (!quiz.questions || quiz.questions.length === 0) {
                reviewContainer.innerHTML = '<p>No question data available for this quiz.</p>';
            } else {
                quiz.questions.forEach((q, i) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'quiz-question review-question';
                    
                    let optionsHtml = '';
                    if (q.options && q.options.length > 0) {
                        q.options.forEach((option, j) => {
                            let optionClass = '';
                            let icon = '';
                            
                            if (j === q.correct) {
                                optionClass = 'correct-answer';
                                icon = '<i class="fas fa-check correct-icon"></i>';
                            } else if (j === q.userAnswer && j !== q.correct) {
                                optionClass = 'wrong-answer';
                                icon = '<i class="fas fa-times wrong-icon"></i>';
                            }
                            
                            optionsHtml += `
                                <div class="quiz-option ${optionClass}">
                                    ${icon} ${option}
                                </div>
                            `;
                        });
                    }
                    
                    questionDiv.innerHTML = `
                        <div class="question-header">
                            <h4>Question ${i + 1}</h4>
                            <button class="btn btn-outline toggle-answer" data-question="${i}">
                                <i class="fas fa-chevron-down"></i> Show/Hide Answer
                            </button>
                        </div>
                        <p>${q.question || 'No question text available'}</p>
                        <div class="quiz-options answer-container" id="answer-${i}" style="display: none;">
                            ${optionsHtml || '<p>No options available</p>'}
                        </div>
                    `;
                    
                    reviewContainer.appendChild(questionDiv);
                });
                
                // Add event listeners for toggle buttons
                document.querySelectorAll('.toggle-answer').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const questionIndex = this.getAttribute('data-question');
                        const answerContainer = document.getElementById(`answer-${questionIndex}`);
                        const isVisible = answerContainer.style.display === 'block';
                        
                        answerContainer.style.display = isVisible ? 'none' : 'block';
                        this.innerHTML = isVisible ? 
                            '<i class="fas fa-chevron-down"></i> Show Answer' : 
                            '<i class="fas fa-chevron-up"></i> Hide Answer';
                    });
                });
            }
            
            document.getElementById('quizReviewDetails').style.display = 'block';
        }
        
        function reattemptQuiz(quizName) {
            const assessmentId = Object.keys(assessments).find(key => assessments[key].title === quizName);
            if (assessmentId) {
                startAssessment(assessmentId);
            } else {
                showToast('Quiz not found. Please try a different quiz.', 'error');
            }
        }
        
        // Self-Assessment Progress Tracking
        function updateProgress() {
            const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            const completed = Array.from(checkboxes).filter(cb => cb.checked).length;
            const total = checkboxes.length;
            const progress = (completed / total) * 100;
            
            document.getElementById('checklistProgress').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${completed} of ${total} activities completed`;
            
            // Save checklist progress to user data
            if (currentUser) {
                if (!currentUser.progress.checklist) {
                    currentUser.progress.checklist = {};
                }
                
                checkboxes.forEach(checkbox => {
                    currentUser.progress.checklist[checkbox.id] = checkbox.checked;
                });
                
                updateUserData();
                updateAchievements();
            }
        }
        
        // Star Rating Selection
        function selectStar(element, ratingType, ratingValue) {
            // Remove selection from siblings
            const siblings = element.parentElement.children;
            for (let i = 0; i < siblings.length; i++) {
                siblings[i].classList.remove('active');
            }
            
            // Select current element and all previous ones
            for (let i = 0; i < ratingValue; i++) {
                siblings[i].classList.add('active');
            }
            
            // Save rating to user data
            if (currentUser) {
                if (!currentUser.progress.ratings) {
                    currentUser.progress.ratings = {};
                }
                
                currentUser.progress.ratings[ratingType] = ratingValue;
                
                updateUserData();
            }
        }
        
        function saveRatings() {
            showToast('Ratings saved successfully!');
        }
        
        function saveJournal() {
            const journalText = document.getElementById('reflectiveJournal').value;
            if (journalText.trim() === '') {
                showToast('Please write something in your journal before saving.', 'error');
                return;
            }
            
            if (currentUser) {
                if (!currentUser.progress.journal) {
                    currentUser.progress.journal = [];
                }
                
                currentUser.progress.journal.push({
                    date: new Date().toISOString(),
                    text: journalText
                });
                
                updateUserData();
                showToast('Journal entry saved successfully!');
            } else {
                showToast('Please log in to save your journal.', 'error');
            }
        }
        
        // Update user data in localStorage
        function updateUserData() {
            if (currentUser) {
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    localStorage.setItem('ecolearn_users', JSON.stringify(users));
                    localStorage.setItem('ecolearn_currentUser', JSON.stringify(currentUser));
                }
            }
        }
        
        // Initialize badges
        function initializeBadges() {
            const badges = [
                {
                    id: 'biodiversity_expert',
                    title: 'Biodiversity Expert',
                    description: 'Complete the Biodiversity & Ecosystems course with 80% or higher',
                    icon: 'fas fa-award',
                    requirements: ['Complete Biodiversity lesson', 'Score 80% or higher on assessment'],
                    earned: false
                },
                {
                    id: 'conservation_champion',
                    title: 'Conservation Champion',
                    description: 'Complete all conservation-related assessments',
                    icon: 'fas fa-recycle',
                    requirements: ['Complete Pollution & Conservation lesson', 'Complete all conservation quizzes'],
                    earned: false
                },
                {
                    id: 'sustainability_advocate',
                    title: 'Sustainability Advocate',
                    description: 'Finish 3 monthly courses',
                    icon: 'fas fa-leaf',
                    requirements: ['Complete Climate Change course', 'Complete Renewable Energy course', 'Complete Sustainable Agriculture course'],
                    earned: false
                },
                {
                    id: 'eco_warrior',
                    title: 'Eco Warrior',
                    description: 'Complete all courses and assessments',
                    icon: 'fas fa-trophy',
                    requirements: ['Complete all lessons', 'Complete all courses', 'Complete all assessments'],
                    earned: false
                },
                {
                    id: 'carbon_calculator',
                    title: 'Carbon Calculator',
                    description: 'Use the Carbon Footprint Calculator',
                    icon: 'fas fa-shoe-prints',
                    requirements: ['Calculate your carbon footprint'],
                    earned: false
                },
                {
                    id: 'game_master',
                    title: 'Game Master',
                    description: 'Complete all interactive games',
                    icon: 'fas fa-gamepad',
                    requirements: ['Play Habitat Match Game', 'Complete Virtual Game Drive'],
                    earned: false
                },
                {
                    id: 'quiz_whiz',
                    title: 'Quiz Whiz',
                    description: 'Score 90% or higher on any quiz',
                    icon: 'fas fa-brain',
                    requirements: ['Achieve 90% or higher on any quiz'],
                    earned: false
                },
                {
                    id: 'journal_keeper',
                    title: 'Journal Keeper',
                    description: 'Make 5 journal entries',
                    icon: 'fas fa-book',
                    requirements: ['Create 5 journal entries'],
                    earned: false
                },
                {
                    id: 'eco_researcher',
                    title: 'Eco Researcher',
                    description: 'Complete all research activities',
                    icon: 'fas fa-search',
                    requirements: ['Complete all research assignments'],
                    earned: false
                },
                {
                    id: 'climate_activist',
                    title: 'Climate Activist',
                    description: 'Complete the Climate Change course',
                    icon: 'fas fa-temperature-high',
                    requirements: ['Complete Climate Change Fundamentals course'],
                    earned: false
                },
                {
                    id: 'energy_expert',
                    title: 'Energy Expert',
                    description: 'Complete the Renewable Energy course',
                    icon: 'fas fa-bolt',
                    requirements: ['Complete Renewable Energy Systems course'],
                    earned: false
                },
                {
                    id: 'agriculture_guru',
                    title: 'Agriculture Guru',
                    description: 'Complete the Sustainable Agriculture course',
                    icon: 'fas fa-seedling',
                    requirements: ['Complete Sustainable Agriculture course'],
                    earned: false
                },
                {
                    id: 'water_guardian',
                    title: 'Water Guardian',
                    description: 'Complete water conservation activities',
                    icon: 'fas fa-tint',
                    requirements: ['Complete water conservation lesson', 'Submit water conservation solution'],
                    earned: false
                },
                {
                    id: 'waste_warrior',
                    title: 'Waste Warrior',
                    description: 'Complete waste management activities',
                    icon: 'fas fa-trash-alt',
                    requirements: ['Complete waste management lesson', 'Submit waste reduction solution'],
                    earned: false
                },
                {
                    id: 'pollution_preventer',
                    title: 'Pollution Preventer',
                    description: 'Complete pollution prevention activities',
                    icon: 'fas fa-industry',
                    requirements: ['Complete pollution lesson', 'Submit pollution prevention solution'],
                    earned: false
                },
                {
                    id: 'ecosystem_explorer',
                    title: 'Ecosystem Explorer',
                    description: 'Complete all ecosystem activities',
                    icon: 'fas fa-tree',
                    requirements: ['Complete ecosystem lesson', 'Complete Virtual Game Drive'],
                    earned: false
                },
                {
                    id: 'wildlife_protector',
                    title: 'Wildlife Protector',
                    description: 'Complete wildlife conservation activities',
                    icon: 'fas fa-paw',
                    requirements: ['Complete wildlife conservation lesson', 'Submit wildlife protection solution'],
                    earned: false
                },
                {
                    id: 'green_innovator',
                    title: 'Green Innovator',
                    description: 'Submit 3 environmental solutions',
                    icon: 'fas fa-lightbulb',
                    requirements: ['Submit 3 environmental solutions'],
                    earned: false
                },
                {
                    id: 'sustainable_living',
                    title: 'Sustainable Living',
                    description: 'Complete sustainable lifestyle activities',
                    icon: 'fas fa-home',
                    requirements: ['Complete sustainable living lesson', 'Submit sustainable lifestyle plan'],
                    earned: false
                },
                {
                    id: 'environmental_advocate',
                    title: 'Environmental Advocate',
                    description: 'Complete all advocacy activities',
                    icon: 'fas fa-microphone',
                    requirements: ['Complete environmental advocacy lesson', 'Submit advocacy plan'],
                    earned: false
                },
                {
                    id: 'eco_educator',
                    title: 'Eco Educator',
                    description: 'Teach someone about environmental issues',
                    icon: 'fas fa-chalkboard-teacher',
                    requirements: ['Complete teaching activity'],
                    earned: false
                },
                {
                    id: 'green_thumb',
                    title: 'Green Thumb',
                    description: 'Complete gardening activities',
                    icon: 'fas fa-leaf',
                    requirements: ['Complete gardening lesson', 'Submit gardening plan'],
                    earned: false
                },
                {
                    id: 'ocean_guardian',
                    title: 'Ocean Guardian',
                    description: 'Complete ocean conservation activities',
                    icon: 'fas fa-water',
                    requirements: ['Complete ocean conservation lesson', 'Submit ocean protection solution'],
                    earned: false
                },
                {
                    id: 'forest_protector',
                    title: 'Forest Protector',
                    description: 'Complete forest conservation activities',
                    icon: 'fas fa-tree',
                    requirements: ['Complete forest conservation lesson', 'Submit forest protection solution'],
                    earned: false
                },
                {
                    id: 'clean_air_advocate',
                    title: 'Clean Air Advocate',
                    description: 'Complete air quality activities',
                    icon: 'fas fa-wind',
                    requirements: ['Complete air quality lesson', 'Submit air quality improvement solution'],
                    earned: false
                },
                {
                    id: 'eco_leader',
                    title: 'Eco Leader',
                    description: 'Lead an environmental project',
                    icon: 'fas fa-users',
                    requirements: ['Complete leadership activities', 'Submit project plan'],
                    earned: false
                }
            ];
            
            localStorage.setItem('ecolearn_badges', JSON.stringify(badges));
            displayBadges(badges);
        }
        
        // Display badges
        function displayBadges(badges) {
            const achievementsContainer = document.querySelector('.achievements-container');
            achievementsContainer.innerHTML = '';
            
            badges.forEach(badge => {
                const badgeCard = document.createElement('div');
                badgeCard.className = 'badge-card';
                badgeCard.setAttribute('data-badge-id', badge.id);
                
                const badgeIcon = document.createElement('div');
                badgeIcon.className = `badge-icon ${badge.earned ? '' : 'locked'}`;
                badgeIcon.innerHTML = `<i class="${badge.icon}"></i>`;
                
                const badgeTitle = document.createElement('h4');
                badgeTitle.textContent = badge.title;
                
                const badgeDescription = document.createElement('p');
                badgeDescription.textContent = badge.description;
                
                badgeCard.appendChild(badgeIcon);
                badgeCard.appendChild(badgeTitle);
                badgeCard.appendChild(badgeDescription);
                
                badgeCard.addEventListener('click', () => {
                    showBadgeDetails(badge);
                });
                
                achievementsContainer.appendChild(badgeCard);
            });
        }
        
        // Show badge details
        function showBadgeDetails(badge) {
            const badgeDetails = document.getElementById('badgeDetails');
            const badgeTitle = document.getElementById('badgeTitle');
            
            badgeTitle.textContent = badge.title;
            
            let requirementsHtml = '';
            badge.requirements.forEach(req => {
                requirementsHtml += `<li>${req}</li>`;
            });
            
            badgeDetails.innerHTML = `
                <div class="badge-details-icon">
                    <i class="${badge.icon} ${badge.earned ? '' : 'locked'}"></i>
                </div>
                <div class="badge-details-content">
                    <h3>${badge.title}</h3>
                    <p>${badge.description}</p>
                    ${badge.earned ? 
                        '<div class="badge-requirements"><h4>Congratulations!</h4><p>You have successfully earned this badge by completing all requirements:</p><ul>' + requirementsHtml + '</ul></div>' :
                        '<div class="badge-requirements"><h4>Requirements:</h4><p>Complete the following to earn this badge:</p><ul>' + requirementsHtml + '</ul></div>'
                    }
                </div>
            `;
            
            badgeModal.style.display = 'flex';
        }
        
        // Update achievements based on progress
        function updateAchievements() {
            if (!currentUser) return;
            
            // Get badges from localStorage
            let badges = JSON.parse(localStorage.getItem('ecolearn_badges')) || [];
            
            // Update badge earned status based on user progress
            badges.forEach(badge => {
                badge.earned = checkBadgeRequirements(badge);
            });
            
            // Save updated badges
            localStorage.setItem('ecolearn_badges', JSON.stringify(badges));
            
            // Update display
            displayBadges(badges);
        }
        
        // Check if user meets badge requirements
        function checkBadgeRequirements(badge) {
            if (!currentUser || !currentUser.progress) return false;
            
            switch(badge.id) {
                case 'biodiversity_expert':
                    return currentUser.progress.lessons && 
                           currentUser.progress.lessons.lesson1 === 100 &&
                           currentUser.progress.assessments && 
                           currentUser.progress.assessments.biodiversity >= 80;
                
                case 'conservation_champion':
                    return currentUser.progress.lessons && 
                           currentUser.progress.lessons.lesson2 === 100 &&
                           currentUser.progress.assessments && 
                           currentUser.progress.assessments.pollution;
                
                case 'sustainability_advocate':
                    return currentUser.progress.courses && 
                           Object.values(currentUser.progress.courses).filter(p => p === 100).length >= 3;
                
                case 'eco_warrior':
                    return currentUser.progress.lessons && 
                           Object.values(currentUser.progress.lessons).filter(p => p === 100).length >= 3 &&
                           currentUser.progress.courses && 
                           Object.values(currentUser.progress.courses).filter(p => p === 100).length >= 3 &&
                           currentUser.progress.assessments && 
                           Object.keys(currentUser.progress.assessments).length >= 3;
                
                case 'carbon_calculator':
                    return currentUser.progress.checklist && 
                           currentUser.progress.checklist.simulation === true;
                
                case 'game_master':
                    return currentUser.progress.checklist && 
                           currentUser.progress.checklist.game === true;
                
                case 'quiz_whiz':
                    return currentUser.progress.quizProgress && 
                           currentUser.progress.quizProgress.some(q => q.score >= 90);
                
                case 'journal_keeper':
                    return currentUser.progress.journal && 
                           currentUser.progress.journal.length >= 5;
                
                // Add more badge requirement checks as needed
                default:
                    return false;
            }
        }
        
        // Assessment System
        let currentAssessment = null;
        let currentQuiz = null;
        let currentQuizlet = null;
        let assessmentTimer = null;
        let quizTimer = null;
        let quizletTimer = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        
        const assessments = {
            biodiversity: {
                title: "Biodiversity & Ecosystems Assessment",
                time: 45, // minutes
                questions: [
                    {
                        question: "What is biodiversity?",
                        options: [
                            "The variety of life in a particular habitat or ecosystem",
                            "The study of biological systems",
                            "The process of species evolution",
                            "The conservation of natural resources"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of the following is NOT a level of biodiversity?",
                        options: [
                            "Genetic diversity",
                            "Species diversity",
                            "Ecosystem diversity",
                            "Climate diversity"
                        ],
                        correct: 3
                    },
                    {
                        question: "What is an ecosystem?",
                        options: [
                            "A biological community of interacting organisms",
                            "A single species in a habitat",
                            "The non-living components of an environment",
                            "A protected area for wildlife"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which term describes a species that has a disproportionately large effect on its environment?",
                        options: [
                            "Keystone species",
                            "Endangered species",
                            "Invasive species",
                            "Indicator species"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the primary cause of biodiversity loss?",
                        options: [
                            "Habitat destruction",
                            "Climate change",
                            "Pollution",
                            "Overexploitation"
                        ],
                        correct: 0
                    }
                ]
            },
            pollution: {
                title: "Pollution & Conservation Assessment",
                time: 45,
                questions: [
                    {
                        question: "What is the primary source of air pollution in urban areas?",
                        options: [
                            "Vehicle emissions",
                            "Industrial processes",
                            "Agricultural activities",
                            "Natural dust"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of the following is a non-point source of water pollution?",
                        options: [
                            "Agricultural runoff",
                            "Factory discharge pipe",
                            "Sewage treatment plant",
                            "Oil tanker spill"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the main greenhouse gas contributing to global warming?",
                        options: [
                            "Carbon dioxide",
                            "Methane",
                            "Nitrous oxide",
                            "Water vapor"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of the following is a renewable resource?",
                        options: [
                            "Solar energy",
                            "Natural gas",
                            "Coal",
                            "Oil"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the '3 Rs' of waste management?",
                        options: [
                            "Reduce, Reuse, Recycle",
                            "Remove, Replace, Restore",
                            "Read, Review, Remember",
                            "Research, Report, Respond"
                        ],
                        correct: 0
                    }
                ]
            },
            sustainability: {
                title: "Sustainable Development Assessment",
                time: 45,
                questions: [
                    {
                        question: "What are the three pillars of sustainable development?",
                        options: [
                            "Environmental, Social, Economic",
                            "Political, Cultural, Technological",
                            "Educational, Health, Infrastructure",
                            "Agricultural, Industrial, Service"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which UN initiative outlines 17 global goals for sustainable development?",
                        options: [
                            "Sustainable Development Goals (SDGs)",
                            "Millennium Development Goals (MDGs)",
                            "Paris Agreement",
                            "Agenda 21"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the concept of 'carrying capacity'?",
                        options: [
                            "Maximum population size an environment can sustain",
                            "Amount of resources a country can export",
                            "Number of species an ecosystem can support",
                            "Volume of waste a landfill can hold"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of the following is an example of green infrastructure?",
                        options: [
                            "Green roofs and rain gardens",
                            "Coal-fired power plants",
                            "Highway systems",
                            "Shopping malls"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the main principle of circular economy?",
                        options: [
                            "Eliminating waste and continually using resources",
                            "Maximizing production and consumption",
                            "Focusing only on renewable energy",
                            "Prioritizing economic growth over environmental concerns"
                        ],
                        correct: 0
                    }
                ]
            }
        };
        
        const quickQuizzes = [
            {
                title: "Environmental Science Quick Quiz",
                time: 2, // minutes
                questions: [
                    {
                        question: "What is the primary gas responsible for the greenhouse effect?",
                        options: [
                            "Carbon dioxide",
                            "Oxygen",
                            "Nitrogen",
                            "Helium"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of these is a renewable energy source?",
                        options: [
                            "Solar power",
                            "Coal",
                            "Natural gas",
                            "Nuclear power"
                        ],
                        correct: 0
                    },
                    {
                        question: "What does the '3 Rs' in environmental science stand for?",
                        options: [
                            "Reduce, Reuse, Recycle",
                            "Read, Review, Remember",
                            "Research, Report, Respond",
                            "Remove, Replace, Restore"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which ecosystem has the highest biodiversity?",
                        options: [
                            "Tropical rainforest",
                            "Desert",
                            "Tundra",
                            "Grassland"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the main cause of ocean acidification?",
                        options: [
                            "Absorption of CO2 from the atmosphere",
                            "Oil spills",
                            "Plastic pollution",
                            "Overfishing"
                        ],
                        correct: 0
                    }
                ]
            }
        ];
        
        const quizlets = {
            ecosystems: {
                title: "Ecosystems & Biodiversity Quiz",
                time: 10,
                questions: [
                    {
                        question: "What is the term for all the interacting populations in a particular area?",
                        options: [
                            "Community",
                            "Ecosystem",
                            "Biome",
                            "Habitat"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of these is an example of a producer in an ecosystem?",
                        options: [
                            "Grass",
                            "Rabbit",
                            "Fox",
                            "Fungus"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the process by which plants make their own food?",
                        options: [
                            "Photosynthesis",
                            "Respiration",
                            "Decomposition",
                            "Transpiration"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which term describes an organism that breaks down dead matter?",
                        options: [
                            "Decomposer",
                            "Producer",
                            "Consumer",
                            "Predator"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the term for the variety of life in an ecosystem?",
                        options: [
                            "Biodiversity",
                            "Ecology",
                            "Sustainability",
                            "Conservation"
                        ],
                        correct: 0
                    }
                ]
            },
            climate: {
                title: "Climate Change Quiz",
                time: 12,
                questions: [
                    {
                        question: "What is the main greenhouse gas responsible for climate change?",
                        options: [
                            "Carbon dioxide",
                            "Oxygen",
                            "Nitrogen",
                            "Helium"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which human activity contributes most to greenhouse gas emissions?",
                        options: [
                            "Burning fossil fuels",
                            "Agriculture",
                            "Deforestation",
                            "Industrial processes"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the term for the gradual increase in Earth's average temperature?",
                        options: [
                            "Global warming",
                            "Climate change",
                            "Greenhouse effect",
                            "Ozone depletion"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of these is a renewable energy source?",
                        options: [
                            "Solar power",
                            "Coal",
                            "Natural gas",
                            "Nuclear power"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the main cause of sea level rise?",
                        options: [
                            "Melting glaciers and ice sheets",
                            "Increased rainfall",
                            "Ocean currents",
                            "Underwater volcanoes"
                        ],
                        correct: 0
                    }
                ]
            },
            conservation: {
                title: "Conservation & Sustainability Quiz",
                time: 15,
                questions: [
                    {
                        question: "What is conservation?",
                        options: [
                            "The protection and preservation of natural resources",
                            "The study of ecosystems",
                            "The use of renewable energy",
                            "The reduction of waste"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of these is an example of sustainable practice?",
                        options: [
                            "Using renewable resources at a rate that allows replenishment",
                            "Using all available resources quickly",
                            "Protecting resources from any use",
                            "Focusing only on economic growth"
                        ],
                        correct: 0
                    },
                    {
                        question: "What are the '3 Rs' of waste management?",
                        options: [
                            "Reduce, Reuse, Recycle",
                            "Remove, Replace, Restore",
                            "Read, Review, Remember",
                            "Research, Report, Respond"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which of these is a non-renewable resource?",
                        options: [
                            "Fossil fuels",
                            "Solar energy",
                            "Wind energy",
                            "Biomass"
                        ],
                        correct: 0
                    },
                    {
                        question: "What is the term for development that meets current needs without compromising future generations?",
                        options: [
                            "Sustainable development",
                            "Economic development",
                            "Social development",
                            "Environmental development"
                        ],
                        correct: 0
                    }
                ]
            }
        };
        
        function startAssessment(assessmentId) {
            if (!currentUser) {
                showToast('Please login to take assessments.', 'error');
                loginModal.style.display = 'flex';
                return;
            }
            
            // Check if lesson is completed
            const lessonId = `lesson${assessmentId === 'biodiversity' ? 1 : assessmentId === 'pollution' ? 2 : 3}`;
            if (!currentUser.progress.lessons || currentUser.progress.lessons[lessonId] !== 100) {
                showToast('Please complete the lesson before taking the assessment.', 'error');
                return;
            }
            
            currentAssessment = JSON.parse(JSON.stringify(assessments[assessmentId])); // Deep copy
            if (!currentAssessment) return;
            
            currentQuestionIndex = 0;
            userAnswers = new Array(currentAssessment.questions.length).fill(null);
            
            // Set up the assessment modal
            document.getElementById('assessmentTitle').textContent = currentAssessment.title;
            document.getElementById('quizTimer').textContent = formatTime(currentAssessment.time * 60);
            document.getElementById('quizTimer').className = 'quiz-timer';
            
            // Show first question
            showQuestion(currentQuestionIndex);
            
            // Set up navigation buttons
            document.getElementById('prevQuestion').style.display = 'none';
            document.getElementById('nextQuestion').style.display = 'block';
            document.getElementById('submitQuiz').style.display = 'none';
            
            // Start timer
            startAssessmentTimer(currentAssessment.time * 60);
            
            // Show modal
            assessmentModal.style.display = 'flex';
        }
        
        function startQuickQuiz() {
            if (!currentUser) {
                showToast('Please login to take quizzes.', 'error');
                loginModal.style.display = 'flex';
                return;
            }
            
            popupQuiz.style.display = 'none';
            currentQuiz = JSON.parse(JSON.stringify(quickQuizzes[0])); // Deep copy
            if (!currentQuiz) return;
            
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuiz.questions.length).fill(null);
            
            // Set up the quiz modal
            document.getElementById('quickQuizTimer').textContent = formatTime(currentQuiz.time * 60);
            document.getElementById('quickQuizTimer').className = 'quiz-timer';
            
            // Show first question
            showQuickQuestion(currentQuestionIndex);
            
            // Set up navigation buttons
            document.getElementById('prevQuickQuestion').style.display = 'none';
            document.getElementById('nextQuickQuestion').style.display = 'block';
            document.getElementById('submitQuickQuiz').style.display = 'none';
            
            // Start timer
            startQuizTimer(currentQuiz.time * 60);
            
            // Show modal
            quickQuizModal.style.display = 'flex';
        }
        
        function startQuizlet(quizletId) {
            if (!currentUser) {
                showToast('Please login to take quizzes.', 'error');
                loginModal.style.display = 'flex';
                return;
            }
            
            currentQuizlet = JSON.parse(JSON.stringify(quizlets[quizletId])); // Deep copy
            if (!currentQuizlet) return;
            
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuizlet.questions.length).fill(null);
            
            // Set up the quizlet modal
            document.getElementById('quizletTitle').textContent = currentQuizlet.title;
            document.getElementById('quizletTimer').textContent = formatTime(currentQuizlet.time * 60);
            document.getElementById('quizletTimer').className = 'quiz-timer';
            
            // Show first question
            showQuizletQuestion(currentQuestionIndex);
            
            // Set up navigation buttons
            document.getElementById('prevQuizletQuestion').style.display = 'none';
            document.getElementById('nextQuizletQuestion').style.display = 'block';
            document.getElementById('submitQuizlet').style.display = 'none';
            
            // Start timer
            startQuizletTimer(currentQuizlet.time * 60);
            
            // Show modal
            quizletModal.style.display = 'flex';
        }
        
        function startAssessmentTimer(seconds) {
            let timeLeft = seconds;
            
            if (assessmentTimer) clearInterval(assessmentTimer);
            
            assessmentTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('quizTimer').textContent = formatTime(timeLeft);
                
                // Update timer color based on remaining time
                if (timeLeft <= 300) { // 5 minutes or less
                    document.getElementById('quizTimer').className = 'quiz-timer warning';
                }
                if (timeLeft <= 60) { // 1 minute or less
                    document.getElementById('quizTimer').className = 'quiz-timer danger';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(assessmentTimer);
                    submitAssessment();
                }
            }, 1000);
        }
        
        function startQuizTimer(seconds) {
            let timeLeft = seconds;
            
            if (quizTimer) clearInterval(quizTimer);
            
            quizTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('quickQuizTimer').textContent = formatTime(timeLeft);
                
                // Update timer color based on remaining time
                if (timeLeft <= 30) { // 30 seconds or less
                    document.getElementById('quickQuizTimer').className = 'quiz-timer warning';
                }
                if (timeLeft <= 10) { // 10 seconds or less
                    document.getElementById('quickQuizTimer').className = 'quiz-timer danger';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(quizTimer);
                    submitQuickQuiz();
                }
            }, 1000);
        }
        
        function startQuizletTimer(seconds) {
            let timeLeft = seconds;
            
            if (quizletTimer) clearInterval(quizletTimer);
            
            quizletTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('quizletTimer').textContent = formatTime(timeLeft);
                
                // Update timer color based on remaining time
                if (timeLeft <= 300) { // 5 minutes or less
                    document.getElementById('quizletTimer').className = 'quizlet-timer warning';
                }
                if (timeLeft <= 60) { // 1 minute or less
                    document.getElementById('quizletTimer').className = 'quizlet-timer danger';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(quizletTimer);
                    submitQuizlet();
                }
            }, 1000);
        }
        
        function showQuestion(index) {
            const question = currentAssessment.questions[index];
            const questionsContainer = document.getElementById('quizQuestions');
            
            let optionsHtml = '';
            
            question.options.forEach((option, i) => {
                const isSelected = userAnswers[index] === i;
                optionsHtml += `
                    <div class="quiz-option ${isSelected ? 'selected' : ''}" 
                         onclick="selectAnswer(${index}, ${i})">
                        ${option}
                    </div>
                `;
            });
            
            questionsContainer.innerHTML = `
                <div class="quiz-question">
                    <h4>Question ${index + 1} of ${currentAssessment.questions.length}</h4>
                    <p>${question.question}</p>
                    <div class="quiz-options">
                        ${optionsHtml}
                    </div>
                </div>
            `;
            
            // Update navigation buttons
            document.getElementById('prevQuestion').style.display = index > 0 ? 'block' : 'none';
            document.getElementById('nextQuestion').style.display = index < currentAssessment.questions.length - 1 ? 'block' : 'none';
            document.getElementById('submitQuiz').style.display = index === currentAssessment.questions.length - 1 ? 'block' : 'none';
        }
        
        function showQuickQuestion(index) {
            const question = currentQuiz.questions[index];
            const questionsContainer = document.getElementById('quickQuizQuestions');
            
            let optionsHtml = '';
            
            question.options.forEach((option, i) => {
                const isSelected = userAnswers[index] === i;
                optionsHtml += `
                    <div class="quiz-option ${isSelected ? 'selected' : ''}" 
                         onclick="selectQuickAnswer(${index}, ${i})">
                        ${option}
                    </div>
                `;
            });
            
            questionsContainer.innerHTML = `
                <div class="quiz-question">
                    <h4>Question ${index + 1} of ${currentQuiz.questions.length}</h4>
                    <p>${question.question}</p>
                    <div class="quiz-options">
                        ${optionsHtml}
                    </div>
                </div>
            `;
            
            // Update navigation buttons
            document.getElementById('prevQuickQuestion').style.display = index > 0 ? 'block' : 'none';
            document.getElementById('nextQuickQuestion').style.display = index < currentQuiz.questions.length - 1 ? 'block' : 'none';
            document.getElementById('submitQuickQuiz').style.display = index === currentQuiz.questions.length - 1 ? 'block' : 'none';
        }
        
        function showQuizletQuestion(index) {
            const question = currentQuizlet.questions[index];
            const questionsContainer = document.getElementById('quizletQuestions');
            
            let optionsHtml = '';
            
            question.options.forEach((option, i) => {
                const isSelected = userAnswers[index] === i;
                optionsHtml += `
                    <div class="quiz-option ${isSelected ? 'selected' : ''}" 
                         onclick="selectQuizletAnswer(${index}, ${i})">
                        ${option}
                    </div>
                `;
            });
            
            questionsContainer.innerHTML = `
                <div class="quiz-question">
                    <h4>Question ${index + 1} of ${currentQuizlet.questions.length}</h4>
                    <p>${question.question}</p>
                    <div class="quiz-options">
                        ${optionsHtml}
                    </div>
                </div>
            `;
            
            // Update navigation buttons
            document.getElementById('prevQuizletQuestion').style.display = index > 0 ? 'block' : 'none';
            document.getElementById('nextQuizletQuestion').style.display = index < currentQuizlet.questions.length - 1 ? 'block' : 'none';
            document.getElementById('submitQuizlet').style.display = index === currentQuizlet.questions.length - 1 ? 'block' : 'none';
        }
        
        function selectAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            showQuestion(questionIndex); // Refresh to show selection
        }
        
        function selectQuickAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            showQuickQuestion(questionIndex); // Refresh to show selection
        }
        
        function selectQuizletAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            showQuizletQuestion(questionIndex); // Refresh to show selection
        }
        
        document.getElementById('nextQuestion').addEventListener('click', () => {
            if (currentQuestionIndex < currentAssessment.questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        });
        
        document.getElementById('prevQuestion').addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        });
        
        document.getElementById('nextQuickQuestion').addEventListener('click', () => {
            if (currentQuestionIndex < currentQuiz.questions.length - 1) {
                currentQuestionIndex++;
                showQuickQuestion(currentQuestionIndex);
            }
        });
        
        document.getElementById('prevQuickQuestion').addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuickQuestion(currentQuestionIndex);
            }
        });
        
        document.getElementById('nextQuizletQuestion').addEventListener('click', () => {
            if (currentQuestionIndex < currentQuizlet.questions.length - 1) {
                currentQuestionIndex++;
                showQuizletQuestion(currentQuestionIndex);
            }
        });
        
        document.getElementById('prevQuizletQuestion').addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuizletQuestion(currentQuestionIndex);
            }
        });
        
        function submitAssessment() {
            clearInterval(assessmentTimer);
            
            // Calculate score
            let correct = 0;
            const questions = currentAssessment.questions;
            
            questions.forEach((question, i) => {
                if (userAnswers[i] === question.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / questions.length) * 100);
            
            // Save quiz result
            if (!currentUser.progress.quizProgress) {
                currentUser.progress.quizProgress = [];
            }
            
            // Prepare questions with user answers for review
            const quizQuestions = questions.map((q, i) => {
                return {
                    question: q.question,
                    options: q.options,
                    correct: q.correct,
                    userAnswer: userAnswers[i]
                };
            });
            
            currentUser.progress.quizProgress.push({
                quizName: currentAssessment.title,
                date: new Date().toISOString(),
                score: score,
                questions: quizQuestions
            });
            
            // Update course progress
            const courseId = `course${currentAssessment === assessments.biodiversity ? 1 : currentAssessment === assessments.pollution ? 2 : 3}`;
            if (!currentUser.progress.courses) {
                currentUser.progress.courses = {};
            }
            currentUser.progress.courses[courseId] = Math.min(100, (currentUser.progress.courses[courseId] || 0) + 30);
            
            // Update assessments progress
            if (!currentUser.progress.assessments) {
                currentUser.progress.assessments = {};
            }
            currentUser.progress.assessments[currentAssessment.title.toLowerCase().replace(/ & /g, '_').replace(/ /g, '_')] = score;
            
            // Update user data
            updateUserData();
            
            // Show result
            assessmentModal.style.display = 'none';
            showToast(`Assessment completed! Your score: ${score}%`);
            
            // Reload quiz progress table
            loadQuizProgress();
            
            // Update course progress display
            const courseProgressText = document.getElementById(`${courseId}Progress`);
            const courseProgressBar = document.getElementById(`${courseId}ProgressBar`);
            if (courseProgressText && courseProgressBar) {
                courseProgressText.textContent = `${currentUser.progress.courses[courseId]}%`;
                courseProgressBar.style.width = `${currentUser.progress.courses[courseId]}%`;
            }
            
            // Update achievements
            updateAchievements();
            
            // Show certificate if score is high enough
            if (score >= 80) {
                showCertificate(currentAssessment.title, score);
            }
        }
        
        document.getElementById('submitQuiz').addEventListener('click', submitAssessment);
        
        function submitQuickQuiz() {
            clearInterval(quizTimer);
            
            // Calculate score
            let correct = 0;
            const questions = currentQuiz.questions;
            
            questions.forEach((question, i) => {
                if (userAnswers[i] === question.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / questions.length) * 100);
            
            // Show result
            quickQuizModal.style.display = 'none';
            showToast(`Quick Quiz completed! Your score: ${score}%`);
            
            // Show popup quiz again after 2 minutes
            setTimeout(() => {
                popupQuiz.style.display = 'block';
            }, 120000);
        }
        
        document.getElementById('submitQuickQuiz').addEventListener('click', submitQuickQuiz);
        
        function submitQuizlet() {
            clearInterval(quizletTimer);
            
            // Calculate score
            let correct = 0;
            const questions = currentQuizlet.questions;
            
            questions.forEach((question, i) => {
                if (userAnswers[i] === question.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / questions.length) * 100);
            
            // Save quiz result
            if (!currentUser.progress.quizProgress) {
                currentUser.progress.quizProgress = [];
            }
            
            // Prepare questions with user answers for review
            const quizQuestions = questions.map((q, i) => {
                return {
                    question: q.question,
                    options: q.options,
                    correct: q.correct,
                    userAnswer: userAnswers[i]
                };
            });
            
            currentUser.progress.quizProgress.push({
                quizName: currentQuizlet.title,
                date: new Date().toISOString(),
                score: score,
                questions: quizQuestions
            });
            
            // Update user data
            updateUserData();
            
            // Show result
            quizletModal.style.display = 'none';
            showToast(`Quizlet completed! Your score: ${score}%`);
            
            // Reload quiz progress table
            loadQuizProgress();
            
            // Update achievements
            updateAchievements();
        }
        
        document.getElementById('submitQuizlet').addEventListener('click', submitQuizlet);
        
        function showCertificate(courseName, score) {
            document.getElementById('certificateName').textContent = currentUser.name;
            document.getElementById('certificateCourse').textContent = courseName;
            document.getElementById('certificateScore').textContent = `${score}%`;
            document.getElementById('certificateDate').textContent = new Date().toLocaleDateString();
            
            certificateModal.style.display = 'flex';
        }
        
        function printCertificate() {
            const certificateContent = document.getElementById('certificateContent').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = certificateContent;
            window.print();
            document.body.innerHTML = originalContent;
            
            // Reinitialize the page after printing
            checkLoginStatus();
        }
        
        function closeCertificate() {
            certificateModal.style.display = 'none';
        }
        
        function closePrivacyPolicy() {
            privacyModal.style.display = 'none';
        }
        
        function closeTerms() {
            termsModal.style.display = 'none';
        }
        
        // Resource Download Functionality
        document.querySelectorAll('.resource-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const resource = this.getAttribute('data-resource');
                downloadResource(resource);
            });
        });
        
        function downloadResource(resourceType) {
            // In a real application, this would trigger a file download
            // For this demo, we'll just show a message
            let resourceName = '';
            
            switch(resourceType) {
                case 'biodiversity':
                    resourceName = 'Biodiversity & Ecosystems Guide';
                    break;
                case 'pollution':
                    resourceName = 'Pollution & Conservation Guide';
                    break;
                case 'sustainability':
                    resourceName = 'Sustainable Development Guide';
                    break;
            }
            
            showToast(`Downloading ${resourceName}...`);
            
            // Simulate download completion
            setTimeout(() => {
                showToast(`${resourceName} downloaded successfully!`);
            }, 1500);
        }
        
        // PDF Download Links
        document.getElementById('biodiversityPdf').addEventListener('click', function(e) {
            e.preventDefault();
            downloadResource('biodiversity');
        });
        
        document.getElementById('pollutionPdf').addEventListener('click', function(e) {
            e.preventDefault();
            downloadResource('pollution');
        });
        
        document.getElementById('sustainabilityPdf').addEventListener('click', function(e) {
            e.preventDefault();
            downloadResource('sustainability');
        });
        
        document.getElementById('biodiversityResource').addEventListener('click', function(e) {
            e.preventDefault();
            downloadResource('biodiversity');
        });
        
        document.getElementById('pollutionResource').addEventListener('click', function(e) {
            e.preventDefault();
            downloadResource('pollution');
        });
        
        document.getElementById('sustainabilityResource').addEventListener('click', function(e) {
            e.preventDefault();
            downloadResource('sustainability');
        });
        
        // Course Management System
        function startCourse(courseId) {
            if (!currentUser) {
                showToast('Please login to access courses.', 'error');
                loginModal.style.display = 'flex';
                return;
            }
            
            showToast(`Starting ${courseId} course...`);
            // In a full implementation, this would open the course player
        }
    </script> 
   <!-- Replace your current lessons-script with this block. It adds localStorage progress, secure unlock checks,
     submission grading, a "Review Answers" button (appears after submit), and Reset behavior that collapses the quiz. -->

<script id="lessons-progress-script">
/* === EcoLearn Lessons: persistent progress, grading & review (drop-in replacement) ===
   Requirements:
   - Relies on DOM structure and IDs from the lessons section:
     video-1..3, unlockBtn-1..3, confirmWatched-1..3, quiz-1..3, questions-1..3,
     submit-1..3, reset-1..3, result-1..3
   - Uses `lessonsQuizBanks` if present (detailed banks). If not present, falls back to a template generator.
*/

(function(){
  const LESSON_IDS = [1,2,3];
  const STORAGE_PREFIX = 'ecolearn_lesson_'; // final key: ecolearn_lesson_1

  // Fallback question template (if lessonsQuizBanks is not available)
  const fallbackTemplate = [
    {type:'mc', q:'Which of these is a renewable energy source?', options:['Coal','Solar','Oil','Gas'], answer:'Solar'},
    {type:'mc', q:'Which process provides oxygen to the ecosystem?', options:['Combustion','Photosynthesis','Evaporation','Condensation'], answer:'Photosynthesis'},
    {type:'fitb', q:'The loss of a species is known as _______.', answer:'extinction'},
    {type:'fitb', q:'Protecting natures balance is called _______.', answer:'conservation'},
    {type:'tf', q:'Renewable energy reduces emissions.', answer:true},
    {type:'tf', q:'Pollution has no effect on biodiversity.', answer:false}
  ];

  // Utility: get question bank for lessonId (expects 15 questions)
  function getBank(lessonId){
    if(window.lessonsQuizBanks && window.lessonsQuizBanks[lessonId] && Array.isArray(window.lessonsQuizBanks[lessonId].questions)){
      // clone to avoid accidental mutation
      return JSON.parse(JSON.stringify(window.lessonsQuizBanks[lessonId].questions));
    }
    // fallback: build 15 questions by repeating fallbackTemplate
    const out = [];
    for(let i=0;i<15;i++){
      const base = fallbackTemplate[i % fallbackTemplate.length];
      // deep copy
      out.push(JSON.parse(JSON.stringify(base)));
    }
    return out;
  }

  // Normalize text helper
  function norm(s){ return (s||'').toString().trim().toLowerCase(); }

  // Storage helpers
  function storageKey(id){ return STORAGE_PREFIX + id; }
  function saveProgress(id, obj){
    try { localStorage.setItem(storageKey(id), JSON.stringify(obj)); }
    catch(e){ console.warn('Save progress failed', e); }
  }
  function loadProgress(id){
    try { const raw = localStorage.getItem(storageKey(id)); return raw ? JSON.parse(raw) : null; }
    catch(e){ return null; }
  }
  function clearProgress(id){
    try { localStorage.removeItem(storageKey(id)); }
    catch(e){ /* ignore */ }
  }

  // Render questions into DOM (with unique input naming per lesson + index)
  // Also applies saved answers if provided (progress.answers)
  function renderQuestions(lessonId, savedAnswers){
    const questions = getBank(lessonId);
    const container = document.getElementById('questions-' + lessonId);
    if(!container) return;
    container.innerHTML = '';
    questions.forEach((qobj, idx) => {
      const wrap = document.createElement('div');
      wrap.className = 'question';
      const p = document.createElement('p');
      p.textContent = (idx+1) + '. ' + qobj.q;
      wrap.appendChild(p);

      const name = `l${lessonId}_q${idx}`;

      if(qobj.type === 'mc'){
        const opts = qobj.options ? qobj.options.slice() : [];
        // shuffle options for fairness but maintain saved mapping if answers exist (we won't reshuffle when applying saved answers)
        // To avoid abusing deterministic shifts, do simple random shuffle each render only if no savedAnswers present
        if(!savedAnswers){
          for (let i = opts.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [opts[i], opts[j]] = [opts[j], opts[i]];
          }
        }
        opts.forEach((opt, oi) => {
          const lbl = document.createElement('label');
          lbl.style.display='block';
          const input = document.createElement('input');
          input.type = 'radio';
          input.name = name;
          input.value = opt;
          input.dataset.qindex = idx;
          if(savedAnswers && savedAnswers.answers && savedAnswers.answers[idx] && savedAnswers.answers[idx] === opt){
            input.checked = true;
          }
          lbl.appendChild(input);
          lbl.appendChild(document.createTextNode(' ' + opt));
          wrap.appendChild(lbl);
        });
      } else if(qobj.type === 'fitb'){
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'fitb-input';
        input.name = name;
        input.dataset.qindex = idx;
        if(savedAnswers && savedAnswers.answers && savedAnswers.answers[idx]){
          input.value = savedAnswers.answers[idx];
        }
        wrap.appendChild(input);
      } else if(qobj.type === 'tf'){
        ['True','False'].forEach((t) => {
          const lbl = document.createElement('label');
          lbl.style.display='block';
          const input = document.createElement('input');
          input.type = 'radio';
          input.name = name;
          input.value = t.toLowerCase();
          input.dataset.qindex = idx;
          if(savedAnswers && savedAnswers.answers && savedAnswers.answers[idx] !== undefined){
            // savedAnswers stores boolean for tf
            const saved = savedAnswers.answers[idx];
            if( (t.toLowerCase()==='true' && saved===true) || (t.toLowerCase()==='false' && saved===false) ){
              input.checked = true;
            }
          }
          lbl.appendChild(input);
          lbl.appendChild(document.createTextNode(' ' + t));
          wrap.appendChild(lbl);
        });
      }

      container.appendChild(wrap);
    });
  }

  // Gather user answers from DOM, return answers map {index: value}
  function gatherAnswers(lessonId){
    const bank = getBank(lessonId);
    const answers = {};
    bank.forEach((qobj, idx) => {
      const name = `l${lessonId}_q${idx}`;
      if(qobj.type === 'mc'){
        const sel = document.querySelector(`input[name="${name}"]:checked`);
        answers[idx] = sel ? sel.value : null;
      } else if(qobj.type === 'fitb'){
        const input = document.querySelector(`input[name="${name}"]`);
        answers[idx] = input ? input.value : '';
      } else if(qobj.type === 'tf'){
        const sel = document.querySelector(`input[name="${name}"]:checked`);
        if(sel){
          const val = sel.value === 'true';
          answers[idx] = val;
        } else answers[idx] = null;
      }
    });
    return answers;
  }

  // Grade quiz and return result object {correct, total, percent, perItem: [{user, correct, correctBool}]}
  function gradeQuiz(lessonId, answers){
    const bank = getBank(lessonId);
    const total = bank.length;
    let correct = 0;
    const perItem = [];
    bank.forEach((qobj, idx) => {
      let user = answers[idx];
      let correctValue = qobj.answer;
      let isCorrect = false;
      if(qobj.type === 'mc'){
        isCorrect = user && norm(user) === norm(correctValue);
      } else if(qobj.type === 'fitb'){
        isCorrect = user && norm(user) === norm(correctValue);
      } else if(qobj.type === 'tf'){
        // correctValue boolean
        isCorrect = (typeof user === 'boolean' && user === !!correctValue) || (typeof user === 'string' && norm(user) === String(!!correctValue));
      }
      if(isCorrect) correct++;
      perItem.push({index: idx, user: user, correct: correctValue, isCorrect: !!isCorrect, type: qobj.type});
    });
    const percent = Math.round((correct/total)*100);
    return {correct, total, percent, perItem};
  }

  // Show result summary UI and save progress
  function handleSubmit(lessonId){
    const answers = gatherAnswers(lessonId);
    const score = gradeQuiz(lessonId, answers);
    const resultEl = document.getElementById('result-' + lessonId);
    if(!resultEl) return;
    resultEl.style.display = 'block';
    resultEl.innerHTML = `<strong>Score:</strong> ${score.percent}% (${score.correct}/${score.total})`;
    if(score.percent >= 70){
      resultEl.innerHTML += `<div style="color:green;margin-top:6px;font-weight:700;">Passed </div>`;
    } else {
      resultEl.innerHTML += `<div style="color:#b04040;margin-top:6px;font-weight:700;">Not passed</div>`;
    }

    // Save progress: answers, score, timestamp, submitted flag
    const progress = {
      answers: answers,
      score: score.percent,
      correct: score.correct,
      total: score.total,
      submitted: true,
      timestamp: new Date().toISOString()
    };
    saveProgress(lessonId, progress);

    // Create or show Review Answers button (as requested)
    ensureReviewButton(lessonId, score.perItem);

    return score;
  }

  // Render review UI: toggles a detailed view showing each question, user's answer, correct answer
  function ensureReviewButton(lessonId, perItem){
    const container = document.getElementById('questions-' + lessonId);
    if(!container) return;
    // Avoid duplicating button
    let reviewBtn = document.getElementById('reviewBtn-' + lessonId);
    if(!reviewBtn){
      reviewBtn = document.createElement('button');
      reviewBtn.id = 'reviewBtn-' + lessonId;
      reviewBtn.className = 'lesson-btn lesson-btn-outline';
      reviewBtn.textContent = 'Review Answers';
      reviewBtn.style.marginTop = '10px';
      // insert after controls area if present
      const quizForm = document.getElementById('quizform-' + lessonId);
      if(quizForm){
        quizForm.appendChild(reviewBtn);
      } else {
        container.appendChild(reviewBtn);
      }
      reviewBtn.addEventListener('click', () => showReview(lessonId));
    }
    // store last grading perItem in dataset for showReview to use
    reviewBtn.dataset.peritem = JSON.stringify(perItem || []);
  }

  function showReview(lessonId){
    const progress = loadProgress(lessonId);
    if(!progress || !progress.submitted){
      alert('You must submit the assessment before reviewing answers.');
      return;
    }
    const perItem = [];
    // if reviewBtn had peritem saved, prefer that
    const reviewBtn = document.getElementById('reviewBtn-' + lessonId);
    if(reviewBtn && reviewBtn.dataset.peritem){
      try{ const parsed = JSON.parse(reviewBtn.dataset.peritem); if(Array.isArray(parsed)) perItem.push(...parsed); }catch(e){}
    }
    // fallback: re-grade current DOM answers to produce perItem
    if(perItem.length === 0){
      const answers = progress.answers || {};
      const graded = gradeQuiz(lessonId, answers);
      perItem.push(...graded.perItem);
    }

    // Create overlay modal for review (simple)
    let modal = document.getElementById('reviewModal-' + lessonId);
    if(modal) modal.remove(); // recreate fresh
    modal = document.createElement('div');
    modal.id = 'reviewModal-' + lessonId;
    modal.style.position = 'fixed';
    modal.style.left = '0';
    modal.style.top = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.background = 'rgba(0,0,0,0.6)';
    modal.style.zIndex = 4000;
    modal.style.display = 'flex';
    modal.style.alignItems = 'center';
    modal.style.justifyContent = 'center';
    modal.innerHTML = `<div style="background:#fff;max-width:880px;width:92%;max-height:86%;overflow:auto;border-radius:10px;padding:18px;box-shadow:0 12px 40px rgba(0,0,0,0.25)">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3 style="margin:0;">Review Answers - Lesson ${lessonId}</h3>
        <button id="closeReview-${lessonId}" style="border:none;background:#eee;padding:6px 10px;border-radius:6px;cursor:pointer">Close</button>
      </div>
      <div id="reviewContent-${lessonId}" style="margin-top:12px"></div>
    </div>`;
    document.body.appendChild(modal);
    document.getElementById('closeReview-' + lessonId).addEventListener('click', () => modal.remove());

    const reviewContent = document.getElementById('reviewContent-' + lessonId);
    const bank = getBank(lessonId);
    perItem.forEach(item => {
      const q = bank[item.index];
      const row = document.createElement('div');
      row.style.padding = '8px';
      row.style.borderBottom = '1px solid #f0f0f0';
      const qtext = document.createElement('div'); qtext.innerHTML = `<strong>Q${item.index+1}.</strong> ${q.q}`;
      const userText = document.createElement('div'); 
      let userDisplay = item.user;
      if(item.type === 'tf' && typeof item.user === 'boolean') userDisplay = item.user ? 'True' : 'False';
      userText.innerHTML = `<span style="color:#333;">Your answer:</span> <span style="font-weight:700">${userDisplay === null || userDisplay === undefined || userDisplay === '' ? '<em style="color:#999">No answer</em>' : String(userDisplay)}</span>`;
      const correctText = document.createElement('div');
      const correctDisplay = (item.type === 'tf') ? (item.correct ? 'True' : 'False') : item.correct;
      correctText.innerHTML = `<span style="color:#333;">Correct answer:</span> <span style="font-weight:700">${correctDisplay}</span>`;
      const mark = document.createElement('div');
      mark.style.marginTop = '6px';
      mark.innerHTML = item.isCorrect ? `<span style="color:green;font-weight:700">Correct </span>` : `<span style="color:#b04040;font-weight:700">Incorrect </span>`;
      row.appendChild(qtext);
      row.appendChild(userText);
      row.appendChild(correctText);
      row.appendChild(mark);
      reviewContent.appendChild(row);
    });
  }

  // Unlock logic ensures user has interacted with video (play) or confirmed watched
  function wireLesson(lessonId){
    const video = document.getElementById('video-' + lessonId);
    const unlockBtn = document.getElementById('unlockBtn-' + lessonId);
    const confirmBtn = document.getElementById('confirmWatched-' + lessonId);
    const lock = document.getElementById('lock-' + lessonId);
    const quizSection = document.getElementById('quiz-' + lessonId);
    const submitBtn = document.getElementById('submit-' + lessonId);
    const resetBtn = document.getElementById('reset-' + lessonId);

    // Load existing progress and apply
    const progress = loadProgress(lessonId);
    if(progress){
      // if previously submitted, show result panel with stored score and make Review button
      if(progress.submitted){
        const resultEl = document.getElementById('result-' + lessonId);
        if(resultEl){
          resultEl.style.display = 'block';
          resultEl.innerHTML = `<strong>Score:</strong> ${progress.score}% (${progress.correct}/${progress.total}) <div style="color:${progress.score>=70?'green':'#b04040'};font-weight:700;margin-top:6px">${progress.score>=70?'Passed':'Not passed'}</div>`;
        }
        // unlock visually and render questions with saved answers
        lock.style.display = 'none';
        quizSection.classList.add('open');
        renderQuestions(lessonId, progress);
        ensureReviewButton(lessonId);
      } else if(progress.answers){
        // partial progress: show saved answers but keep locked/unlocked state based on submitted flag
        renderQuestions(lessonId, progress);
        // keep lock visible until user confirms or video ends
        lock.style.display = progress.unlocked ? 'none' : '';
        if(progress.unlocked){
          lock.style.display = 'none';
          quizSection.classList.add('open');
        }
      }
    } else {
      // no progress: show locked UI and placeholder message in questions area
      const questionsDiv = document.getElementById('questions-' + lessonId);
      if(questionsDiv) questionsDiv.innerHTML = '<em style="color:var(--light-text)">Assessment will appear here once unlocked.</em>';
    }

    // security: flag when user actually plays video
    let interacted = false;
    if(video){
      video.addEventListener('play', () => { interacted = true; });
      video.addEventListener('ended', () => {
        interacted = true;
        // unlock automatically on ended
        const prev = loadProgress(lessonId) || {};
        prev.unlocked = true;
        saveProgress(lessonId, prev);
        document.getElementById('lock-' + lessonId).style.display = 'none';
        document.getElementById('quiz-' + lessonId).classList.add('open');
        renderQuestions(lessonId, prev);
      });
    }

    // confirm watched
    if(confirmBtn){
      confirmBtn.addEventListener('click', () => {
        const ok = confirm('Click OK to confirm you have watched the full video for this lesson. This will unlock the assessment.');
        if(!ok) return;
        const prev = loadProgress(lessonId) || {};
        prev.unlocked = true;
        saveProgress(lessonId, prev);
        document.getElementById('lock-' + lessonId).style.display = 'none';
        document.getElementById('quiz-' + lessonId).classList.add('open');
        renderQuestions(lessonId, prev);
      });
    }

    // unlockBtn toggles (but only after interacting with video OR confirm)
    if(unlockBtn){
      unlockBtn.addEventListener('click', () => {
        const prev = loadProgress(lessonId) || {};
        // if unlocked via progress or user has interacted with video allow unlock
        if(prev.unlocked || interacted){
          prev.unlocked = true;
          saveProgress(lessonId, prev);
          document.getElementById('lock-' + lessonId).style.display = 'none';
          document.getElementById('quiz-' + lessonId).classList.toggle('open');
          if(document.getElementById('quiz-' + lessonId).classList.contains('open')){
            renderQuestions(lessonId, prev);
          }
        } else {
          alert('Please watch the video (or click "I Watched the Video") before accessing the assessment.');
        }
      });
    }

    // submit handler
    if(submitBtn){
      submitBtn.addEventListener('click', () => {
        const score = handleSubmit(lessonId);
        // persist unlocked/submitted state
        const prev = loadProgress(lessonId) || {};
        prev.unlocked = true;
        prev.submitted = true;
        prev.score = score.percent;
        prev.correct = score.correct;
        prev.total = score.total;
        prev.answers = gatherAnswers(lessonId);
        prev.timestamp = new Date().toISOString();
        saveProgress(lessonId, prev);
        // ensure review button added
        ensureReviewButton(lessonId, score.perItem);
      });
    }

    // reset handler: clear saved progress for this lesson, reset form and collapse and hide result
    if(resetBtn){
      resetBtn.addEventListener('click', () => {
        if(!confirm('Reset will clear your progress for this lesson. Continue?')) return;
        clearProgress(lessonId);
        // collapse
        const qsec = document.getElementById('quiz-' + lessonId);
        if(qsec) qsec.classList.remove('open');
        // clear questions area and result
        const questionsDiv = document.getElementById('questions-' + lessonId);
        if(questionsDiv) questionsDiv.innerHTML = '<em style="color:var(--light-text)">Assessment will appear here once unlocked.</em>';
        const resultEl = document.getElementById('result-' + lessonId);
        if(resultEl){ resultEl.style.display = 'none'; resultEl.innerHTML = ''; }
        // remove review button if exists
        const reviewBtn = document.getElementById('reviewBtn-' + lessonId);
        if(reviewBtn) reviewBtn.remove();
        // show lock again
        const lockEl = document.getElementById('lock-' + lessonId);
        if(lockEl) lockEl.style.display = '';
      });
    }
  }

  // Initialize all lessons
  LESSON_IDS.forEach(id => {
    // ensure DOM elements exist
    if(document.getElementById('quiz-' + id)){
      wireLesson(id);
    }
  });

  // Optional: expose API on window for debugging
  window.EcoLearn = window.EcoLearn || {};
  window.EcoLearn.loadProgress = loadProgress;
  window.EcoLearn.clearProgress = clearProgress;
  window.EcoLearn.storageKey = storageKey;

})();
</script>
<script id="lessons-overview-script">
(function(){
  const LESSONS = [
    {id: 1, name: "Biodiversity & Ecosystems"},
    {id: 2, name: "Pollution & Conservation"},
    {id: 3, name: "Sustainable Development"}
  ];

  function loadProgress(id){
    try { return JSON.parse(localStorage.getItem('ecolearn_lesson_' + id)) || {}; }
    catch(e){ return {}; }
  }

  function updateOverview(){
    const container = document.getElementById('overview-summary');
    if(!container) return;
    container.innerHTML = '';
    let completed = 0;

    LESSONS.forEach(lesson => {
      const prog = loadProgress(lesson.id);
      const item = document.createElement('div');
      item.className = 'overview-item';

      let status = 'Not Started';
      let badge = '';
      let scoreText = '';

      if(prog.submitted){
        completed++;
        status = prog.score >= 70 ? ' Passed' : ' Attempted';
        badge = prog.score >= 70 ? '' : '';
        scoreText = prog.score + '%';
      } else if(prog.unlocked){
        status = ' Unlocked';
      }

      item.innerHTML = `
        <h4>${lesson.name}</h4>
        <div class="overview-status">${status}</div>
        <div class="overview-score">Score: ${scoreText}</div>
        <div class="overview-badge">${badge}</div>
      `;
      container.appendChild(item);
    });

    // update progress bar
    const barFill = document.getElementById('overview-bar-fill');
    if(barFill){
      const percent = Math.round((completed / LESSONS.length) * 100);
      barFill.style.width = percent + '%';
    }
  }

  // Update on load and whenever user submits a quiz
  document.addEventListener('DOMContentLoaded', updateOverview);
  window.addEventListener('storage', updateOverview);
  // Refresh overview dynamically when any lesson updates
  setInterval(updateOverview, 2000);
})();
</script>
<!-- ============================
     ECOLEARN MONTHLY COURSES OVERRIDE
     Paste this entire block at the BOTTOM of index.html (before </body>)
     This will hide older Monthly Courses (if any) and install the new system.
     ============================ -->

<!-- PART A: HTML (UI) -->
<section id="monthly-courses-override" aria-labelledby="monthly-courses-title" data-ecolearn-override>
  <div class="mc-wrap">
    <h2 id="monthly-courses-title">EcoLearn  Monthly Courses</h2>
    <p class="mc-lead">Enroll in hands-on monthly courses. Work through modules, finish the final exam and download an <strong>EcoLearn Official Certificate</strong>.</p>

    <!-- Overview -->
    <div id="mc-overview" class="mc-overview" aria-hidden="false"></div>

    <!-- Courses Grid -->
    <div id="mc-grid" class="mc-grid">

      <!-- COURSE A (1) -->
      <article class="mc-card" data-course="1" id="mc-course-1">
        <header class="mc-card-head">
          <h3>Climate Change Fundamentals</h3>
          <div class="mc-meta">Duration: 4 weeks  Level: Beginner</div>
        </header>

        <div class="mc-actions">
          <button class="mc-btn mc-start" data-course="1">Start Course</button>
          <button class="mc-btn mc-open" data-course="1">Open Course</button>
        </div>

        <div class="mc-progress" id="mc-progress-1"><div class="mc-progress-fill" id="mc-progress-fill-1" style="width:0%"></div></div>
        <div class="mc-status" id="mc-status-1">Not enrolled</div>

        <div class="mc-detail" id="mc-detail-1" aria-hidden="true"></div>
      </article>

      <!-- COURSE B (2) -->
      <article class="mc-card" data-course="2" id="mc-course-2">
        <header class="mc-card-head">
          <h3>Renewable Energy Systems</h3>
          <div class="mc-meta">Duration: 4 weeks  Level: Intermediate</div>
        </header>

        <div class="mc-actions">
          <button class="mc-btn mc-start" data-course="2">Start Course</button>
          <button class="mc-btn mc-open" data-course="2">Open Course</button>
        </div>

        <div class="mc-progress" id="mc-progress-2"><div class="mc-progress-fill" id="mc-progress-fill-2" style="width:0%"></div></div>
        <div class="mc-status" id="mc-status-2">Not enrolled</div>

        <div class="mc-detail" id="mc-detail-2" aria-hidden="true"></div>
      </article>

      <!-- COURSE C (3) -->
      <article class="mc-card" data-course="3" id="mc-course-3">
        <header class="mc-card-head">
          <h3>Sustainable Agriculture</h3>
          <div class="mc-meta">Duration: 4 weeks  Level: All</div>
        </header>

        <div class="mc-actions">
          <button class="mc-btn mc-start" data-course="3">Start Course</button>
          <button class="mc-btn mc-open" data-course="3">Open Course</button>
        </div>

        <div class="mc-progress" id="mc-progress-3"><div class="mc-progress-fill" id="mc-progress-fill-3" style="width:0%"></div></div>
        <div class="mc-status" id="mc-status-3">Not enrolled</div>

        <div class="mc-detail" id="mc-detail-3" aria-hidden="true"></div>
      </article>

    </div> <!-- /mc-grid -->
  </div>
</section>

<!-- PART B: Scoped CSS (override; safe to paste anywhere in head, but keep it here if pasting at bottom) -->
<style id="mc-override-style">
/* Scoped to #monthly-courses-override to avoid interfering with other styles */
#monthly-courses-override { padding:36px 18px; background: linear-gradient(180deg,var(--light-bg,#F8F9FA),#fff); font-family: inherit; }
#monthly-courses-override .mc-wrap { max-width:1180px; margin:0 auto; }
#monthly-courses-override h2 { text-align:center; color:var(--dark-green,#0b856e); margin-bottom:6px; }
#monthly-courses-override .mc-lead { text-align:center; color:var(--light-text,#7F8C8D); margin-bottom:18px; }

#monthly-courses-override .mc-overview { display:flex; gap:12px; justify-content:space-between; margin-bottom:18px; flex-wrap:wrap; }
#monthly-courses-override .mc-overview .ov-item { background:#fff; padding:10px 12px; border-radius:8px; box-shadow:var(--card-shadow, 0 10px 30px rgba(0,0,0,0.08)); min-width:220px; flex:1; }
#monthly-courses-override .ov-title { color:var(--dark-green,#0b856e); font-weight:700; margin-bottom:6px; }
#monthly-courses-override .ov-sub { color:var(--light-text,#7F8C8D); }

#monthly-courses-override .mc-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:18px; }
#monthly-courses-override .mc-card { background:#fff; border-radius:12px; padding:14px; box-shadow:var(--card-shadow,0 10px 30px rgba(0,0,0,0.08)); display:flex; flex-direction:column; gap:10px; }
#monthly-courses-override .mc-card-head h3 { margin:0; color:var(--dark-green,#0b856e); }
#monthly-courses-override .mc-meta { font-size:0.9rem; color:var(--light-text,#7F8C8D); }

#monthly-courses-override .mc-actions { display:flex; gap:10px; }
#monthly-courses-override .mc-btn { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; background:var(--dark-green,#0b856e); color:#fff; }
#monthly-courses-override .mc-btn.mc-start { background:var(--primary-green,#0ae624cd); color:#063e2f; }
#monthly-courses-override .mc-btn.mc-open { background:transparent; border:2px solid var(--dark-green,#0b856e); color:var(--dark-green,#0b856e); }

#monthly-courses-override .mc-progress { width:100%; height:10px; background:rgba(0,0,0,0.06); border-radius:6px; overflow:hidden; margin-top:6px; }
#monthly-courses-override .mc-progress-fill { height:100%; background:linear-gradient(90deg,var(--primary-green,#0ae624cd),var(--dark-green,#0b856e)); width:0%; transition:width 0.6s ease; }

#monthly-courses-override .mc-status { font-size:0.9rem; color:var(--light-text,#7F8C8D); }

#monthly-courses-override .mc-detail { display:none; margin-top:10px; border-top:1px dashed rgba(0,0,0,0.06); padding-top:12px; }
#monthly-courses-override .mc-detail.open { display:block; }

#monthly-courses-override .mc-week { background:#fbfbfb; padding:12px; border-radius:8px; margin-bottom:10px; }
#monthly-courses-override .mc-video-wrap video { width:100%; border-radius:8px; background:#000; max-height:420px; }
#monthly-courses-override .mc-module-actions { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; align-items:center; }
#monthly-courses-override .mc-link { color:var(--dark-green,#0b856e); text-decoration:underline; cursor:pointer; background:transparent; border:none; padding:6px; }

#monthly-courses-override .mc-quiz { background:#fff; border-radius:8px; padding:8px; border:1px solid #eef6f0; margin-top:8px; }
#monthly-courses-override .mc-quiz p { margin:0 0 6px 0; font-weight:600; }
#monthly-courses-override .mc-quiz label { display:block; margin-bottom:6px; cursor:pointer; }
#monthly-courses-override .mc-quiz input[type="text"] { width:100%; padding:8px; border-radius:6px; border:1px solid #ddd; }

#monthly-courses-override .mc-final-block { margin-top:12px; }
#monthly-courses-override .mc-final-area { margin-top:8px; display:flex; flex-direction:column; gap:8px; }
#monthly-courses-override .mc-final-quiz { display:none; margin-top:10px; }
#monthly-courses-override .mc-final-quiz.open { display:block; }
#monthly-courses-override .mc-final-result { margin-top:8px; display:none; background:#f1fff6; padding:10px; border-radius:6px; }
#monthly-courses-override .mc-cert-area { margin-top:8px; }

#monthly-courses-override .mc-small { color:var(--light-text,#7F8C8D); font-size:0.95rem; }

@media (max-width:700px){
  #monthly-courses-override .mc-actions { flex-direction:column; }
  #monthly-courses-override .mc-overview { flex-direction:column; }
}
</style>

<!-- PART C: JavaScript (core + content + override logic)
     Paste the whole script. It will:
     - hide existing monthly-courses if present,
     - mount the override UI,
     - render full course content,
     - handle enrollment, progress, quizzes, retakes, final exam, certificate
-->
<script id="mc-override-script">
(function(){
  /* ---------- Safety: hide old monthly sections if present ---------- */
  try {
    // look for common old IDs and hide them (non-destructive)
    ['monthly-courses','monthly-courses-full','monthly-courses-section','monthly-courses-original','monthly-courses-old'].forEach(id=>{
      const el=document.getElementById(id);
      if(el) el.style.display='none';
    });
    // also hide any section that contains text "Monthly Courses" (best-effort)
    document.querySelectorAll('section,div').forEach(node=>{
      try{
        if(node.innerText && node.innerText.toLowerCase().includes('monthly courses') && !node.hasAttribute('data-ecolearn-override')){
          node.style.display='none';
        }
      }catch(e){}
    });
  } catch(e){ console.warn('Override hide error', e); }

  /* ---------- STORAGE helpers ---------- */
  const COURSES = [1,2,3];
  const PREFIX = 'ecolearn_mc_'; // keys: ecolearn_mc_1

  function key(id){ return PREFIX + id; }
  function save(id,data){ try{ localStorage.setItem(key(id), JSON.stringify(data)); }catch(e){console.warn('save err',e);} }
  function load(id){ try{ const v = localStorage.getItem(key(id)); return v ? JSON.parse(v) : null; }catch(e){return null;} }
  function clearCourse(id){ localStorage.removeItem(key(id)); }

  /* ---------- Content provider (professional content for each course) ---------- */
  function courseContent(id){
    // each course has weeks: title, video (path), pdf (path), quiz (array), challenge text
    // NOTE: replace the `video` and `pdf` values with your actual paths.
    if(id===1){ // Climate Change Fundamentals
      return {
        title:'Climate Change Fundamentals',
        weeks:[
          {
            title:'Week 1  What is Climate Change?',
            /* >>> REPLACE VIDEO PATH (local file) <<< 
               Example: videos/climate_week1.mp4
               Put your file in /videos and change the path below. */
            video:'videos/climate_week1.mp4',
            /* >>> REPLACE RESOURCE PDF PATH <<< 
               Example: resources/climate_week1.pdf */
            pdf:'resources/climate_week1.pdf',
            quiz:[
              {type:'mc', q:'Which gas is the main greenhouse gas?', options:['Nitrogen','Carbon dioxide','Oxygen'], answer:'Carbon dioxide'},
              {type:'fitb', q:'Climate change refers to long-term changes in _______.', answer:'weather patterns'},
              {type:'tf', q:'Human activities contribute to current climate change.', answer:true},
              {type:'mc', q:'Mitigation seeks to:', options:['Reduce causes','Ignore causes','Increase emissions'], answer:'Reduce causes'},
              {type:'mc', q:'An example of adaptation is:', options:['Building sea walls','Drilling oil','Clearing forests'], answer:'Building sea walls'}
            ],
            challenge:'Design a 3-point plan your household could use to reduce energy use this week.'
          },
          {
            title:'Week 2  Impacts & Vulnerability',
            video:'videos/climate_week2.mp4',
            pdf:'resources/climate_week2.pdf',
            quiz:[
              {type:'mc', q:'Sea-level rise mainly affects:', options:['Coastal communities','Deserts','Mountains'], answer:'Coastal communities'},
              {type:'fitb', q:'Climate change can increase the frequency of _______.', answer:'extreme weather events'},
              {type:'tf', q:'Small islands are highly vulnerable to climate change.', answer:true},
              {type:'mc', q:'A climate impact is:', options:['Increased drought','Stable climate','More ice sheets'], answer:'Increased drought'},
              {type:'mc', q:'A local adaptation action could be:', options:['Early warning systems','Deforestation','Open burning'], answer:'Early warning systems'}
            ],
            challenge:'List 3 local impacts you have observed in your area that may be climate-related.'
          },
          {
            title:'Week 3  Mitigation & Low-Carbon Solutions',
            video:'videos/climate_week3.mp4',
            pdf:'resources/climate_week3.pdf',
            quiz:[
              {type:'mc', q:'Which is a renewable energy?', options:['Coal','Solar','Oil'], answer:'Solar'},
              {type:'fitb', q:'Energy _______ reduces consumption without losing service.', answer:'efficiency'},
              {type:'tf', q:'Reforestation can be a nature-based mitigation solution.', answer:true},
              {type:'mc', q:'An example of mitigation is:', options:['Switching to renewables','Clearing wetlands','Increasing coal plants'], answer:'Switching to renewables'},
              {type:'mc', q:'A circular economy practice is:', options:['Repairing goods','Single-use','Burning plastics'], answer:'Repairing goods'}
            ],
            challenge:'Propose 3 changes your school or workplace could implement to reduce emissions.'
          },
          {
            title:'Week 4  Policy & Community Action',
            video:'videos/climate_week4.mp4',
            pdf:'resources/climate_week4.pdf',
            quiz:[
              {type:'mc', q:'The Paris Agreement aims to limit temperature rise to below ____ C (ambitious target).', options:['1.5','2','3'], answer:'2'},
              {type:'fitb', q:'Community gardens can improve local _______.', answer:'resilience'},
              {type:'tf', q:'Policy has no role in climate solutions.', answer:false},
              {type:'mc', q:'An effective local action can be:', options:['Improved public transit','More private cars','Open dumping'], answer:'Improved public transit'},
              {type:'mc', q:'Education campaigns mainly serve to:', options:['Raise awareness','Confuse people','Delay action'], answer:'Raise awareness'}
            ],
            challenge:'Draft a short poster (in words) to encourage one behavior that reduces emissions locally.'
          }
        ]
      };
    }
    if(id===2){ // Renewable Energy Systems
      return {
        title:'Renewable Energy Systems',
        weeks:[
          {
            title:'Week 1  Energy Basics & Sources',
            video:'videos/renewable_week1.mp4',
            pdf:'resources/renewable_week1.pdf',
            quiz:[
              {type:'mc', q:'Which is a renewable source?', options:['Coal','Solar','Oil'], answer:'Solar'},
              {type:'fitb', q:'Solar panels convert sunlight into _______.', answer:'electricity'},
              {type:'tf', q:'Wind turbines produce electricity without burning fuel.', answer:true},
              {type:'mc', q:'A challenge of renewables is:', options:['Intermittency','Infinite fuel','Guaranteed output'], answer:'Intermittency'},
              {type:'mc', q:'Hydropower uses:', options:['Flowing water','Fossil fuels','Coal'], answer:'Flowing water'}
            ],
            challenge:'Sketch (or describe) where a small solar array could be installed in a neighborhood and explain constraints.'
          },
          {
            title:'Week 2  Solar & Wind Tech',
            video:'videos/renewable_week2.mp4',
            pdf:'resources/renewable_week2.pdf',
            quiz:[
              {type:'mc', q:'PV stands for:', options:['Photovoltaic','Photo value','Power value'], answer:'Photovoltaic'},
              {type:'fitb', q:'Turbines convert wind ____ into electricity.', answer:'energy'},
              {type:'tf', q:'Battery storage helps smooth renewable output.', answer:true},
              {type:'mc', q:'Solar arrays work best when:', options:['Facing the sun','In total shade','Buried underground'], answer:'Facing the sun'},
              {type:'mc', q:'A microgrid helps by:', options:['Providing local energy resilience','Removing renewables','Increasing blackout risk'], answer:'Providing local energy resilience'}
            ],
            challenge:'List 4 maintenance checks for a small community solar installation.'
          },
          {
            title:'Week 3  Storage & Grids',
            video:'videos/renewable_week3.mp4',
            pdf:'resources/renewable_week3.pdf',
            quiz:[
              {type:'mc', q:'Battery storage units store:', options:['Electricity','Soil','Water'], answer:'Electricity'},
              {type:'fitb', q:'Dispatchable generation means the plant can be _______ on demand.', answer:'controlled'},
              {type:'tf', q:'Smart grids can integrate many distributed resources.', answer:true},
              {type:'mc', q:'A hybrid system mixes:', options:['Multiple energy types','Only gas','Only diesel'], answer:'Multiple energy types'},
              {type:'mc', q:'An inverter converts DC to:', options:['AC','DC','Heat'], answer:'AC'}
            ],
            challenge:'Propose a short checklist for safety when working near a small battery bank.'
          },
          {
            title:'Week 4  Community Projects & Policy',
            video:'videos/renewable_week4.mp4',
            pdf:'resources/renewable_week4.pdf',
            quiz:[
              {type:'mc', q:'Feed-in tariffs encourage:', options:['Local renewable feeding to grid','More fossil fuel use','No renewables'], answer:'Local renewable feeding to grid'},
              {type:'fitb', q:'Community ownership models can increase _______.', answer:'acceptance'},
              {type:'tf', q:'Policy can speed up renewable deployment.', answer:true},
              {type:'mc', q:'A financing option for community projects is:', options:['Crowdfunding','Hoarding cash','Refusing funds'], answer:'Crowdfunding'},
              {type:'mc', q:'Training local technicians improves:', options:['Sustainability','Risk','Pollution'], answer:'Sustainability'}
            ],
            challenge:'Draft a short proposal outline for a small community solar project (aim, cost estimate, benefits).'
          }
        ]
      };
    }
    if(id===3){ // Sustainable Agriculture
      return {
        title:'Sustainable Agriculture',
        weeks:[
          {
            title:'Week 1  Soil & Agroecology',
            video:'videos/agri_week1.mp4',
            pdf:'resources/agri_week1.pdf',
            quiz:[
              {type:'mc', q:'Healthy soil improves:', options:['Crop yields','Internet speed','TV channels'], answer:'Crop yields'},
              {type:'fitb', q:'Compost adds _______ to soil.', answer:'organic matter'},
              {type:'tf', q:'Monocultures reduce biodiversity.', answer:true},
              {type:'mc', q:'Cover crops are used to:', options:['Protect soil','Increase erosion','Kill topsoil'], answer:'Protect soil'},
              {type:'mc', q:'Reduced tillage can help:', options:['Preserve soil structure','Destroy soil','Reduce yields'], answer:'Preserve soil structure'}
            ],
            challenge:'List five low-cost steps a small farmer could use to improve soil health this season.'
          },
          {
            title:'Week 2  Water & Nutrient Management',
            video:'videos/agri_week2.mp4',
            pdf:'resources/agri_week2.pdf',
            quiz:[
              {type:'mc', q:'Drip irrigation saves:', options:['Water','Coal','Plastic'], answer:'Water'},
              {type:'fitb', q:'Nitrogen is important for plant _______.', answer:'growth'},
              {type:'tf', q:'Over-fertilizing can pollute waterways.', answer:true},
              {type:'mc', q:'A soil test is used to:', options:['Determine nutrient needs','Paint crops','Measure rainfall'], answer:'Determine nutrient needs'},
              {type:'mc', q:'Mulching helps by:', options:['Retaining moisture','Wasting water','Increasing erosion'], answer:'Retaining moisture'}
            ],
            challenge:'Design a weekly watering schedule for a small vegetable bed in your area.'
          },
          {
            title:'Week 3  Pest Management & Agroforestry',
            video:'videos/agri_week3.mp4',
            pdf:'resources/agri_week3.pdf',
            quiz:[
              {type:'mc', q:'Integrated pest management emphasizes:', options:['Multiple approaches','Only pesticides','Ignore pests'], answer:'Multiple approaches'},
              {type:'fitb', q:'Agroforestry integrates trees and _______.', answer:'crops'},
              {type:'tf', q:'Natural predators can reduce pest pressure.', answer:true},
              {type:'mc', q:'A polyculture is:', options:['Multiple crops together','One crop only','A type of machine'], answer:'Multiple crops together'},
              {type:'mc', q:'Buffer strips reduce:', options:['Runoff','Productivity','Biodiversity'], answer:'Runoff'}
            ],
            challenge:'Propose a simple agroforestry plan for a 10m x 10m plot.'
          },
          {
            title:'Week 4  Markets & Food Systems',
            video:'videos/agri_week4.mp4',
            pdf:'resources/agri_week4.pdf',
            quiz:[
              {type:'mc', q:'Local markets can increase:', options:['Farmer incomes','Plastic use','Pollution'], answer:'Farmer incomes'},
              {type:'fitb', q:'Value addition means increasing _______ of a product.', answer:'value'},
              {type:'tf', q:'Short supply chains can improve freshness.', answer:true},
              {type:'mc', q:'Cooperatives help by:', options:['Pooling resources','Isolating farmers','Increasing costs'], answer:'Pooling resources'},
              {type:'mc', q:'A product label showing origin helps consumers with:', options:['Transparency','Confusion','Less trust'], answer:'Transparency'}
            ],
            challenge:'Outline a simple plan for a farmer market stall focusing on sustainable produce.'
          }
        ]
      };
    }
    return {title:'Unknown', weeks:[]};
  }

  /* ---------- UI helpers ---------- */
  function text(node, s){ if(node) node.textContent = s; }
  function el(selector, root=document){ return root.querySelector(selector); }

  /* ---------- Render modules & wire events ---------- */
  function renderCourseDetail(courseId){
    const detail = document.getElementById('mc-detail-' + courseId);
    if(!detail) return;
    detail.innerHTML = ''; // rebuilt
    const content = courseContent(courseId);
    // header
    const container = document.createElement('div');
    container.className = 'mc-detail-inner';
    // modules
    const modulesWrap = document.createElement('div');
    modulesWrap.className = 'mc-modules';
    content.weeks.forEach((wk, idx) => {
      const weekIndex = idx+1;
      const weekDiv = document.createElement('div');
      weekDiv.className = 'mc-week';
      // Video placeholder (commented guidance)
      const videoHTML = `
        <!-- VIDEO PLACEHOLDER: replace path with your video file (suggested folder: /videos)
             Example local path: videos/climate_week1.mp4 -->
        <div class="mc-video-wrap">
          <video id="mc_video_${courseId}_${weekIndex}" playsinline controls preload="metadata">
            <source src="${wk.video}" type="video/mp4" />
            Your browser does not support HTML5 video.
          </video>
        </div>`;
      // Resource link & actions
      weekDiv.innerHTML = `<h4>Week ${weekIndex}: ${wk.title}</h4>
        ${videoHTML}
        <div class="mc-module-actions">
          <a class="mc-link" href="${wk.pdf}" download>Download Resource (PDF)</a>
          <button class="mc-btn mc-unlock" data-course="${courseId}" data-week="${weekIndex}">Take Module Quiz</button>
          <button class="mc-btn mc-confirm" data-course="${courseId}" data-week="${weekIndex}">I Watched</button>
          <button class="mc-btn mc-reset" data-course="${courseId}" data-week="${weekIndex}" style="background:#fff;border:1px solid #ddd;color:var(--dark-text,#2C3E50)">Reset Module</button>
        </div>
        <div class="mc-quiz-area" id="mc_quiz_area_${courseId}_${weekIndex}" aria-hidden="true"></div>
        <div class="mc-challenge" id="mc_challenge_${courseId}_${weekIndex}" style="margin-top:8px"></div>`;
      modulesWrap.appendChild(weekDiv);
      // wire challenge content
      const challenge = document.getElementById('mc_challenge_'+courseId+'_'+weekIndex);
      // (challenge inserted after DOM appended)
    });
    container.appendChild(modulesWrap);

    // final block
    const finalBlock = document.createElement('div');
    finalBlock.className = 'mc-final-block';
    finalBlock.innerHTML = `<h4>Final Exam</h4>
      <p class="mc-small">Complete all weeks (watch + pass module) to unlock final. Pass 70% to earn certificate.</p>
      <div class="mc-final-area">
        <button class="mc-btn mc-final-start" data-course="${courseId}">Start Final Exam</button>
        <div id="mc_final_area_${courseId}" class="mc-final-quiz"></div>
        <div id="mc_final_result_${courseId}" class="mc-final-result"></div>
        <div id="mc_cert_area_${courseId}" class="mc-cert-area"></div>
      </div>`;
    container.appendChild(finalBlock);
    detail.appendChild(container);

    // after insertion, wire module events & video watchers
    wireModuleEvents(courseId);
    // populate challenge text
    content.weeks.forEach((wk, idx)=> {
      const wkIndex = idx+1;
      const chal = wk.challenge || '';
      const chEl = document.getElementById('mc_challenge_'+courseId+'_'+wkIndex);
      if(chEl) {
        chEl.innerHTML = `<strong>Challenge:</strong> <div>${chal}</div>`;
      }
    });
  }

  function wireModuleEvents(courseId){
    const content = courseContent(courseId);
    content.weeks.forEach((wk, idx)=>{
      const weekIndex=idx+1;
      const vid = document.getElementById('mc_video_'+courseId+'_'+weekIndex);
      const unlockBtn = document.querySelector(`.mc-unlock[data-course="${courseId}"][data-week="${weekIndex}"]`);
      const confirmBtn = document.querySelector(`.mc-confirm[data-course="${courseId}"][data-week="${weekIndex}"]`);
      const resetBtn = document.querySelector(`.mc-reset[data-course="${courseId}"][data-week="${weekIndex}"]`);
      const quizArea = document.getElementById('mc_quiz_area_'+courseId+'_'+weekIndex);

      // ensure storage node exists
      const state = load(courseId) || {};
      state.enrolled = state.enrolled || false;
      state.weeks = state.weeks || {};
      state.weeks[weekIndex] = state.weeks[weekIndex] || { unlocked:false, watched:false, quiz:{submitted:false,score:0}, retakes:0 };
      save(courseId, state);

      // video event handlers
      if(vid){
        vid.addEventListener('play', ()=>{
          const s = load(courseId) || {}; s.enrolled=true; s.weeks=s.weeks||{}; s.weeks[weekIndex]=s.weeks[weekIndex]||{};
          s.weeks[weekIndex].watched=true; s.weeks[weekIndex].unlocked=true; save(courseId,s); refreshCourseUI(courseId);
        });
        vid.addEventListener('ended', ()=>{
          const s = load(courseId) || {}; s.enrolled=true; s.weeks=s.weeks||{}; s.weeks[weekIndex]=s.weeks[weekIndex]||{};
          s.weeks[weekIndex].watched=true; s.weeks[weekIndex].unlocked=true; save(courseId,s);
          if(quizArea) renderModuleQuiz(courseId, weekIndex);
          refreshCourseUI(courseId);
        });
      }

      if(confirmBtn) confirmBtn.addEventListener('click', ()=>{
        const ok = confirm('Confirm you watched this module? This will unlock the module quiz.');
        if(!ok) return;
        const s = load(courseId) || {}; s.enrolled=true; s.weeks=s.weeks||{}; s.weeks[weekIndex]=s.weeks[weekIndex]||{};
        s.weeks[weekIndex].watched=true; s.weeks[weekIndex].unlocked=true; save(courseId,s);
        if(quizArea) renderModuleQuiz(courseId, weekIndex);
        refreshCourseUI(courseId);
      });

      if(unlockBtn) unlockBtn.addEventListener('click', ()=>{
        const s = load(courseId) || {};
        if(!s.weeks || !s.weeks[weekIndex] || !s.weeks[weekIndex].unlocked){
          alert('Please watch the module video or confirm watched to unlock the quiz.');
          return;
        }
        renderModuleQuiz(courseId, weekIndex);
      });

      if(resetBtn) resetBtn.addEventListener('click', ()=>{
        if(!confirm('Reset this module? This clears attempts for the module and allows a fresh retake. Continue?')) return;
        const s = load(courseId) || {}; s.enrolled=true; s.weeks=s.weeks||{};
        s.weeks[weekIndex] = { unlocked:true, watched:false, quiz:{submitted:false,score:0}, retakes:0 };
        save(courseId,s);
        const area = document.getElementById('mc_quiz_area_'+courseId+'_'+weekIndex);
        if(area) area.innerHTML='';
        refreshCourseUI(courseId);
      });
    });
  }

  /* ---------- Module quiz rendering, grading, retake policy ---------- */
  function renderModuleQuiz(courseId, weekIndex){
    const area = document.getElementById('mc_quiz_area_'+courseId+'_'+weekIndex);
    if(!area) return;
    area.innerHTML='';
    area.style.display='block';
    const wk = courseContent(courseId).weeks[weekIndex-1];
    const bank = wk.quiz || [];
    // render questions (5 items)
    bank.forEach((q, idx)=>{
      const qDiv = document.createElement('div'); qDiv.className='mc-quiz';
      qDiv.innerHTML = `<p><strong>Q${idx+1}.</strong> ${q.q}</p>`;
      if(q.type==='mc'){
        q.options.forEach(opt=>{
          const lbl = document.createElement('label'); lbl.style.display='block';
          lbl.innerHTML = `<input type="radio" name="m_${courseId}_${weekIndex}_q${idx}" value="${opt}"> ${opt}`;
          qDiv.appendChild(lbl);
        });
      } else if(q.type==='fitb'){
        const inp = document.createElement('input'); inp.type='text'; inp.name='m_'+courseId+'_'+weekIndex+'_q'+idx; inp.placeholder='Type answer';
        inp.style.width='100%'; qDiv.appendChild(inp);
      } else if(q.type==='tf'){
        ['True','False'].forEach(opt=>{
          const lbl = document.createElement('label'); lbl.style.display='block';
          lbl.innerHTML = `<input type="radio" name="m_${courseId}_${weekIndex}_q${idx}" value="${opt.toLowerCase()}"> ${opt}`;
          qDiv.appendChild(lbl);
        });
      }
      area.appendChild(qDiv);
    });
    const submit = document.createElement('button'); submit.className='mc-btn'; submit.textContent='Submit Module Assessment';
    area.appendChild(submit);

    submit.addEventListener('click', ()=>{
      const answers = collectModuleAnswers(courseId, weekIndex, bank.length);
      const result = gradeModule(bank, answers);
      // update storage
      const s = load(courseId) || {}; s.enrolled=true; s.weeks=s.weeks||{}; s.weeks[weekIndex]=s.weeks[weekIndex]||{};
      s.weeks[weekIndex].quiz = s.weeks[weekIndex].quiz || {};
      s.weeks[weekIndex].quiz.submitted=true;
      s.weeks[weekIndex].quiz.score = result.percent;
      // retake policy: allow 1 retake only if failed
      s.weeks[weekIndex].retakes = s.weeks[weekIndex].retakes || 0;
      if(result.percent < 70){
        s.weeks[weekIndex].retakes += 1;
        save(courseId,s);
        area.innerHTML = `<div style="padding:8px;background:#fff6f6;border-radius:6px;color:#b04040;">Score: ${result.percent}%. Not passed. ${s.weeks[weekIndex].retakes <= 1 ? 'You have 1 retake available.' : 'No retakes left.'}</div>`;
      } else {
        save(courseId,s);
        area.innerHTML = `<div style="padding:8px;background:#f3fff6;border-radius:6px;color:green;">Passed module  ${result.percent}%</div>`;
        // unlock next week
        const s2 = load(courseId) || {}; s2.weeks = s2.weeks || {};
        if(weekIndex < 4){
          s2.weeks[weekIndex+1] = s2.weeks[weekIndex+1] || { unlocked:true, watched:false, quiz:{submitted:false,score:0}, retakes:0 };
          save(courseId,s2);
        }
      }
      refreshCourseUI(courseId);
      updateOverview();
    });
  }

  function collectModuleAnswers(courseId, weekIndex, count){
    const answers = {};
    for(let i=0;i<count;i++){
      const name = `m_${courseId}_${weekIndex}_q${i}`;
      const radio = document.querySelector(`input[name="${name}"]:checked`);
      if(radio) answers[i] = radio.value;
      else {
        const text = document.querySelector(`input[name="${name}"]`);
        answers[i] = text ? text.value.trim() : null;
      }
    }
    return answers;
  }

  function gradeModule(bank, answers){
    let correct=0;
    bank.forEach((q, idx)=>{
      const user = answers[idx];
      if(q.type==='mc'){
        if(user === q.answer) correct++;
      } else if(q.type==='fitb'){
        if(user && user.toLowerCase().trim() === (''+q.answer).toLowerCase().trim()) correct++;
      } else if(q.type==='tf'){
        const val = (user==='true' || user===true) ? true : ((user==='false'||user===false)?false:null);
        if(val !== null && val === !!q.answer) correct++;
      }
    });
    const percent = Math.round((correct / bank.length) * 100);
    return {correct, total:bank.length, percent};
  }

  /* ---------- Final exam rendering & grading ---------- */
  function startFinalExam(courseId){
    // readiness check: all weeks unlocked AND module passed (or at least watched and attempted)
    const s = load(courseId) || {};
    if(!s.weeks) { alert('Complete the modules first.'); return; }
    for(let w=1; w<=4; w++){
      if(!s.weeks[w] || !( (s.weeks[w].quiz && s.weeks[w].quiz.submitted) || s.weeks[w].watched) ){
        alert('You must complete all 4 modules (watch + module assessment) before attempting the final.');
        return;
      }
    }
    // build final UI
    const finalArea = document.getElementById('mc_final_area_'+courseId);
    const finalResult = document.getElementById('mc_final_result_'+courseId);
    if(!finalArea || !finalResult) return;
    finalArea.innerHTML = ''; finalArea.classList.add('open'); finalResult.style.display='none';
    const bank = courseContent(courseId).weeks.reduce((acc,w)=> acc.concat(w.quiz.slice(0,2)), []); // quick 8-10 Q
    // ensure there are at least 8 questions; if not, fallback to a default
    if(bank.length < 8) {
      // fallback: gather all module quiz questions
      courseContent(courseId).weeks.forEach(w=> { w.quiz.forEach(q=>bank.push(q)); });
    }
    const questions = bank.slice(0,10);
    const form = document.createElement('form'); form.onsubmit=e=>e.preventDefault();
    questions.forEach((q,idx)=>{
      const div=document.createElement('div'); div.className='mc-quiz';
      div.innerHTML = `<p><strong>Q${idx+1}.</strong> ${q.q}</p>`;
      (q.options || ['True','False']).forEach(opt=>{
        const lbl = document.createElement('label'); lbl.style.display='block';
        lbl.innerHTML = `<input type="radio" name="final_${courseId}_q${idx}" value="${opt}"> ${opt}`;
        div.appendChild(lbl);
      });
      form.appendChild(div);
    });
    const submit = document.createElement('button'); submit.className='mc-btn'; submit.textContent='Submit Final Exam';
    form.appendChild(submit);
    finalArea.appendChild(form);

    submit.addEventListener('click', ()=>{
      let correct = 0;
      questions.forEach((q,idx)=>{
        const sel = finalArea.querySelector(`input[name="final_${courseId}_q${idx}"]:checked`);
        if(sel && sel.value === q.answer) correct++;
      });
      const percent = Math.round((correct / questions.length) * 100);
      finalResult.style.display='block';
      finalResult.innerHTML = `<strong>Final Score:</strong> ${percent}% (${correct}/${questions.length})`;
      const s2 = load(courseId) || {}; s2.final = s2.final || {}; s2.final.submitted = true; s2.final.score = percent; s2.final.correct = correct; s2.final.total = questions.length; save(courseId,s2);
      refreshCourseUI(courseId);
      if(percent >= 70){
        // certificate flow
        promptCertificateName(courseId);
      } else {
        alert('Final not passed. Review modules and try again.');
      }
      updateOverview();
    });
  }

  function promptCertificateName(courseId){
    const name = prompt('You passed! Enter the name to print on the EcoLearn Official Certificate:') || 'Learner';
    const s = load(courseId) || {}; s.final = s.final || {}; s.final.certName = name; s.final.certificateGenerated = true; save(courseId,s);
    generateCertificate(courseId, name);
    showCertificateArea(courseId, name);
  }

  /* ---------- Certificate generation (jsPDF) ---------- */
  function generateCertificate(courseId, learnerName){
    // lazy load jspdf
    if(typeof window.jspdf==='undefined' && typeof window.jsPDF==='undefined'){
      const s = document.createElement('script');
      s.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
      s.onload = ()=> createDoc();
      document.body.appendChild(s);
    } else createDoc();

    function createDoc(){
      const { jsPDF } = window.jspdf || window;
      const doc = new jsPDF({ orientation:'landscape', unit:'pt', format:'a4' });
      // background
      doc.setFillColor(11,133,110); // deep green
      doc.rect(0,0, doc.internal.pageSize.width, doc.internal.pageSize.height, 'F');
      // inner panel
      doc.setFillColor(255,255,255);
      doc.rect(40,60, doc.internal.pageSize.width-80, doc.internal.pageSize.height-120, 'F');
      // Title
      doc.setFontSize(34);
      doc.setTextColor(11,133,110);
      doc.text('EcoLearn Official Certificate', doc.internal.pageSize.width/2, 140, { align:'center' });
      doc.setFontSize(18);
      doc.setTextColor(0,0,0);
      doc.text('This is to certify that', doc.internal.pageSize.width/2, 190, { align:'center' });
      doc.setFontSize(28);
      doc.text(learnerName, doc.internal.pageSize.width/2, 230, { align:'center' });
      doc.setFontSize(14);
      doc.text(`has successfully completed the course "${courseContent(courseId).title}".`, doc.internal.pageSize.width/2, 260, { align:'center' });
      doc.setFontSize(12);
      const date = new Date().toLocaleDateString();
      doc.text(`Date: ${date}`, 80, doc.internal.pageSize.height - 80);

      // Logo placeholder (you can replace with an image later).
      // To add a real logo: doc.addImage(imgData, 'PNG', x, y, width, height);
      // We'll leave a placeholder box on the certificate and text to indicate where to replace later.
      doc.setDrawColor(11,133,110);
      doc.addImage(imgData, 'PNG', x, y, width, height);
      //doc.rect(doc.internal.pageSize.width - 240, doc.internal.pageSize.height - 140, 160, 60); // placeholder box
      doc.setFontSize(10);
      doc.text('EcoLearn logo (replace)', doc.internal.pageSize.width - 160, doc.internal.pageSize.height - 110, { align:'center' });

      const filename = `EcoLearn_Certificate_${courseId}_${learnerName.replace(/\s+/g,'_')}.pdf`;
      doc.save(filename);
    }
  }

  function showCertificateArea(courseId, name){
    const area = document.getElementById('mc_cert_area_'+courseId);
    if(!area) return;
    area.innerHTML = `<div style="padding:8px;background:#f5fff8;border-radius:8px;">
      <strong>Certificate ready</strong>
      <div style="font-weight:700;margin:6px 0">${name}</div>
      <button class="mc-btn" id="mc_download_cert_${courseId}">Download Certificate</button>
    </div>`;
    document.getElementById('mc_download_cert_'+courseId).addEventListener('click', ()=> generateCertificate(courseId, name));
  }

  /* ---------- UI refresh & overview ---------- */
  function refreshCourseUI(courseId){
    const state = load(courseId) || {};
    const statusEl = document.getElementById('mc-status-'+courseId);
    if(statusEl) statusEl.textContent = state.enrolled ? 'Enrolled' : 'Not enrolled';
    // progress percent = modules passed or watched / 4
    let completed = 0;
    if(state.weeks){
      for(let w=1; w<=4; w++){
        if(state.weeks[w] && ( (state.weeks[w].quiz && state.weeks[w].quiz.submitted && state.weeks[w].quiz.score>=70) || state.weeks[w].watched )){
          completed++;
        }
      }
    }
    const percent = Math.round((completed/4)*100);
    const fill = document.getElementById('mc-progress-fill-'+courseId);
    if(fill) fill.style.width = percent + '%';
    // if final passed previously, show certificate area
    if(state.final && state.final.submitted && state.final.score >= 70){
      showCertificateArea(courseId, state.final.certName || 'Learner');
    }
  }

  function updateOverview(){
    const ov = document.getElementById('mc-overview');
    if(!ov) return;
    ov.innerHTML = '';
    COURSES.forEach(id=>{
      const s = load(id) || {};
      const item = document.createElement('div'); item.className='ov-item';
      const title = document.createElement('div'); title.className='ov-title'; title.textContent = courseContent(id).title;
      const sub = document.createElement('div'); sub.className='ov-sub';
      let completed = 0;
      if(s.weeks){
        for(let w=1; w<=4; w++){
          if(s.weeks[w] && ((s.weeks[w].quiz && s.weeks[w].quiz.submitted && s.weeks[w].quiz.score>=70) || s.weeks[w].watched)) completed++;
        }
      }
      const finalScore = s.final && s.final.submitted ? s.final.score + '%' : '';
      sub.textContent = `Modules: ${completed}/4  Final: ${finalScore}  ${s.enrolled ? 'Enrolled' : 'Not enrolled'}`;
      item.appendChild(title); item.appendChild(sub);
      ov.appendChild(item);
    });
  }

  /* ---------- Initialization: enroll / open buttons ---------- */
  function init(){
    // attach start/open handlers
    document.querySelectorAll('.mc-start').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        const id = Number(btn.getAttribute('data-course'));
        const s = load(id) || {}; s.enrolled=true; s.weeks = s.weeks || {}; s.weeks[1] = s.weeks[1] || { unlocked:true, watched:false, quiz:{submitted:false,score:0}, retakes:0 }; save(id,s);
        refreshCourseUI(id); updateOverview();
        // render detail automatically
        document.getElementById('mc-detail-'+id).classList.add('open'); document.getElementById('mc-detail-'+id).setAttribute('aria-hidden','false');
        renderCourseDetail(id);
        alert('Enrolled! Week 1 unlocked. Good luck!');
      });
    });
    document.querySelectorAll('.mc-open').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        const id = Number(btn.getAttribute('data-course'));
        const det = document.getElementById('mc-detail-'+id);
        det.classList.toggle('open'); det.setAttribute('aria-hidden', det.classList.contains('open') ? 'false' : 'true');
        renderCourseDetail(id);
      });
    });
    // final exam start handler delegated (buttons created inside renderCourseDetail)
    // Use event delegation for dynamic elements
    document.body.addEventListener('click', function(e){
      if(e.target && e.target.classList && e.target.classList.contains('mc-final-start')){
        const id = Number(e.target.getAttribute('data-course')); startFinalExam(id);
      }
    });

    // initial render of details empty (so DOM nodes exist)
    COURSES.forEach(id=>{
      renderCourseDetail(id);
      refreshCourseUI(id);
    });
    updateOverview();
  }

  /* ---------- boot on DOM ready ---------- */
  document.addEventListener('DOMContentLoaded', init);

  // expose for debugging
  window.EcoLearnMC = { load, save, clearCourse, refreshCourseUI, updateOverview };

})();
</script>

<!-- ============================
     END OF ECOLEARN MONTHLY COURSES OVERRIDE
     ============================ -->
<!-- === Updated Lesson Script (Overrides Previous) === -->
<script>
const quizzes = {
  1: {
    title: "Pollution & Conservation Quiz",
    questions: [
      { q: "1. What is air pollution mainly caused by?", a: "Burning fossil fuels", options: ["Plastic waste", "Burning fossil fuels", "Tree planting", "Recycling"] },
      { q: "2. Which of the following is a non-renewable resource?", a: "Coal", options: ["Wind", "Solar", "Coal", "Biomass"] },
      { q: "3. The contamination of water sources is called:", a: "Water pollution", options: ["Air pollution", "Land pollution", "Water pollution", "Soil conservation"] },
    ]
  },
  2: {
    title: "Sustainable Development Quiz",
    questions: [
      { q: "1. Sustainable development means:", a: "Meeting current needs without harming future generations", options: ["Using up all resources quickly", "Meeting current needs without harming future generations", "Ignoring environmental impacts", "Only focusing on economic growth"] },
      { q: "2. Which of these is a renewable energy source?", a: "Solar", options: ["Coal", "Oil", "Solar", "Gas"] },
      { q: "3. The three pillars of sustainability are:", a: "Economic, social, environmental", options: ["Political, social, cultural", "Economic, social, environmental", "Physical, economic, political", "None of the above"] },
    ]
  },
  3: {
    title: "Biodiversity & Ecosystems Quiz",
    questions: [
      { q: "1. What best defines biodiversity?", a: "The variety of living organisms in an ecosystem", options: ["Destruction of species", "The use of natural resources", "The variety of living organisms in an ecosystem", "Pollution of habitats"] },
      { q: "2. What is an ecosystem?", a: "A system formed by organisms and their environment interacting", options: ["A group of identical species", "A system formed by organisms and their environment interacting", "A single organism living in isolation", "None of the above"] },
      { q: "3. The removal of forests for urban development is known as:", a: "Deforestation", options: ["Reforestation", "Deforestation", "Afforestation", "Erosion"] },
    ]
  }
};

let currentLesson = null;

function openLessonModal(num) {
  currentLesson = quizzes[num];
  document.getElementById("lessonTitle").textContent = currentLesson.title;
  const container = document.getElementById("lessonQuestions");
  container.innerHTML = currentLesson.questions.map((q, i) => `
    <div class="question">
      <p>${q.q}</p>
      ${q.options.map(opt => `
        <label><input type="radio" name="q${i}" value="${opt}"> ${opt}</label><br>
      `).join('')}
    </div>
  `).join('');
  document.getElementById("lessonModal").style.display = "flex";
}

function closeLessonModal() {
  document.getElementById("lessonModal").style.display = "none";
  document.getElementById("lessonResult").style.display = "none";
}

function submitLessonQuiz() {
  const qset = currentLesson.questions;
  let score = 0;
  qset.forEach((q, i) => {
    const selected = document.querySelector(`input[name='q${i}']:checked`);
    if (selected && selected.value === q.a) score++;
  });
  const result = document.getElementById("lessonResult");
  result.style.display = "block";
  result.innerHTML = `<strong>Your Score: ${score}/${qset.length}</strong>`;
}

window.onclick = function (e) {
  if (e.target == document.getElementById("lessonModal")) closeLessonModal();
};
</script>

</body>
</html>